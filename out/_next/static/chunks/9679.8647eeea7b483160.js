"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9679],{69679:function(e,o,a){var t=a(85893),n=a(67294),l=a(65698),r=a(934),i=a(40039),s=a(60565),d=a(59439),u=a(87536),c=a(60664),m=a(18194),p=a(11163),f=a.n(p),D=a(86501),h=a(6624),b=a(92629),I=a(91757),x=a(83830),v=a(7071),g=a(71798),C=a(72819),y=a(78432),Z=a(49837),j=a(91359),M=a(42222),w=a(46099),S=a(27666),N=a(66198);let V=e=>{var o,a,p,V,P,E,k;let z;let{id:F,recebimentoMpID:R,modelID:A}=e,_=f(),B=F&&F>0?"edit":"new",{menu:O,user:T,loggedUnity:q,hasPermission:H}=(0,n.useContext)(i.V),{setTitle:K}=(0,n.useContext)(s.f),[Q,J]=(0,n.useState)(null),[U,X]=(0,n.useState)(null),[G,L]=(0,n.useState)(!1),[W,Y]=(0,n.useState)(!1),[$,ee]=(0,n.useState)({status:!1,errors:[]}),[eo,ea]=(0,n.useState)(!1),[et,en]=(0,n.useState)(!1),{setId:el,setModelID:er,setRecebimentoMpID:ei}=(0,n.useContext)(x.X),es=(0,u.cI)({mode:"onChange"}),ed=e=>{let o=!0;return e.forEach(e=>{e.novaQuantidade&&(0,M.JK)(e.novaQuantidade)>(0,M.JK)(e.quantidade)&&(o=!1)}),o},eu=async e=>{let o=es.getValues("productsConclude");if(F&&Q.recebimento.id){if(!ed(null!=o?o:[])){D.ZP.error("Quantidade naÌƒo pode ser maior que a quantidade do recebimento de MP!");return}e={form:{...e,products:o,prazo:es.getValues("header.prazoSolucao"),data:es.getValues("header.data"),data_:es.getValues("header.data")&&es.getValues("header.data").split("-").reverse().join("/"),hora:es.getValues("header.hora"),transporte:es.getValues("header.transporte"),produto:es.getValues("header.produto")},params:{id:F,recebimentoMpID:Q.recebimento.id,usuarioID:T.usuarioID,papelID:T.papelID,unidadeID:q.unidadeID,profissionalID:T.profissionalID}},J(null);try{await c.h.post("/formularios/recebimento-mp/nao-conformidade/conclude",e),await ef(es.getValues())}catch(a){console.log(a);return}finally{Y(!1),L(!G)}}},ec=async e=>{let o={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:T.usuarioID,papelID:T.papelID,unidadeID:q.unidadeID}};try{await c.h.post("/formularios/recebimento-mp/nao-conformidade/reOpen/".concat(F),o),D.ZP.success(g.OD.successUpdate)}catch(a){console.log(a)}finally{L(!G)}},em=async()=>{try{let e={id:null!=F?F:0,modelID:null!=A?A:0,recebimentoMpID:null!=R?R:0,unidadeID:q.unidadeID,papelID:T.papelID},o=await c.h.post("/formularios/recebimento-mp/nao-conformidade/getData",e);204===o.status&&(el(null),_.push("/formularios/recebimento-mp/?aba=nao-conformidade")),console.log("\uD83D\uDE80 ~ getData: ",o.data),es.reset(o.data),J(o.data.header),X(o.data.blocos)}catch(a){console.log(a);return}},ep=e=>{e.preventDefault();let o=es.getValues();ef(o)},ef=async e=>{if(!e)return;if(1===T.papelID&&!e.header.transporte&&!e.header.produto){D.ZP.error("Selecione o tipo de n\xe3o conformidade (Transporte ou Produto)!");return}let o=e.header.produtos.some(e=>e.checked_);if(1===T.papelID&&e.header.produto&&!o){D.ZP.error("Selecione pelo menos um produto!");return}console.log("\uD83D\uDE80 ~ onSubmit values:",e);let a={form:e,auth:{usuarioID:T.usuarioID,profissionalID:T.profissionalID,papelID:T.papelID,unidadeID:q.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",a);try{if("new"===B){let t=await c.h.post("/formularios/recebimento-mp/nao-conformidade/insertData",a);D.ZP.success("Dados cadastrados com sucesso!"),el(t.data.id),_.push("/formularios/recebimento-mp/?aba=nao-conformidade")}else"edit"===B&&(await c.h.post("/formularios/recebimento-mp/nao-conformidade/updateData/".concat(F),a),D.ZP.success("Dados atualizados com sucesso!"))}catch(n){console.log(n);return}finally{L(!G)}},eD=()=>{el(Q.modelo.id),_.push("/configuracoes/formularios/recebimentomp-naoconformidade/")},eh=e=>{ei(Q.recebimento.id),er(e.new.modelo.id),_.push("/formularios/recebimento-mp/novo/?aba=nao-conformidade")},eb=[],eI={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(I.Z,{}),disabled:!H(_.pathname,"editar"),route:null,type:null,action:ec,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};1==T.papelID&&Q&&Q.status.id>=40&&eb.push(eI),1==T.papelID&&(z=!1,O.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(z=!0)})})}),z)&&eb.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:eD,modal:!1,icon:"bi:gear",identification:null});let ex=()=>{let e={status:!1,errors:[]};es.clearErrors(),(0,w.n9)(es,"header.data","Data",e),(0,w.n9)(es,"header.hora","Hora",e),(0,w.lz)(es,es.getValues("header.fields"),e),(0,w.IB)(es,es.getValues("blocos"),e);let o=(0,w.FU)(e);($.status!==o.status||$.errors.length!==o.errors.length)&&ee(o)},ev=async(e,o)=>{let a=e.target.files;if(a&&a.length>0){var t,n;let l=new FormData;for(let r=0;r<a.length;r++)l.append("files[]",a[r]);l.append("usuarioID",T.usuarioID),l.append("unidadeID",q.unidadeID),l.append("parRecebimentoMpNaoConformidadeModeloBlocoID",null!==(t=o.parRecebimentoMpNaoConformidadeModeloBlocoID)&&void 0!==t?t:null),l.append("itemOpcaoAnexoID",null!==(n=o.itemOpcaoAnexoID)&&void 0!==n?n:null),await ef(es.getValues()),await c.h.post("/formularios/recebimento-mp/nao-conformidade/saveAnexo/".concat(F,"/item/").concat(T.usuarioID,"/").concat(q.unidadeID),l).then(e=>{}).catch(e=>{var o,a,t;D.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")}).finally(()=>{L(!G)})}},eg=async e=>{e&&await c.h.delete("/formularios/recebimento-mp/nao-conformidade/deleteAnexo/".concat(F,"/").concat(e.anexoID,"/").concat(q.unidadeID,"/").concat(T.usuarioID,"/item")).then(e=>{let o=es.getValues();ef(o)}).catch(e=>{var o,a,t;D.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")}).finally(()=>{em()})};return(0,n.useEffect)(()=>{K({icon:"typcn:warning-outline",title:"N\xe3o conformidade do Recebimento de MP",subtitle:{id:F,count:1,new:!1}}),em(),setTimeout(()=>{es.trigger()},300)},[G,T]),(0,t.jsx)("form",{onSubmit:e=>ep(e),children:Q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{btnNewModal:1===T.papelID&&"edit"===B,handleNewModal:()=>ea(!0),btnCancel:!0,btnSave:(null==Q?void 0:null===(o=Q.status)||void 0===o?void 0:o.id)<40,btnSend:1===T.papelID&&(null==Q?void 0:null===(a=Q.status)||void 0===a?void 0:a.id)>=30&&(null==Q?void 0:null===(p=Q.status)||void 0===p?void 0:p.id)<=40||2===T.papelID&&(null==Q?void 0:null===(V=Q.status)||void 0===V?void 0:V.id)===30,btnPrint:"edit"==B,btnDelete:1===T.papelID&&(null==Q?void 0:null===(P=Q.status)||void 0===P?void 0:P.id)<40&&"edit"===B,onclickDelete:()=>en(!0),actionsData:eb,actions:1===T.papelID,handleSubmit:()=>es.handleSubmit(ef),handleSend(){Y(!0),ex()},iconConclusion:"solar:check-read-linear",titleConclusion:"Concluir",title:"N\xe3o conformidade do Recebimento de MP",type:B,status:null==Q?void 0:null===(E=Q.status)||void 0===E?void 0:E.id}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(v.Z,{size:"small",HeaderFiel:!0,skin:"light",color:Q.status.color,label:Q.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(v.Z,{size:"small",HeaderFiel:!0,skin:"light",label:Q.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(Z.Z,{children:(0,t.jsx)(j.Z,{className:"space-y-2 ",children:(0,t.jsx)(m.Z,{data:Q})})}),(0,t.jsx)(d.Z,{form:es,data:Q,disabled:(null===(k=Q.status)||void 0===k?void 0:k.id)>=40||1!=T.papelID}),"new"===B&&(0,t.jsx)(S.Z,{}),"edit"===B&&(0,t.jsx)(N.Z,{form:es,data:U,setBlock:X,blockKeyName:"parRecebimentoMpNaoConformidadeModeloBlocoID",handleFileSelect:ev,handleRemoveFile:eg,status:Q.status.id,disabled:Q.status.id>=40||Q.fornecedorAcessaRecebimento&&1===T.papelID}),(0,t.jsx)(r.Z,{id:F,parFormularioID:3},G)]}),(0,t.jsx)(h.Z,{openModal:W,handleClose(){Y(!1)},title:"Concluir N\xe3o Conformidade do Recebimento de MP",text:"Deseja realmente concluir este formul\xe1rio?",status:Q.status.id,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eu,type:"recebimentoMpNaoConformidade",listErrors:$,unity:q,values:null,formularioID:3,modeloID:Q.modelo.id,produtos:es.getValues("header.produtos"),form:es,departamentos:Q.departamentosConclusao}),(0,t.jsx)(b.Z,{open:et,handleClose:()=>en(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(F),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,t.jsx)(C.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:eh,size:"lg",setOpenModal:ea,openModal:eo,form:es,children:(0,t.jsx)(y.Z,{type:"form",data:Q,form:es})})]})})};o.Z=V}}]);