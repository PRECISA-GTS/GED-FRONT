"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4665],{12570:function(e,a,o){var t=o(85893),i=o(29308),n=o(84220),l=o(50287);let r=e=>{let{form:a,fields:o,disabled:r,getAddressByCep:s}=e,d=e=>{switch(e){case"telefone":case"telefone1":case"telefone2":return"telefone";case"cep":return"cep";case"cnpj":return"cnpj";default:return null}},u=e=>!!r&&r.length>0&&r.includes(e);return o&&o.map((e,o)=>{var c,m,p;return(0,t.jsxs)(t.Fragment,{children:[e&&"int"===e.tipo&&e.tabela&&(0,t.jsx)(n.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.tabela),type:e.tabela,options:e.options,value:null==e?void 0:e[e.tabela],mask:e.tabela,disabled:r||u(e.nomeColuna),alertRequired:1===e.obrigatorio,form:a},"select-".concat(o)),e&&"date"==e.tipo&&(0,t.jsx)(l.Z,{xs:12,md:4,title:"Data da avalia\xe7\xe3o",disabled:r||u(e.nomeColuna),value:null!==(c=null==e?void 0:e[e.nomeColuna])&&void 0!==c?c:new Date,type:e.nomeColuna,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),typeValidation:"dataPassado",daysValidation:365,alertRequired:1===e.obrigatorio,form:a},"datefield-".concat(o)),e&&"string"==e.tipo&&(0,t.jsx)(i.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),value:null!==(m=null==e?void 0:e[e.nomeColuna])&&void 0!==m?m:"",type:e.nomeColuna,getAddressByCep:s,mask:d(e.nomeColuna),disabled:!!(r||u(e.nomeColuna))||"cnpj"==e.nomeColuna,required:1===e.obrigatorio,alertRequired:1===e.obrigatorio,form:a},"input-".concat(o)),e&&"text"==e.tipo&&(0,t.jsx)(i.Z,{xs:12,md:12,multiline:!0,rows:6,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),value:null!==(p=null==e?void 0:e[e.nomeColuna])&&void 0!==p?p:"",type:e.nomeColuna,getAddressByCep:s,mask:d(e.nomeColuna),disabled:!!(r||u(e.nomeColuna))||"cnpj"==e.nomeColuna,required:1===e.obrigatorio,alertRequired:1===e.obrigatorio,form:a},"input-".concat(o))]})})};a.Z=r},4665:function(e,a,o){o.d(a,{Z:function(){return k}});var t=o(85893),i=o(67294),n=o(92477),l=o(934),r=o(40039),s=o(60565),d=o(49837),u=o(91359),c=o(79072),m=o(29308),p=o(50287),h=o(12570),f=o(83542),x=o(84220),v=o(60664),g=o(3893);let D=e=>{var a;let{form:o,data:n,disabled:l}=e,{loggedUnity:s}=(0,i.useContext)(r.V),[D,b]=(0,i.useState)([]),[I,y]=(0,i.useState)([]),[C,j]=(0,i.useState)([]),[z,Z]=(0,i.useState)([]),[S,w]=(0,i.useState)([]),[F,V]=(0,i.useState)([]);if(!n)return;let q=async()=>{try{if(!s)return;let e=await v.h.post("/cadastros/departamento",{unidadeID:s.unidadeID});b(e.data)}catch(a){console.log(a)}},E=async()=>{try{if(!s)return;let e=await v.h.post("/cadastros/profissional/getProfissionais",{unidadeID:s.unidadeID});y(e.data)}catch(a){console.log(a)}},P=async()=>{try{if(!s)return;let e=await v.h.post("/cadastros/setor/getSetores",{unidadeID:s.unidadeID});j(e.data)}catch(a){console.log(a)}},A=async()=>{try{if(!s)return;let e=await v.h.post("/cadastros/equipamento/getEquipamentos",{unidadeID:s.unidadeID});Z(e.data)}catch(a){console.log(a)}},k=async()=>{try{if(!s)return;let e=await v.h.post("/cadastros/produto/getProdutosLimpeza",{unidadeID:s.unidadeID});w(e.data)}catch(a){console.log(a)}},R=async()=>{try{if(!s)return;let e=await v.h.post("/formularios/fornecedor/getFornecedores",{unidadeID:s.unidadeID});V(e.data)}catch(a){console.log(a)}};return(0,i.useEffect)(()=>{q(),E(),P(),A(),k(),R()},[s]),(0,t.jsx)(d.Z,{children:(0,t.jsx)(u.Z,{children:(0,t.jsxs)(c.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,t.jsx)(f.Z,{data:null!==(a=null==n?void 0:n.departamentosPreenchimento)&&void 0!==a?a:[]})}),(0,t.jsx)(p.Z,{xs:12,md:2,title:"Data Inicial",type:"date",required:!0,name:"header.dataInicio",value:n.dataInicio,disabled:l,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(m.Z,{xs:12,md:2,title:"Hora Inicial",name:"header.horaInicio",type:"time",required:!0,disabled:l,form:o}),(0,t.jsx)(p.Z,{xs:12,md:2,title:"Data Final",type:"date",required:!0,name:"header.dataFim",value:n.dataFim,disabled:l,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(m.Z,{xs:12,md:2,title:"Hora Final",name:"header.horaFim",type:"time",required:!0,disabled:l,form:o}),(0,t.jsx)(g.Z,{xs:6,md:4,title:"Prestador de servi\xe7o",name:"header.prestadorServico",value:n.prestadorServico,form:o,disabled:l,helpText:"Limpeza realizada por uma empresa terceira"}),o.watch("header.prestadorServico")&&(0,t.jsx)(x.Z,{xs:12,md:4,title:"Fornecedor",name:"header.fornecedor",value:null==n?void 0:n.fornecedor,options:null!=F?F:[],form:o}),!o.watch("header.prestadorServico")&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Z,{xs:12,md:4,title:"Departamento",name:"header.departamento",value:null==n?void 0:n.departamento,options:null!=D?D:[],form:o}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"Profissional",name:"header.profissional",value:null==n?void 0:n.profissional,options:null!=I?I:[],form:o})]}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"Setor",name:"header.setor",value:null==n?void 0:n.setor,required:!0,alertRequired:!0,options:null!=C?C:[],form:o}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"Equipamento(s)",name:"header.equipamentos",value:null==n?void 0:n.equipamentos,multiple:!0,required:!0,options:null!=z?z:[],form:o}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"Produtos utilizados",name:"header.produtos",value:null==n?void 0:n.produtos,multiple:!0,helpText:"Equipamentos que foram utilizados pra realizar a limpeza do setor",options:null!=S?S:[],form:o}),(0,t.jsx)(g.Z,{xs:6,md:2,title:"Limpeza",name:"header.limpeza",value:n.limpeza,form:o,disabled:!0}),(0,t.jsx)(g.Z,{xs:6,md:2,title:"Higieniza\xe7\xe3o",name:"header.higienizacao",value:n.higienizacao,form:o,disabled:l}),(0,t.jsx)(h.Z,{form:o,fields:n.fields,disabled:l})]})})})};var b=o(99734);let I=e=>{let{form:a,data:o,setBlock:i,status:n,disabled:l,handleFileSelect:r,handleRemoveFile:s}=e;return(0,t.jsx)(t.Fragment,{children:o&&o.map((e,d)=>(0,t.jsx)(b.Z,{form:a,index:d,bloco:e,blockKey:"parRecebimentoMpNaoConformidadeModeloBlocoID",setBlocos:i,handleFileSelect:r,handleRemoveAnexoItem:s,status:n,blocos:o,disabled:l}))})};var y=o(87536),C=o(11163),j=o.n(C),z=o(86501),Z=o(82755),S=o(92629),w=o(91757),F=o(83830),V=o(7071),q=o(71798),E=o(42222),P=o(46099);let A=e=>{var a,o,d,u,c,m;let{id:p,modelID:h}=e,f=j(),x=p&&p>0?"edit":"new",{menu:g,user:b,loggedUnity:C,hasPermission:A}=(0,i.useContext)(r.V),{setTitle:k}=(0,i.useContext)(s.f),[R,H]=(0,i.useState)(null),[M,N]=(0,i.useState)(null),[B,L]=(0,i.useState)(!1),[T,_]=(0,i.useState)(!1),[O,U]=(0,i.useState)({status:!1,errors:[]}),[K,X]=(0,i.useState)(!1),{setId:G}=(0,i.useContext)(F.X),J=(0,y.cI)({mode:"onChange"}),Q=async e=>{let a=J.getValues("productsConclude");if(p&&R.recebimento.id){e={form:{...e,products:a,prazo:J.getValues("header.prazoSolucao"),data:J.getValues("header.data"),data_:J.getValues("header.data")&&J.getValues("header.data").split("-").reverse().join("/"),hora:J.getValues("header.hora"),transporte:J.getValues("header.transporte"),produto:J.getValues("header.produto")},params:{id:p,usuarioID:b.usuarioID,papelID:b.papelID,unidadeID:C.unidadeID,profissionalID:b.profissionalID}},H(null);try{await v.h.post("".concat(f.pathname,"/conclude"),e),await ee(J.getValues())}catch(o){console.log(o);return}finally{_(!1),L(!B)}}},W=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:b.usuarioID,papelID:b.papelID,unidadeID:C.unidadeID}};try{await v.h.post("".concat(f.pathname,"/reOpen/").concat(p),a),z.ZP.success(q.OD.successUpdate)}catch(o){console.log(o)}finally{L(!B)}},Y=async()=>{try{let e={id:null!=p?p:0,modelID:null!=h?h:0,unidadeID:C.unidadeID},a=await v.h.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData: ",a.data),J.reset(a.data),H(a.data.header),N(a.data.blocos)}catch(o){console.log(o);return}},$=e=>{e.preventDefault();let a=J.getValues();ee(a)},ee=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:b.usuarioID,papelID:b.papelID,unidadeID:C.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",a);try{if("new"===x){let o=await v.h.post("/formularios/limpeza/insertData",a);z.ZP.success("Dados cadastrados com sucesso!"),G(o.data.id),f.push("/formularios/limpeza")}else"edit"===x&&(await v.h.post("/formularios/limpeza/updateData/".concat(p),a),z.ZP.success("Dados atualizados com sucesso!"))}catch(t){console.log(t);return}finally{L(!B)}},ea=()=>{G(R.modelo.id),f.push("/configuracoes/formularios/limpeza/")},eo=[],et={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(w.Z,{}),disabled:!A(f.pathname,"editar"),route:null,type:null,action:W,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};R&&R.status.id>=40&&eo.push(et),(0,E.z)(g,"/configuracoes/formularios")&&eo.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:ea,modal:!1,icon:"bi:gear",identification:null});let ei=()=>{let e={status:!1,errors:[]};J.clearErrors(),(0,P.n9)(J,"header.dataInicio","Data Inicial",e),(0,P.n9)(J,"header.horaInicio","Hora Inicial",e),(0,P.n9)(J,"header.dataFim","Data Final",e),(0,P.n9)(J,"header.horaFim","Hora Final",e),(0,P.n9)(J,"header.setor","Setor",e),(0,P.lz)(J,J.getValues("header.fields"),e),(0,P.IB)(J,J.getValues("blocos"),e);let a=(0,P.FU)(e);(O.status!==a.status||O.errors.length!==a.errors.length)&&U(a)},en=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,i;let n=new FormData;for(let l=0;l<o.length;l++)n.append("files[]",o[l]);n.append("usuarioID",b.usuarioID),n.append("unidadeID",C.unidadeID),n.append("parRecebimentoMpNaoConformidadeModeloBlocoID",null!==(t=a.parRecebimentoMpNaoConformidadeModeloBlocoID)&&void 0!==t?t:null),n.append("itemOpcaoAnexoID",null!==(i=a.itemOpcaoAnexoID)&&void 0!==i?i:null),await ee(J.getValues()),await v.h.post("/formularios/recebimento-mp/nao-conformidade/saveAnexo/".concat(p,"/item/").concat(b.usuarioID,"/").concat(C.unidadeID),n).then(e=>{}).catch(e=>{var a,o,t;z.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!!!")}).finally(()=>{L(!B)})}},el=async e=>{e&&await v.h.delete("/formularios/recebimento-mp/nao-conformidade/deleteAnexo/".concat(p,"/").concat(e.anexoID,"/").concat(C.unidadeID,"/").concat(b.usuarioID,"/item")).then(e=>{let a=J.getValues();ee(a)}).catch(e=>{var a,o,t;z.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")}).finally(()=>{Y()})};return(0,i.useEffect)(()=>{k({icon:"carbon:clean",title:"Limpeza e Higieniza\xe7\xe3o",subtitle:{id:p,count:1,new:!1}}),Y(),setTimeout(()=>{J.trigger()},300)},[B,b]),(0,t.jsx)("form",{onSubmit:e=>$(e),children:R&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Z,{btnNew:"edit"===x,btnCancel:!0,btnSave:(null==R?void 0:null===(a=R.status)||void 0===a?void 0:a.id)<40,btnSend:(null==R?void 0:null===(o=R.status)||void 0===o?void 0:o.id)>=30&&(null==R?void 0:null===(d=R.status)||void 0===d?void 0:d.id)<=40,btnPrint:"edit"==x,btnDelete:(null==R?void 0:null===(u=R.status)||void 0===u?void 0:u.id)<40&&"edit"===x,onclickDelete:()=>X(!0),actionsData:eo,actions:!0,handleSubmit:()=>J.handleSubmit(ee),handleSend(){_(!0),ei()},iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:x,status:null==R?void 0:null===(c=R.status)||void 0===c?void 0:c.id}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(V.Z,{size:"small",HeaderFiel:!0,skin:"light",color:R.status.color,label:R.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(V.Z,{size:"small",HeaderFiel:!0,skin:"light",label:R.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(D,{form:J,data:R,disabled:(null===(m=R.status)||void 0===m?void 0:m.id)>=40}),"edit"===x&&(0,t.jsx)(I,{form:J,data:M,setBlock:N,handleFileSelect:en,handleRemoveFile:el,status:R.status.id,disabled:R.status.id>=40}),(0,t.jsx)(l.Z,{id:p,parFormularioID:4},B)]}),(0,t.jsx)(Z.Z,{openModal:T,handleClose(){_(!1),ei()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:R,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:Q,listErrors:O,canApprove:!0,hasNaoConformidade:!0,type:"limpeza",unity:C,values:null,formularioID:4,modeloID:R.modelo.id,form:J}),(0,t.jsx)(S.Z,{open:K,handleClose:()=>X(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(p),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}})]})})};var k=A},46099:function(e,a,o){o.d(a,{FU:function(){return r},IB:function(){return l},lz:function(){return n},n9:function(){return i}});let t=(e,a,o,t)=>{e.setError(a,{type:"manual",message:"Campo obrigat\xf3rio"}),t.errors.includes(o)||(t.errors.push(o),t.status=!0)},i=(e,a,o,i)=>{let n=e.getValues(a);n||t(e,a,o,i)},n=(e,a,o)=>{a&&Array.isArray(a)&&a.forEach((a,i)=>{let n=a.tabela?"header.fields[".concat(i,"].").concat(a.tabela):"header.fields[".concat(i,"].").concat(a.nomeColuna),l=e.getValues(n);1!==a.obrigatorio||l||t(e,n,a.nomeCampo,o)})},l=(e,a,o)=>{a&&Array.isArray(a)&&a.forEach((a,i)=>{a.itens.forEach((a,n)=>{var l;let r="blocos[".concat(i,"].itens[").concat(n,"].resposta"),s=e.getValues(r);(null==a?void 0:a.obrigatorio)!==1||s||t(e,r,null==a?void 0:a.nome,o);let d=null==a?void 0:a.resposta;(null==d?void 0:d.anexo)===1&&(null==d?void 0:null===(l=d.anexosSolicitados)||void 0===l?void 0:l.length)>0&&d.anexosSolicitados.forEach((l,r)=>{let s="blocos[".concat(i,"].itens[").concat(n,"].resposta.anexosSolicitados[").concat(r,"].anexos"),d=e.getValues(s)||[];1!==l.obrigatorio||d&&0!==d.length||t(e,s,"Anexo: ".concat(null==a?void 0:a.nome," / ").concat(null==l?void 0:l.nome),o)})})})},r=e=>({status:e.status,errors:[...e.errors]})}}]);