"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8871],{14588:function(e,a,o){var i=o(85893),l=o(11163),t=o.n(l),s=o(54225),r=o(1890),n=o(77745),d=o(95398),u=o(76779),c=o(44642),m=o(40039),p=o(79072),x=o(19604),f=o(29630),h=o(67294),v=o(48432),D=o(82555),g=o(83542),b=o(50287),I=o(29308);let j=e=>{var a,o,l,j,C;let{form:Z,title:y,text:z,handleClose:w,openModal:S,conclusionForm:F,info:P,canChange:E,btnCancel:k,btnConfirm:N,register:V,setValue:q,listErrors:A,canApprove:M,hasNaoConformidade:H,control:R,handleSend:O,type:_,unity:T,values:B,errors:L,formularioID:U,modeloID:W}=e;if(!W)return null;let{user:K,hasSectorPermission:X}=(0,h.useContext)(m.V),[G,J]=(0,h.useState)({}),{data:Q}=(0,D.O)(),Y=t();return Y.pathname.split("/")[2],(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(r.Z,{fullWidth:!0,maxWidth:"md",open:S,"aria-labelledby":"form-dialog-title",disableEscapeKeyDown:!0,onClose(e,a){"backdropClick"!==a&&w()},children:[(0,i.jsx)(n.Z,{id:"form-dialog-title",children:(0,i.jsxs)(p.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(p.ZP,{item:!0,xs:12,md:6,children:y}),1===K.papelID&&(0,i.jsx)(p.ZP,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:(0,i.jsx)(g.Z,{data:null!==(a=null==B?void 0:B.departamentos)&&void 0!==a?a:[]})})]})}),(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{sx:{mb:3},children:[!X(null!==(o=null==B?void 0:B.departamentos)&&void 0!==o?o:[])&&(0,i.jsx)(x.Z,{severity:"warning",sx:{mb:4},children:(0,i.jsx)(f.Z,{variant:"body2",children:"Seu departamento n\xe3o est\xe1 habilitado para concluir este formul\xe1rio!"})}),P.status<=40&&(0,i.jsxs)(i.Fragment,{children:[z,A&&A.status&&(0,i.jsxs)(x.Z,{variant:"outlined",severity:"error",sx:{mt:2},children:["Por favor, verifique os campos abaixo:",(0,i.jsx)(f.Z,{variant:"subtitle1",color:"error",sx:{mt:2},children:A.errors.map((e,a)=>(0,i.jsxs)(f.Z,{variant:"body2",color:"error",children:["- ",e]},a))})]}),A&&2==K.papelID&&!A.status&&(0,i.jsx)(x.Z,{severity:"info",sx:{mt:2},children:2==T.quemPreenche&&"fornecedor"==_?"Ap\xf3s concluir o formul\xe1rio, o mesmo ser\xe1 enviado para an\xe1lise e conclus\xe3o da empresa ".concat(null==T?void 0:T.nomeFantasia,"!"):"Ap\xf3s concluir o formul\xe1rio, o mesmo n\xe3o poder\xe1 mais ser alterado!"}),!M&&(0,i.jsx)(x.Z,{severity:"warning",sx:{mt:2},children:"Este formul\xe1rio n\xe3o pode ser aprovado pois possui resposta que gera n\xe3o conformidade!"}),1==K.papelID&&(0,i.jsxs)(p.ZP,{container:!0,spacing:4,sx:{mt:4},children:[(0,i.jsx)(b.Z,{xs:12,md:3,title:"Data da conclus\xe3o",name:"fieldsFooter.dataConclusao",type:"date",value:null!==(l=null==B?void 0:B.dataConclusao)&&void 0!==l?l:new Date,typeValidation:"dataPassado",daysValidation:365,required:!0,form:Z}),(0,i.jsx)(I.Z,{xs:12,md:3,title:"Hora da conclus\xe3o",name:"fieldsFooter.horaConclusao",type:"time",value:null!==(j=null==B?void 0:B.horaConclusao)&&void 0!==j?j:(()=>{let e=new Date,a=e.getHours(),o=e.getMinutes();return"".concat(a,":").concat(o)})(),required:!0,form:Z}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(v.Z,{title:1==K.papelID?"Resultado do Processo":"Observa\xe7\xe3o",name:"status",value:G,form:Z,setResult:J,papelID:K.papelID,hasNaoConformidade:H,options:[{value:70,color:"success",label:"Aprovado",disabled:!M},{value:60,color:"warning",label:"Aprovado Parcial"},{value:50,color:"error",label:"Reprovado"}]})})]})]}),P.status>=40&&P.naoConformidade&&(0,i.jsx)(f.Z,{variant:"body1",sx:{mt:2},children:"Concluir n\xe3o conformidades do formul\xe1rio? Ap\xf3s concluir, o mesmo n\xe3o poder\xe1 mais ser alterado!"})]})}),(0,i.jsx)(u.Z,{className:"dialog-actions-dense",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[k&&(0,i.jsx)(s.Z,{variant:"outlined",color:"primary",onClick:w,children:"Fechar"}),N&&E&&(0,i.jsx)(s.Z,{variant:"contained",disabled:!X(null!==(C=null==B?void 0:B.departamentos)&&void 0!==C?C:[])||P.status<40&&(A&&A.status||1==K.papelID&&!G.status),color:"primary",onClick(){F(G)},children:"Concluir"})]})})]})})};a.Z=j},28871:function(e,a,o){var i=o(85893),l=o(67294),t=o(83830),s=o(87536),r=o(60664),n=o(40039),d=o(65698),u=o(32038),c=o(86501),m=o(11163),p=o(46099),x=o(42222),f=o(14588),h=o(92629),v=o(91757),D=o(71798),g=o(3404),b=o(51239),I=o(72819);let j=e=>{var a,o,j,C,Z,y;let{modelID:z}=e,w=(0,m.useRouter)(),{id:S,setId:F,idNc:P,setModelID:E,setLimpezaID:k}=(0,l.useContext)(t.X),{menu:N,user:V,loggedUnity:q,hasPermission:A}=(0,l.useContext)(n.V),[M,H]=(0,l.useState)(null),[R,O]=(0,l.useState)(null),_=S&&S>0?"edit":"new",T=(0,s.cI)({mode:"onChange"}),[B,L]=(0,l.useState)(!1),[U,W]=(0,l.useState)(!0),[K,X]=(0,l.useState)(!1),[G,J]=(0,l.useState)(!1),[Q,Y]=(0,l.useState)({status:!1,errors:[]}),[$,ee]=(0,l.useState)(!1),ea=(0,g.n)("limpeza",w),eo=async()=>{try{let e={id:null!=S?S:0,modelID:null!=z?z:0,unidadeID:q.unidadeID},a=await r.hi.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData:",a.data),T.reset(a.data),H(a.data.header)}catch(o){console.log(o);return}},ei=e=>{e.preventDefault();let a=T.getValues();el(a)},el=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:V.usuarioID,papelID:V.papelID,unidadeID:q.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",a);try{if("new"===_){let o=await r.hi.post("/formularios/limpeza/insertData",a);c.ZP.success("Dados cadastrados com sucesso!"),F(o.data.id),w.push("/formularios/limpeza")}else"edit"===_&&(await r.hi.post("/formularios/limpeza/updateData/".concat(S),a),c.ZP.success("Dados atualizados com sucesso!"))}catch(i){console.log(i);return}finally{L(!B)}},et=()=>{let e={status:!1,errors:[]};T.clearErrors(),(0,p.n9)(T,"header.dataInicio","Data Inicial",e),(0,p.n9)(T,"header.horaInicio","Hora Inicial",e),(0,p.n9)(T,"header.dataFim","Data Final",e),(0,p.n9)(T,"header.horaFim","Hora Final",e),(0,p.n9)(T,"header.departamento.id","Departamento respons\xe1vel pela limpeza",e),(0,p.n9)(T,"header.setor.id","Setor que foi limpo",e),(0,p.lz)(T,T.getValues("header.fields"),e),(0,p.IB)(T,T.getValues("blocos"),e);let a=(0,p.FU)(e);(Q.status!==a.status||Q.errors.length!==a.errors.length)&&Y(a)},es=async e=>{let a=T.getValues("info.naoConformidade"),o=T.getValues("fieldsFooter");if(S){e={form:{...o,...e,naoConformidade:a},params:{id:S,usuarioID:V.usuarioID,papelID:V.papelID,unidadeID:q.unidadeID,profissionalID:V.profissionalID}},H(null);try{await r.hi.post("".concat(w.pathname,"/conclude"),e),await el(T.getValues())}catch(i){console.log(i);return}finally{X(!1),L(!B),a&&ee(!0)}}},er=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:V.usuarioID,papelID:V.papelID,unidadeID:q.unidadeID}};try{await r.hi.post("".concat(w.pathname,"/reOpen/").concat(S),a),c.ZP.success(D.OD.successUpdate)}catch(o){console.log(o)}finally{L(!B)}},en=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.resposta&&1==e.resposta.bloqueiaFormulario&&(a=!1)})}),W(a)},ed=()=>{F(M.modelo.id),w.push("/configuracoes/formularios/limpeza/")},eu=e=>{console.log("\uD83D\uDE80 ~ handleNewNC: ",M.limpeza.id,e.new.modelo.id),F(M.limpeza.id),k(M.limpeza.id),E(e.new.modelo.id),w.push("/formularios/limpeza/novo/?aba=nao-conformidade")},ec=[],em={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,i.jsx)(v.Z,{}),disabled:!A(w.pathname,"editar"),route:null,type:null,action:er,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null,ncPending:!0};return M&&M.status.id>=40&&ec.push(em),(0,x.z)(N,"/configuracoes/formularios")&&ec.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:ed,modal:!1,icon:"bi:gear",identification:null}),(0,l.useEffect)(()=>{eo(),setTimeout(()=>{T.trigger()},300)},[S,q,B]),(0,i.jsxs)("form",{onSubmit:e=>ei(e),children:[(0,i.jsx)(d.Z,{id:S,btnNew:"edit"===_&&"limpeza"==ea,btnNewModal:1===V.papelID&&"edit"===_&&"limpeza"!=ea,handleNewModal:()=>ee(!0),btnCancel:!0,btnSave:(null==M?void 0:null===(a=M.status)||void 0===a?void 0:a.id)<40,btnSend:(null==M?void 0:null===(o=M.status)||void 0===o?void 0:o.id)>=30&&(null==M?void 0:null===(j=M.status)||void 0===j?void 0:j.id)<=40,btnPrint:"edit"==_,btnDelete:(null==M?void 0:null===(C=M.status)||void 0===C?void 0:C.id)<40&&"edit"===_,onclickDelete:()=>J(!0),actions:"limpeza"==ea,handleSubmit:()=>T.handleSubmit(el),handleSend(){X(!0),et(),en(R)},iconConclusion:"solar:check-read-linear",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:_,status:null==M?void 0:null===(Z=M.status)||void 0===Z?void 0:Z.id,module:"limpeza",actionsData:ec}),(0,i.jsx)(u.Z,{id:S,modelID:z,form:T,header:M,block:R,setBlock:O,defaultTab:"limpeza",onSubmit:el}),(0,i.jsx)(I.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:eu,size:"lg",setOpenModal:ee,openModal:$,form:T,children:(0,i.jsx)(b.Z,{type:"form",data:M,form:T})}),M&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{openModal:K,handleClose(){X(!1),et()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:{status:M.status.id},canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:es,listErrors:Q,canApprove:U,hasNaoConformidade:!0,type:"limpeza",unity:q,values:M,formularioID:4,modeloID:null===(y=M.modelo)||void 0===y?void 0:y.id,form:T}),(0,i.jsx)(h.Z,{open:G,handleClose:()=>J(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(S),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}})]})]})};a.Z=j}}]);