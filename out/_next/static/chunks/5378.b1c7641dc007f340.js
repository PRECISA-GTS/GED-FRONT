"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5378],{24527:function(e,a,o){var l=o(85893),t=o(79072),i=o(49837),n=o(91359),s=o(61953),r=o(29630),d=o(21609),c=o(62097);let u=e=>{let{xs:a,md:o,icon:u,id:m,title:p,subtitle:x,action:h,handleClick:f,linkedsForms:g}=e,D=(0,c.Z)();return(0,l.jsx)(t.ZP,{item:!0,xs:a,md:o,children:(0,l.jsx)(i.Z,{sx:{"&:hover":{backgroundColor:"".concat(D.palette.action.hover)},height:"100%",display:"flex",flexDirection:"column"},onClick:f,className:"cursor-pointer shadow-xl transition-all",children:(0,l.jsx)(n.Z,{className:"text-center",sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,l.jsxs)(s.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{gap:3,padding:6},children:[(0,l.jsx)(d.Z,{icon:u,width:38,className:"text-[#F8D552]"}),(0,l.jsx)(r.Z,{variant:"h6",className:"!font-extrabold",children:p}),(0,l.jsx)(r.Z,{variant:"subtitle2",children:x}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(d.Z,{icon:"new"==h?"icon-park-solid:add-one":"edit"==h?"grommet-icons:form-next-link":"tabler:select",width:16}),(0,l.jsx)(r.Z,{variant:"body2",color:"primary",children:"new"==h?"Criar novo":"edit"==h?"Acessar":"Selecionar"})]}),(e=>{if(!g)return;let a=g.find(a=>a===e);return!a})(m)&&(0,l.jsx)(r.Z,{variant:"body2",color:"error",children:"Formul\xe1rio n\xe3o vinculado"})]})})})})};a.Z=u},91100:function(e,a,o){var l=o(85893);let t=()=>(0,l.jsx)("div",{className:"flex flex-col gap-4",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-[80vh]",children:[(0,l.jsx)("p",{className:"text-3xl font-bold",children:"Nenhum Modelo de Formul\xe1rio cadastrado"}),(0,l.jsx)("p",{className:"opacity-50",children:"Acesse Configura\xe7\xf5es / Modelo de Formul\xe1rio"}),(0,l.jsx)("img",{src:"/empty.svg",alt:"Nenhum formul\xe1rio cadastrado",className:"w-1/2 md:w-1/4"})]})});a.Z=t},28871:function(e,a,o){var l=o(85893),t=o(67294),i=o(83830),n=o(87536),s=o(60664),r=o(40039),d=o(65698),c=o(42567),u=o(86501),m=o(11163),p=o(46099),x=o(42222),h=o(82755),f=o(92629),g=o(91757),D=o(71798),v=o(60565),j=o(3404),b=o(51239),I=o(72819);let y=e=>{var a,o,y,C,Z;let{modelID:z}=e;console.log("HeaderLimpeza");let w=(0,m.useRouter)(),{id:N,setId:S,idNc:F,setModelID:k,setLimpezaID:E}=(0,t.useContext)(i.X),{menu:M,user:V,loggedUnity:P,hasPermission:_}=(0,t.useContext)(r.V),{setTitle:H}=(0,t.useContext)(v.f),[A,q]=(0,t.useState)(null),[L,O]=(0,t.useState)(null),R=N&&N>0?"edit":"new",T=(0,n.cI)({mode:"onChange"}),[B,U]=(0,t.useState)(!1),[X,G]=(0,t.useState)(!0),[J,K]=(0,t.useState)(!1),[Q,W]=(0,t.useState)(!1),[Y,$]=(0,t.useState)({status:!1,errors:[]}),[ee,ea]=(0,t.useState)(!1),eo=(0,j.n)("limpeza",w),el=async()=>{try{let e={id:null!=N?N:0,modelID:null!=z?z:0,unidadeID:P.unidadeID},a=await s.h.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData:",a.data),T.reset(a.data),q(a.data.header),O(a.data.blocos)}catch(o){console.log(o);return}},et=e=>{e.preventDefault();let a=T.getValues();ei(a)},ei=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:V.usuarioID,papelID:V.papelID,unidadeID:P.unidadeID}};try{if("new"===R){let o=await s.h.post("/formularios/limpeza/insertData",a);u.ZP.success("Dados cadastrados com sucesso!"),S(o.data.id),w.push("/formularios/limpeza")}else"edit"===R&&(await s.h.post("/formularios/limpeza/updateData/".concat(N),a),u.ZP.success("Dados atualizados com sucesso!"))}catch(l){console.log(l);return}finally{U(!B)}},en=()=>{let e={status:!1,errors:[]};T.clearErrors(),(0,p.n9)(T,"header.dataInicio","Data Inicial",e),(0,p.n9)(T,"header.horaInicio","Hora Inicial",e),(0,p.n9)(T,"header.dataFim","Data Final",e),(0,p.n9)(T,"header.horaFim","Hora Final",e),(0,p.n9)(T,"header.departamento.id","Departamento respons\xe1vel pela limpeza",e),(0,p.n9)(T,"header.setor.id","Setor que foi limpo",e),(0,p.lz)(T,T.getValues("header.fields"),e),(0,p.IB)(T,T.getValues("blocos"),e);let a=(0,p.FU)(e);(Y.status!==a.status||Y.errors.length!==a.errors.length)&&$(a)},es=async e=>{let a=T.getValues("info.naoConformidade"),o=T.getValues("fieldsFooter");if(N){console.log("\uD83D\uDE80 ~ conclude values:",e={form:{...o,...e,naoConformidade:a},params:{id:N,usuarioID:V.usuarioID,papelID:V.papelID,unidadeID:P.unidadeID,profissionalID:V.profissionalID}}),q(null);try{await s.h.post("".concat(w.pathname,"/conclude"),e),await ei(T.getValues())}catch(l){console.log(l);return}finally{K(!1),U(!B)}}},er=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:V.usuarioID,papelID:V.papelID,unidadeID:P.unidadeID}};try{await s.h.post("".concat(w.pathname,"/reOpen/").concat(N),a),u.ZP.success(D.OD.successUpdate)}catch(o){console.log(o)}finally{U(!B)}},ed=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.resposta&&1==e.resposta.bloqueiaFormulario&&(a=!1)})}),G(a)},ec=()=>{S(A.modelo.id),w.push("/configuracoes/formularios/limpeza/")},eu=e=>{console.log("\uD83D\uDE80 ~ handleNewNC: ",A.limpeza.id,e.new.modelo.id),E(A.limpeza.id),k(e.new.modelo.id),w.push("/formularios/limpeza/novo/?aba=nao-conformidade")},em=[],ep={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,l.jsx)(g.Z,{}),disabled:!_(w.pathname,"editar"),route:null,type:null,action:er,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null,ncPending:!0};return A&&A.status.id>=40&&em.push(ep),(0,x.z)(M,"/configuracoes/formularios")&&em.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:ec,modal:!1,icon:"bi:gear",identification:null}),(0,t.useEffect)(()=>{el(),setTimeout(()=>{T.trigger()},300)},[N,P,B]),console.log("currenttab: ",eo),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("form",{onSubmit:e=>et(e),children:(0,l.jsx)(d.Z,{id:N,btnNew:"edit"===R&&"limpeza"==eo,btnNewModal:1===V.papelID&&"edit"===R&&"limpeza"!=eo,handleNewModal:()=>ea(!0),btnCancel:!0,btnSave:(null==A?void 0:null===(a=A.status)||void 0===a?void 0:a.id)<40,btnSend:(null==A?void 0:null===(o=A.status)||void 0===o?void 0:o.id)>=30&&(null==A?void 0:null===(y=A.status)||void 0===y?void 0:y.id)<=40,btnPrint:"edit"==R,btnDelete:(null==A?void 0:null===(C=A.status)||void 0===C?void 0:C.id)<40&&"edit"===R,onclickDelete:()=>W(!0),actions:"limpeza"==eo,handleSubmit:()=>T.handleSubmit(ei),handleSend(){K(!0),en(),ed(L)},iconConclusion:"solar:check-read-linear",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:R,status:null==A?void 0:null===(Z=A.status)||void 0===Z?void 0:Z.id,module:"limpeza",actionsData:em})}),(0,l.jsx)(c.Z,{id:N,modelID:z,form:T,header:A,block:L,setBlock:O,defaultTab:"limpeza"}),A&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.Z,{openModal:J,handleClose(){K(!1),en()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:{status:A.status.id},canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:es,listErrors:Y,canApprove:X,hasNaoConformidade:!0,type:"limpeza",unity:P,values:A,formularioID:4,modeloID:A.modelo.id,form:T}),(0,l.jsx)(f.Z,{open:Q,handleClose:()=>W(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(N),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,l.jsx)(I.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:eu,size:"lg",setOpenModal:ea,openModal:ee,form:T,children:(0,l.jsx)(b.Z,{type:"form",data:A,form:T})})]})]})};a.Z=y},5378:function(e,a,o){var l=o(85893),t=o(61953),i=o(54225),n=o(79072),s=o(83830),r=o(40039),d=o(21609),c=o(67294),u=o(60664),m=o(11163),p=o.n(m),x=o(24527),h=o(71798),f=o(91100),g=o(28871);let D=()=>{let{loggedUnity:e}=(0,c.useContext)(r.V),{setId:a}=(0,c.useContext)(s.X),[o,m]=(0,c.useState)(null),[D,v]=(0,c.useState)(null),j=p(),b=async()=>{try{let a=await u.h.post("".concat((0,h.g_)(j.pathname),"/getModels"),{unidadeID:e.unidadeID});1===a.data.length?(I(a.data[0].id),m(a.data[0].id)):v(a.data)}catch(o){console.log(o)}},I=e=>{m(e)},y=async e=>{try{I(e)}catch(a){console.log(a)}};return(0,c.useEffect)(()=>{b()},[]),(0,l.jsxs)(l.Fragment,{children:[o&&(0,l.jsx)(g.Z,{modelID:o}),!o&&(0,l.jsxs)(t.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,l.jsx)("div",{children:(0,l.jsx)(i.Z,{onClick(){a(null),j.push((0,h.g_)(j.pathname))},type:"button",variant:"outlined",color:"primary",size:"medium",children:(0,l.jsx)(d.Z,{icon:"grommet-icons:form-previous-link"})})}),D&&0===D.length&&(0,l.jsx)(f.Z,{}),(0,l.jsx)(n.ZP,{container:!0,spacing:4,children:D&&D.length>1&&D.map((e,a)=>(0,l.jsx)(x.Z,{xs:12,md:3,icon:"fluent:form-multiple-48-regular",title:e.nome,action:"new",subtitle:"Ciclo de ".concat(e.ciclo," dias"),handleClick:()=>y(e.id)},a))})]})]})};a.Z=D}}]);