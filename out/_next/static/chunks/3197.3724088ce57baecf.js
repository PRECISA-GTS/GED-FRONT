"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3197],{83197:function(e,a,o){o.d(a,{Z:function(){return W}});var t=o(85893),r=o(67294),l=o(65698),n=o(934),s=o(40039),d=o(60565),i=o(49837),c=o(91359),u=o(79072),m=o(41470),p=o(3893),x=o(22841),h=o(8519);let f=e=>{let{value:a,label:o,disabled:r=!1,errors:l=!1}=e;return(0,t.jsx)(x.Z,{value:a,control:(0,t.jsx)(h.Z,{disabled:r,error:!!l}),label:o,fullWidth:!0,sx:{"& .MuiFormControlLabel-label":{color:"text.secondary"},"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})},b=e=>{let{form:a,data:o,disabled:r}=e;if(!o)return;let l=e=>{a.setValue("header.quemPreenche",e.target.value)};return(0,t.jsxs)(m.Z,{row:!0,name:"header.quemPreenche",defaultValue:o.quemPreenche,onChange:l,children:[(0,t.jsx)("p",{children:"Quem ir\xe1 preencher a n\xe3o conformidade?"}),(0,t.jsxs)(u.ZP,{container:!0,spacing:4,children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(f,{value:"1",label:"F\xe1brica",disabled:r})}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(f,{value:"2",label:"Fornecedor",disabled:r})}),2==a.watch("header.quemPreenche")&&(0,t.jsx)(u.ZP,{item:!0,xs:12,md:8,children:(0,t.jsx)(p.Z,{title:"Fornecedor acessa o Recebimento?",name:"header.fornecedorAcessaRecebimento",value:o.fornecedorAcessaRecebimento,form:a,disabled:r,helpText:"Se marcado, fornecesor poder\xe1 visualizar o formul\xe1rio de recebimento vinculado a esta n\xe3o conformidade."})})]})]})};var D=o(29630),j=o(44373),v=o(75158),g=o(60664);let I=e=>{var a,o,r,l;let{value:n}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Qtd."}),(0,t.jsx)("p",{children:n.quantidade})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Qtd. Entrada"}),(0,t.jsx)("p",{children:n.quantidadeEntrada})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Data Fabrica\xe7\xe3o"}),(0,t.jsx)("p",{children:null!==(o=n.dataFabricacao)&&void 0!==o?o:"--"})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:4,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Apresenta\xe7\xe3o"}),(0,t.jsx)("p",{children:null!==(r=null===(a=n.apresentacao)||void 0===a?void 0:a.nome)&&void 0!==r?r:"--"})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Data de validade"}),(0,t.jsx)("p",{children:null!==(l=n.dataValidade)&&void 0!==l?l:"--"})]})]})},Z=e=>{let{form:a,index:o,produto:l,handleCheck:n,disabled:s,change:d}=e,[i,c]=(0,r.useState)([]),m=async()=>{try{let e=await g.h.get("/cadastros/apresentacao");c(e.data)}catch(a){console.log("\uD83D\uDE80 ~ error:",a)}};return(0,r.useEffect)(()=>{m()},[]),(0,t.jsxs)(u.ZP,{container:!0,sx:{pb:2},children:[(0,t.jsx)("input",{type:"hidden",value:l.produtoID,name:"header.produtos[".concat(o,"].produtoID"),...a.register("header.produtos[".concat(o,"].produtoID"))}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,t.jsx)(x.Z,{control:(0,t.jsx)(v.Z,{onClick:e=>n(e,o),checked:!!l.checked_,disabled:s}),label:"".concat(l.nome," ").concat(l.lote?" - Lote: ".concat(l.lote):" - Lote n\xe3o informado"),size:"small",sx:{marginRight:"4px","&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})}),l.checked_&&(0,t.jsx)(u.ZP,{container:!0,spacing:4,sx:{pb:2},children:(0,t.jsx)(I,{value:l})})]})};var P=o(21609);let y=e=>{let{form:a,data:o,disabled:l}=e;if(!o)return;let[n,s]=(0,r.useState)(o.produtos),d=(e,o)=>{let{checked:t}=e.target;a.setValue("header.produtos[".concat(o,"].checked_"),t);let r=n.map((e,a)=>a===o?{...e,checked_:t}:e);console.log("\uD83D\uDE80 ~ updatedProducts:",r),s(r),a.setValue("header.produtos",r)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(p.Z,{title:"Transporte",name:"header.transporte",value:o.transporte,form:a,disabled:l})}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(p.Z,{title:"Produto",name:"header.produto",value:o.produto,form:a,disabled:l})}),a.watch("header.produto")&&(0,t.jsxs)(u.ZP,{container:!0,sx:{mt:4},children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,children:(0,t.jsxs)(D.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},className:"flex items-center gap-1",children:[(0,t.jsx)(P.Z,{icon:"ph:plant",className:"text-primary"}),"Selecione os produtos com N\xe3o Conformidade"]})}),(0,t.jsx)(u.ZP,{item:!0,xs:12,children:n&&n.map((e,o)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Z,{index:o,produto:e,setProdutos:s,handleCheck:d,disabled:l,form:a},o),o<n.length-1&&(0,t.jsx)(j.Z,{})]}))})]})]})};var C=o(29308),S=o(50287),N=o(12570),w=o(83542);let V=e=>{var a;let{form:o,data:l,disabled:n}=e;if(!l)return;let s=()=>{let e=o.getValues("header.data"),a=parseInt(o.getValues("header.prazoSolucao"),10);if(!e||isNaN(a))return"--";let t=new Date(e+"T00:00:00");t.setDate(t.getDate()+a);let r=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear(),s=new Intl.DateTimeFormat("pt-BR",{weekday:"long"}).format(t),d="".concat(r,"/").concat(l,"/").concat(n," (").concat(s,")");return d};return(0,r.useEffect)(()=>{s()},[o.watch("header.data"),o.watch("header.prazoSolucao")]),(0,t.jsx)(i.Z,{children:(0,t.jsx)(c.Z,{children:(0,t.jsxs)(u.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,t.jsx)(w.Z,{data:null!==(a=null==l?void 0:l.departamentosPreenchimento)&&void 0!==a?a:[]})}),(0,t.jsx)(S.Z,{xs:12,md:3,title:"Data",type:"date",required:!0,name:"header.data",value:l.data,disabled:n,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(C.Z,{xs:12,md:3,title:"Hora",name:"header.hora",type:"time",required:!0,disabled:n,form:o}),(0,t.jsx)(C.Z,{xs:12,md:3,title:"Prazo para a solu\xe7\xe3o (em dias)",name:"header.prazoSolucao",disabled:n,type:"number",form:o,helpText:"Informe o prazo pra solu\xe7\xe3o da n\xe3o conformidade. Ser\xe1 gerado um alerta no vencimento do prazo."}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:3,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Vencimento"}),(0,t.jsx)("p",{children:s()})]}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,t.jsx)(b,{form:o,data:l,disabled:n})}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:12,children:[(0,t.jsx)("p",{children:"N\xe3o Conformidade do Recebimento:"}),(0,t.jsx)(u.ZP,{container:!0,item:!0,xs:12,md:12,children:(0,t.jsx)(y,{form:o,data:l,disabled:n})})]}),(0,t.jsx)(N.Z,{form:o,fields:l.fields,disabled:n})]})})})};var F=o(99734);let M=e=>{let{form:a,data:o,setBlock:r,status:l,disabled:n,handleFileSelect:s,handleRemoveFile:d}=e;return(0,t.jsx)(t.Fragment,{children:o&&o.map((e,i)=>(0,t.jsx)(F.Z,{form:a,index:i,bloco:e,blockKey:"parRecebimentoMpNaoConformidadeModeloBlocoID",setBlocos:r,handleFileSelect:s,handleRemoveAnexoItem:d,status:l,blocos:o,disabled:n}))})};var k=o(87536),z=o(18194),E=o(11163),R=o.n(E),q=o(86501),A=o(6624),T=o(92629),_=o(91757),B=o(83830),Q=o(7071),L=o(71798),O=o(72819),H=o(78432),K=o(42222),J=o(46099);let U=e=>{var a,o,u,m,p,x,h;let f;let{id:b,recebimentoMpID:D,modelID:j}=e,v=R(),I=b&&b>0?"edit":"new",{menu:Z,user:P,loggedUnity:y,hasPermission:C}=(0,r.useContext)(s.V),{setTitle:S}=(0,r.useContext)(d.f),[N,w]=(0,r.useState)(null),[F,E]=(0,r.useState)(null),[U,W]=(0,r.useState)(!1),[X,Y]=(0,r.useState)(!1),[G,$]=(0,r.useState)({status:!1,errors:[]}),[ee,ea]=(0,r.useState)(!1),[eo,et]=(0,r.useState)(!1),{setId:er,setModelID:el,setRecebimentoMpID:en}=(0,r.useContext)(B.X),es=(0,k.cI)({mode:"onChange"}),ed=e=>{let a=!0;return e.forEach(e=>{e.novaQuantidade&&(0,K.JK)(e.novaQuantidade)>(0,K.JK)(e.quantidade)&&(a=!1)}),a},ei=async e=>{let a=es.getValues("productsConclude");if(b&&N.recebimento.id){if(!ed(null!=a?a:[])){q.ZP.error("Quantidade naÌƒo pode ser maior que a quantidade do recebimento de MP!");return}e={form:{...e,products:a,prazo:es.getValues("header.prazoSolucao"),data:es.getValues("header.data"),data_:es.getValues("header.data")&&es.getValues("header.data").split("-").reverse().join("/"),hora:es.getValues("header.hora"),transporte:es.getValues("header.transporte"),produto:es.getValues("header.produto")},params:{id:b,recebimentoMpID:N.recebimento.id,usuarioID:P.usuarioID,papelID:P.papelID,unidadeID:y.unidadeID,profissionalID:P.profissionalID}},w(null);try{await g.h.post("/formularios/recebimento-mp/nao-conformidade/conclude",e),await ep(es.getValues())}catch(o){console.log(o);return}finally{Y(!1),W(!U)}}},ec=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:P.usuarioID,papelID:P.papelID,unidadeID:y.unidadeID}};try{await g.h.post("/formularios/recebimento-mp/nao-conformidade/reOpen/".concat(b),a),q.ZP.success(L.OD.successUpdate)}catch(o){console.log(o)}finally{W(!U)}},eu=async()=>{try{let e={id:null!=b?b:0,modelID:null!=j?j:0,recebimentoMpID:null!=D?D:0,unidadeID:y.unidadeID,papelID:P.papelID},a=await g.h.post("/formularios/recebimento-mp/nao-conformidade/getData",e);204===a.status&&(er(null),v.push("/formularios/recebimento-mp/?aba=nao-conformidade")),console.log("\uD83D\uDE80 ~ getData: ",a.data),es.reset(a.data),w(a.data.header),E(a.data.blocos)}catch(o){console.log(o);return}},em=e=>{e.preventDefault();let a=es.getValues();ep(a)},ep=async e=>{if(!e)return;if(1===P.papelID&&!e.header.transporte&&!e.header.produto){q.ZP.error("Selecione o tipo de n\xe3o conformidade (Transporte ou Produto)!");return}let a=e.header.produtos.some(e=>e.checked_);if(1===P.papelID&&e.header.produto&&!a){q.ZP.error("Selecione pelo menos um produto!");return}console.log("\uD83D\uDE80 ~ onSubmit values:",e);let o={form:e,auth:{usuarioID:P.usuarioID,profissionalID:P.profissionalID,papelID:P.papelID,unidadeID:y.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",o);try{if("new"===I){let t=await g.h.post("/formularios/recebimento-mp/nao-conformidade/insertData",o);q.ZP.success("Dados cadastrados com sucesso!"),er(t.data.id),v.push("/formularios/recebimento-mp/?aba=nao-conformidade")}else"edit"===I&&(await g.h.post("/formularios/recebimento-mp/nao-conformidade/updateData/".concat(b),o),q.ZP.success("Dados atualizados com sucesso!"))}catch(r){console.log(r);return}finally{W(!U)}},ex=()=>{er(N.modelo.id),v.push("/configuracoes/formularios/recebimentomp-naoconformidade/")},eh=()=>{let e=es.getValues("new");en(N.recebimento.id),el(e.modelo.id),v.push("/formularios/recebimento-mp/novo/?aba=nao-conformidade")},ef=[],eb={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(_.Z,{}),disabled:!C(v.pathname,"editar"),route:null,type:null,action:ec,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};1==P.papelID&&N&&N.status.id>=40&&ef.push(eb),1==P.papelID&&(f=!1,Z.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(f=!0)})})}),f)&&ef.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:ex,modal:!1,icon:"bi:gear",identification:null});let eD=()=>{let e={status:!1,errors:[]};es.clearErrors(),(0,J.n9)(es,"header.data","Data",e),(0,J.n9)(es,"header.hora","Hora",e),(0,J.lz)(es,es.getValues("header.fields"),e),(0,J.IB)(es,es.getValues("blocos"),e);let a=(0,J.FU)(e);(G.status!==a.status||G.errors.length!==a.errors.length)&&$(a)},ej=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,r;let l=new FormData;for(let n=0;n<o.length;n++)l.append("files[]",o[n]);l.append("usuarioID",P.usuarioID),l.append("unidadeID",y.unidadeID),l.append("parRecebimentoMpNaoConformidadeModeloBlocoID",null!==(t=a.parRecebimentoMpNaoConformidadeModeloBlocoID)&&void 0!==t?t:null),l.append("itemOpcaoAnexoID",null!==(r=a.itemOpcaoAnexoID)&&void 0!==r?r:null),await ep(es.getValues()),await g.h.post("/formularios/recebimento-mp/nao-conformidade/saveAnexo/".concat(b,"/item/").concat(P.usuarioID,"/").concat(y.unidadeID),l).then(e=>{}).catch(e=>{var a,o,t;q.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")}).finally(()=>{W(!U)})}},ev=async e=>{e&&await g.h.delete("/formularios/recebimento-mp/nao-conformidade/deleteAnexo/".concat(b,"/").concat(e.anexoID,"/").concat(y.unidadeID,"/").concat(P.usuarioID,"/item")).then(e=>{let a=es.getValues();ep(a)}).catch(e=>{var a,o,t;q.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")}).finally(()=>{eu()})};return(0,r.useEffect)(()=>{S({icon:"typcn:warning-outline",title:"N\xe3o conformidade do Recebimento de MP",subtitle:{id:b,count:1,new:!1}}),eu(),setTimeout(()=>{es.trigger()},300)},[U,P]),(0,t.jsx)("form",{onSubmit:e=>em(e),children:N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{btnNewModal:1===P.papelID&&"edit"===I,handleNewModal:()=>ea(!0),btnCancel:!0,btnSave:(null==N?void 0:null===(a=N.status)||void 0===a?void 0:a.id)<40,btnSend:1===P.papelID&&(null==N?void 0:null===(o=N.status)||void 0===o?void 0:o.id)>=30&&(null==N?void 0:null===(u=N.status)||void 0===u?void 0:u.id)<=40||2===P.papelID&&(null==N?void 0:null===(m=N.status)||void 0===m?void 0:m.id)===30,btnPrint:"edit"==I,btnDelete:1===P.papelID&&(null==N?void 0:null===(p=N.status)||void 0===p?void 0:p.id)<40&&"edit"===I,onclickDelete:()=>et(!0),actionsData:ef,actions:1===P.papelID,handleSubmit:()=>es.handleSubmit(ep),handleSend(){Y(!0),eD()},iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"N\xe3o conformidade do Recebimento de MP",type:I,status:null==N?void 0:null===(x=N.status)||void 0===x?void 0:x.id}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(Q.Z,{size:"small",HeaderFiel:!0,skin:"light",color:N.status.color,label:N.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(Q.Z,{size:"small",HeaderFiel:!0,skin:"light",label:N.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(i.Z,{children:(0,t.jsx)(c.Z,{className:"space-y-2 ",children:(0,t.jsx)(z.Z,{data:N})})}),(0,t.jsx)(V,{form:es,data:N,disabled:(null===(h=N.status)||void 0===h?void 0:h.id)>=40||1!=P.papelID}),"edit"===I&&(0,t.jsx)(M,{form:es,data:F,setBlock:E,handleFileSelect:ej,handleRemoveFile:ev,status:N.status.id,disabled:N.status.id>=40||N.fornecedorAcessaRecebimento&&1===P.papelID}),(0,t.jsx)(n.Z,{id:b,parFormularioID:3},U)]}),(0,t.jsx)(A.Z,{openModal:X,handleClose(){Y(!1)},title:"Concluir N\xe3o Conformidade do Recebimento de MP",text:"Deseja realmente concluir este formul\xe1rio?",status:N.status.id,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ei,type:"recebimentoMpNaoConformidade",listErrors:G,unity:y,values:null,formularioID:3,modeloID:N.modelo.id,produtos:es.getValues("header.produtos"),form:es,departamentos:N.departamentosConclusao}),(0,t.jsx)(T.Z,{open:eo,handleClose:()=>et(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(b),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,t.jsx)(O.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:eh,size:"lg",setOpenModal:ea,openModal:ee,children:(0,t.jsx)(H.Z,{type:"form",data:N,form:es})})]})})};var W=U}}]);