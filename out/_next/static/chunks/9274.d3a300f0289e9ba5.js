"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9274],{29274:function(e,t,i){var s=i(85893),a=i(11163),o=i.n(a),l=i(67294),n=i(60664),r=i(49837),d=i(91359),u=i(79072),c=i(80562),p=i(54225),f=i(87536),m=i(86501),v=i(45061),x=i(86887),h=i(64165),D=i(60565),g=i(83830),I=i(40039),j=i(29308),Z=i(50287),S=i(41088),b=i(21609),w=i(67569),y=i(84220);let C=e=>{var t,i,a;let{id:C}=e,[P,F]=(0,l.useState)(!1),[N,O]=(0,l.useState)(null),{setId:T}=(0,l.useContext)(g.X),k=o(),M=C&&C>0?"edit":"new",q=k.pathname,{title:A}=(0,l.useContext)(D.f),{loggedUnity:E,user:_,setUser:U}=(0,l.useContext)(I.V),{startLoading:z,stopLoading:L}=(0,S.Z)(),[V,Y]=(0,l.useState)([]),J=new Date().toISOString().substring(0,10),{trigger:W,handleSubmit:B,reset:H,setValue:Q,control:R,formState:{errors:X},register:G}=(0,f.cI)({mode:"onChange"}),K=e=>{let t=!!e.fields.profissionais.find(e=>e.profissional.id===_.profissionalID&&(!e.dataFim||""==e.dataFim||null==e.dataFim||"0000-00-00"==e.dataFim)),i=!!_.setores.find(e=>e.id===C);t&&!i?(U({..._,setores:[..._.setores,{id:e.fields.setorID,nome:e.fields.nome}]}),localStorage.setItem("userData",JSON.stringify({..._,setores:[..._.setores,{id:e.fields.setorID,nome:e.fields.nome}]}))):!t&&i&&(U({..._,setores:_.setores.filter(e=>e.id!==C)}),localStorage.setItem("userData",JSON.stringify({..._,setores:_.setores.filter(e=>e.id!==C)})))},$=async e=>{let t={...e,usuarioID:_.usuarioID,unidadeID:E.unidadeID};if(!ee(e)){m.ZP.error("N\xe3o \xe9 permitido repetir profissional ativo em um setor!");return}K(t);try{"new"===M?await n.h.post("cadastros/setor/new/insertData",t).then(e=>{k.push("".concat((0,h.g_)(q))),T(e.data.id),m.ZP.success(h.OD.successNew)}):"edit"===M&&(await n.h.post("".concat(q,"/updateData/").concat(C),t),m.ZP.success(h.OD.successUpdate))}catch(i){i.response&&409===i.response.status?m.ZP.error(h.OD.errorRepeated):console.log(i)}finally{L()}},ee=e=>{let t=!0;return e.fields.profissionais.length>1&&e.fields.profissionais.map((i,s)=>{e.fields.profissionais.map((e,a)=>{s===a||i.profissional.id!==e.profissional.id||i.dataFim||e.dataFim||(t=!1)})}),t},et=async()=>{try{await n.h.delete("".concat(q,"/").concat(C,"/").concat(_.usuarioID,"/").concat(E.unidadeID)),T(null),F(!1),m.ZP.success(h.OD.successDelete)}catch(e){e.response&&409===e.response.status?(m.ZP.error(h.OD.pendingDelete),F(!1)):console.log(e)}},ei=async()=>{try{if("edit"===M){let e=await n.h.post("".concat(q,"/getData/").concat(C),{id:C});O(e.data),H(e.data)}else O({fields:{nome:"",status:1,profissionais:[]}}),H({...N,fields:{...N.fields}})}catch(t){console.log(t)}},es=async()=>{let e=await n.h.get("/cadastros/profissional?unidadeID=".concat(E.unidadeID,"&papelID=").concat(E.papelID)),t=e.data.filter(e=>1===e.statusID);Y(t)};(0,l.useEffect)(()=>{ei(),es(),setTimeout(()=>{W()},300)},[C]);let{fields:ea,append:eo,remove:el}=(0,f.Dq)({control:R,name:"fields.profissionais"});return(0,s.jsxs)(s.Fragment,{children:[N&&(0,s.jsxs)("form",{onSubmit:B($),children:[(0,s.jsx)(x.Z,{btnCancel:!0,btnNew:!0,btnSave:!0,handleSubmit:()=>B($),btnDelete:"edit"===M,onclickDelete:()=>F(!0),type:M}),(0,s.jsx)(r.Z,{children:(0,s.jsx)(d.Z,{children:(0,s.jsxs)(u.ZP,{container:!0,spacing:5,children:[(0,s.jsx)(j.Z,{xs:12,md:11,title:"Nome",name:"fields.nome",required:!0,control:R,errors:null==X?void 0:null===(t=X.fields)||void 0===t?void 0:t.nome}),(0,s.jsx)(w.Z,{xs:1,md:1,title:"Ativo",name:"fields.status",value:null==N?void 0:null===(i=N.fields)||void 0===i?void 0:i.status,typePage:M,register:G}),(0,s.jsx)(u.ZP,{item:!0,xs:12,children:(0,s.jsxs)("div",{className:"flex items-center gap-2 pb-1 pt-2",children:[(0,s.jsx)("div",{className:"",children:(0,s.jsx)(b.Z,{icon:"material-symbols:engineering-outline",className:"text-3xl"})}),(0,s.jsx)("div",{className:"flex flex-col gap-0",children:(0,s.jsx)("p",{className:"text-xl",children:"Profissionais"})})]})}),ea.map((e,t)=>{var i,o,n,r,d,p,f,m,v,x,h,D,g,I,j;return(0,s.jsxs)(l.Fragment,{children:[(0,s.jsx)("input",{type:"hidden",name:"fields.profissionais[".concat(t,"].id"),value:e.id}),(0,s.jsx)(y.Z,{xs:12,md:7,title:"Profissional",name:"fields.profissionais[".concat(t,"].profissional"),value:null==N?void 0:null===(i=N.fields)||void 0===i?void 0:null===(o=i.profissionais)||void 0===o?void 0:null===(n=o[t])||void 0===n?void 0:n.profissional,required:!0,options:null!=V?V:[],register:G,setValue:Q,control:R,errors:null==X?void 0:null===(r=X.fields)||void 0===r?void 0:null===(d=r.profissionais)||void 0===d?void 0:null===(p=d[t])||void 0===p?void 0:p.profissional,opacity:0===e.status}),(0,s.jsx)(Z.Z,{xs:12,md:2,title:"Data In\xedcio",name:"fields.profissionais[".concat(t,"].dataInicio"),value:null!==(a=null==N?void 0:null===(f=N.fields)||void 0===f?void 0:null===(m=f.profissionais)||void 0===m?void 0:null===(v=m[t])||void 0===v?void 0:v.dataInicio)&&void 0!==a?a:J,required:!0,register:G,control:R,errors:null==X?void 0:null===(x=X.fields)||void 0===x?void 0:null===(h=x.profissionais)||void 0===h?void 0:null===(D=h[t])||void 0===D?void 0:D.dataInicio,opacity:0===e.status}),(0,s.jsx)(Z.Z,{xs:12,md:2,title:"Data Fim",name:"fields.profissionais[".concat(t,"].dataFim"),value:null==N?void 0:null===(g=N.fields)||void 0===g?void 0:null===(I=g.profissionais)||void 0===I?void 0:null===(j=I[t])||void 0===j?void 0:j.dataFim,register:G,control:R,opacity:0===e.status}),(0,s.jsx)(u.ZP,{item:!0,xs:12,md:1,className:"flex items-center",children:(0,s.jsx)(c.Z,{color:"error",size:"small",onClick:()=>el(t),children:(0,s.jsx)(b.Z,{icon:"tabler:trash-filled"})})})]},e.id)}),(0,s.jsx)(u.ZP,{item:!0,xs:12,children:(0,s.jsx)(p.Z,{variant:"outlined",color:"primary",onClick(){eo({id:null,dataInicio:new Date}),W()},startIcon:(0,s.jsx)(b.Z,{icon:"material-symbols:add-circle-outline-rounded"}),children:"Inserir Profissional"})})]})})})]}),(0,s.jsx)(v.Z,{text:"Tem certeza que deseja excluir?",title:"Excluir "+A.title,openModal:P,handleClose:()=>F(!1),handleSubmit:et,btnCancel:!0,btnConfirm:!0})]})};t.Z=C},50287:function(e,t,i){var s=i(85893),a=i(79072),o=i(55343),l=i(67836),n=i(87536),r=i(62097),d=i(67294),u=i(64165);let c=e=>{let{xs:t,md:i,title:c,required:p,disabled:f,type:m,value:v,name:x,typeValidation:h,errors:D,alertRequired:g,control:I,opacity:j}=e,Z=(0,r.Z)(),[S,b]=(0,d.useState)({}),[w,y]=(0,d.useState)(null);(0,d.useEffect)(()=>{h&&v&&P(h,x,v)},[h,v,x]);let C=e=>{let t=new Date(e+"T00:00:00"),i=t.getUTCDate().toString().padStart(2,"0"),s=(t.getUTCMonth()+1).toString().padStart(2,"0"),a=t.getUTCFullYear();return"".concat(a,"-").concat(s,"-").concat(i)},P=(e,t,i,s)=>{let a=new Date(i+"T00:00:00"),o=(0,u.HD)(e,a,s);b(e=>({...e,[t]:o}))},F=e=>{let t=new Date,i=new Date(e+"T00:00:00");return"dataAtual"===h&&i.toDateString()!==t.toDateString()?(y("A data deve ser a data atual"),!1):"dataPassado"===h&&i>=t?(y("A data deve ser do passado"),!1):"dataFutura"===h&&i<=t?(y("A data deve ser do futuro"),!1):(y(null),!0)};return(0,s.jsx)(a.ZP,{item:!0,xs:t,md:i,sx:{my:1},children:(0,s.jsx)(o.Z,{fullWidth:!0,children:(0,s.jsx)(n.Qr,{name:x,control:I,rules:{required:p},render(e){let{field:t}=e;return(0,s.jsx)(l.Z,{type:null!=m?m:"date",size:"small",label:c,disabled:!!f,defaultValue:v?C(v):"",error:!!D||!!w,helperText:w,onChange(e){let i=e.target.value;F(i)&&(t.onChange(i),h&&P(h,x,i))},variant:"outlined",fullWidth:!0,InputLabelProps:{shrink:!0},inputProps:{min:"dataFutura"===h?new Date().toISOString().split("T")[0]:void 0,max:"dataPassado"===h?new Date().toISOString().split("T")[0]:new Date(new Date().setFullYear(new Date().getFullYear()+50)).toISOString().split("T")[0]},sx:{opacity:j?.4:1,"& .MuiInputBase-input":{padding:"10px 14px"},...g&&!(null==t?void 0:t.value)&&{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:Z.palette.error.main},"&:hover fieldset":{borderColor:Z.palette.error.main},"&.Mui-focused fieldset":{borderColor:Z.palette.error.main}},"& .MuiInputLabel-root":{color:Z.palette.error.main},"& .MuiInputLabel-root.Mui-focused":{color:Z.palette.error.main}}}})}})})})};t.Z=c}}]);