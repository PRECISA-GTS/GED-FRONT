"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2815],{4665:function(e,a,o){o.d(a,{Z:function(){return M}});var t=o(85893),i=o(67294),l=o(65698),s=o(934),n=o(40039),r=o(60565),d=o(49837),u=o(91359),c=o(79072),m=o(29308),p=o(50287),h=o(12570),x=o(83542),f=o(84220),D=o(60664),v=o(3893);let g=e=>{var a;let{form:o,data:l,disabled:s}=e,{loggedUnity:r}=(0,i.useContext)(n.V),[g,I]=(0,i.useState)([]),[b,j]=(0,i.useState)([]),[z,y]=(0,i.useState)([]),[Z,C]=(0,i.useState)([]),[S,F]=(0,i.useState)([]),[w,q]=(0,i.useState)([]),[P,V]=(0,i.useState)([]),[N,E]=(0,i.useState)([]);if(!l)return;let k=async()=>{try{if(!r)return;let e=await D.h.post("/cadastros/departamento",{unidadeID:r.unidadeID});I(e.data)}catch(a){console.log(a)}},M=async()=>{try{if(!r)return;let e=await D.h.post("/cadastros/profissional/getProfissionais",{unidadeID:r.unidadeID});j(e.data),L(null==l?void 0:l.departamento,e.data,!1)}catch(a){console.log(a)}},H=async()=>{try{if(!r)return;let e=await D.h.post("/cadastros/setor/getSetores",{unidadeID:r.unidadeID});C(e.data)}catch(a){console.log(a)}},T=async()=>{try{if(!r)return;let e=await D.h.post("/cadastros/equipamento/getEquipamentos",{unidadeID:r.unidadeID});F(e.data),R(null==l?void 0:l.setor,e.data,!1)}catch(a){console.log(a)}},A=async()=>{try{if(!r)return;let e=await D.h.post("/cadastros/produto/getProdutosLimpeza",{unidadeID:r.unidadeID});V(e.data)}catch(a){console.log(a)}},B=async()=>{try{if(!r)return;let e=await D.h.post("/formularios/fornecedor/getFornecedoresPrestadorServico",{unidadeID:r.unidadeID});E(e.data)}catch(a){console.log(a)}},L=(e,a,t)=>{let i=a.filter(a=>{if(a.departamentos){let o=a.departamentos.split(",").map(Number);return o.includes(null==e?void 0:e.id)}return!1});y(i),t&&o.setValue("header.profissional",null)},R=(e,a,t)=>{let i=a.filter(a=>{if(a.setores){let o=a.setores.split(",").map(Number);return o.includes(null==e?void 0:e.id)}return!1});q(i),t&&o.setValue("header.equipamentos",[])};return(0,i.useEffect)(()=>{k(),M(),H(),T(),A(),B()},[r]),(0,t.jsx)(d.Z,{children:(0,t.jsx)(u.Z,{children:(0,t.jsxs)(c.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,t.jsx)(x.Z,{data:null!==(a=null==l?void 0:l.departamentosPreenchimento)&&void 0!==a?a:[]})}),(0,t.jsx)(p.Z,{xs:12,md:2,title:"Data Inicial",type:"date",required:!0,name:"header.dataInicio",value:l.dataInicio,disabled:s,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(m.Z,{xs:12,md:2,title:"Hora Inicial",name:"header.horaInicio",type:"time",required:!0,disabled:s,form:o}),(0,t.jsx)(p.Z,{xs:12,md:2,title:"Data Final",type:"date",required:!0,name:"header.dataFim",value:l.dataFim,disabled:s,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(m.Z,{xs:12,md:2,title:"Hora Final",name:"header.horaFim",type:"time",required:!0,disabled:s,form:o}),(0,t.jsx)(v.Z,{xs:6,md:4,title:"Prestador de servi\xe7o",name:"header.prestadorServico",value:l.prestadorServico,form:o,disabled:s,helpText:"Limpeza realizada por uma empresa terceira"}),o.getValues("header.prestadorServico")&&(0,t.jsx)(f.Z,{xs:12,md:4,title:"Fornecedor prestador de servi\xe7o",name:"header.fornecedor",value:null==l?void 0:l.fornecedor,options:null!=N?N:[],disabled:s,form:o,helpText:"Todos os fornecedor ativos prestadores de serviço"}),!o.getValues("header.prestadorServico")&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Z,{xs:12,md:4,title:"Departamento respons\xe1vel pela limpeza",name:"header.departamento",onChange:e=>L(e,b,!0),disabled:s,required:!0,value:null==l?void 0:l.departamento,options:null!=g?g:[],form:o}),(0,t.jsx)(f.Z,{xs:12,md:4,title:"Profissional respons\xe1vel pela limpeza",name:"header.profissional",disabled:s,value:null==l?void 0:l.profissional,options:null!=z?z:[],form:o})]}),(0,t.jsx)(c.ZP,{item:!0,md:o.watch("header.prestadorServico")?8:4}),(0,t.jsx)(f.Z,{xs:12,md:4,title:"Setor que foi limpo",name:"header.setor",value:null==l?void 0:l.setor,disabled:s,onChange:e=>R(e,S,!0),required:!0,options:null!=Z?Z:[],form:o,helpText:"Setor que foi limpo pelo profissional respons\xe1vel pela limpeza"}),(0,t.jsx)(f.Z,{xs:12,md:4,title:"Equipamento(s) que foram limpos",name:"header.equipamentos",value:null==l?void 0:l.equipamentos,disabled:s,multiple:!0,options:null!=w?w:[],form:o,helpText:"Equipamentos que foram limpos pelo profissional respons\xe1vel pela limpeza"}),(0,t.jsx)(c.ZP,{item:!0,md:4}),(0,t.jsx)(f.Z,{xs:12,md:4,title:"Produtos utilizados",name:"header.produtos",disabled:s,value:null==l?void 0:l.produtos,multiple:!0,helpText:"Produtos que foram utilizados pra realizar a limpeza do setor",options:null!=P?P:[],form:o}),(0,t.jsx)(v.Z,{xs:6,md:2,title:"Limpeza",name:"header.limpeza",value:l.limpeza,checked:!0,form:o,disabled:!0}),(0,t.jsx)(v.Z,{xs:6,md:2,title:"Higieniza\xe7\xe3o",name:"header.higienizacao",value:l.higienizacao,form:o,disabled:s}),(0,t.jsx)(h.Z,{form:o,fields:l.fields,disabled:s})]})})})};var I=o(99734);let b=e=>{let{form:a,data:o,setBlock:i,status:l,disabled:s,handleFileSelect:n,handleRemoveFile:r}=e;return(0,t.jsx)(t.Fragment,{children:o&&o.map((e,d)=>(0,t.jsx)(I.Z,{form:a,index:d,bloco:e,blockKey:"parRecebimentoMpNaoConformidadeModeloBlocoID",setBlocos:i,handleFileSelect:n,handleRemoveAnexoItem:r,status:l,blocos:o,disabled:s}))})};var j=o(87536),z=o(11163),y=o.n(z),Z=o(86501),C=o(82755),S=o(92629),F=o(91757),w=o(83830),q=o(7071),P=o(71798),V=o(42222),N=o(46099),E=o(26526);let k=e=>{var a,o,d,u,c,m,p;let{id:h,modelID:x}=e,f=y(),v=h&&h>0?"edit":"new",{menu:I,user:z,loggedUnity:k,hasPermission:M}=(0,i.useContext)(n.V),{setTitle:H}=(0,i.useContext)(r.f),[T,A]=(0,i.useState)(null),[B,L]=(0,i.useState)(null),[R,O]=(0,i.useState)(!1),[_,K]=(0,i.useState)(!0),[U,Q]=(0,i.useState)(!1),[J,X]=(0,i.useState)({status:!1,errors:[]}),[W,Y]=(0,i.useState)(!1),{setId:G}=(0,i.useContext)(w.X),$=(0,j.cI)({mode:"onChange"}),ee=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.resposta&&1==e.resposta.bloqueiaFormulario&&(a=!1)})}),K(a)},ea=async e=>{let a=$.getValues("info.naoConformidade"),o=$.getValues("fieldsFooter");if(h){console.log("\uD83D\uDE80 ~ conclude values:",e={form:{...o,...e,naoConformidade:a},params:{id:h,usuarioID:z.usuarioID,papelID:z.papelID,unidadeID:k.unidadeID,profissionalID:z.profissionalID}}),A(null);try{await D.h.post("".concat(f.pathname,"/conclude"),e),await el($.getValues())}catch(t){console.log(t);return}finally{Q(!1),O(!R)}}},eo=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:z.usuarioID,papelID:z.papelID,unidadeID:k.unidadeID}};try{await D.h.post("".concat(f.pathname,"/reOpen/").concat(h),a),Z.ZP.success(P.OD.successUpdate)}catch(o){console.log(o)}finally{O(!R)}},et=async()=>{try{let e={id:null!=h?h:0,modelID:null!=x?x:0,unidadeID:k.unidadeID},a=await D.h.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData: ",a.data),$.reset(a.data),A(a.data.header),L(a.data.blocos)}catch(o){console.log(o);return}},ei=e=>{e.preventDefault();let a=$.getValues();el(a)},el=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:z.usuarioID,papelID:z.papelID,unidadeID:k.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",a);try{if("new"===v){let o=await D.h.post("/formularios/limpeza/insertData",a);Z.ZP.success("Dados cadastrados com sucesso!"),G(o.data.id),f.push("/formularios/limpeza")}else"edit"===v&&(await D.h.post("/formularios/limpeza/updateData/".concat(h),a),Z.ZP.success("Dados atualizados com sucesso!"))}catch(t){console.log(t);return}finally{O(!R)}},es=()=>{G(T.modelo.id),f.push("/configuracoes/formularios/limpeza/")},en=[],er={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(F.Z,{}),disabled:!M(f.pathname,"editar"),route:null,type:null,action:eo,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null,ncPending:!0};T&&T.status.id>=40&&en.push(er),(0,V.z)(I,"/configuracoes/formularios")&&en.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:es,modal:!1,icon:"bi:gear",identification:null});let ed=()=>{let e={status:!1,errors:[]};$.clearErrors(),(0,N.n9)($,"header.dataInicio","Data Inicial",e),(0,N.n9)($,"header.horaInicio","Hora Inicial",e),(0,N.n9)($,"header.dataFim","Data Final",e),(0,N.n9)($,"header.horaFim","Hora Final",e),(0,N.n9)($,"header.departamento.id","Departamento respons\xe1vel pela limpeza",e),(0,N.n9)($,"header.setor.id","Setor que foi limpo",e),(0,N.lz)($,$.getValues("header.fields"),e),(0,N.IB)($,$.getValues("blocos"),e);let a=(0,N.FU)(e);(J.status!==a.status||J.errors.length!==a.errors.length)&&X(a)},eu=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,i;let l=new FormData;for(let s=0;s<o.length;s++)l.append("files[]",o[s]);l.append("usuarioID",z.usuarioID),l.append("unidadeID",k.unidadeID),l.append("parRecebimentoMpNaoConformidadeModeloBlocoID",null!==(t=a.parRecebimentoMpNaoConformidadeModeloBlocoID)&&void 0!==t?t:null),l.append("itemOpcaoAnexoID",null!==(i=a.itemOpcaoAnexoID)&&void 0!==i?i:null),await el($.getValues()),await D.h.post("/formularios/recebimento-mp/nao-conformidade/saveAnexo/".concat(h,"/item/").concat(z.usuarioID,"/").concat(k.unidadeID),l).then(e=>{}).catch(e=>{var a,o,t;Z.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!!!")}).finally(()=>{O(!R)})}},ec=async e=>{e&&await D.h.delete("/formularios/recebimento-mp/nao-conformidade/deleteAnexo/".concat(h,"/").concat(e.anexoID,"/").concat(k.unidadeID,"/").concat(z.usuarioID,"/item")).then(e=>{let a=$.getValues();el(a)}).catch(e=>{var a,o,t;Z.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")}).finally(()=>{et()})};return(0,i.useEffect)(()=>{H({icon:"carbon:clean",title:"Limpeza e Higieniza\xe7\xe3o",subtitle:{id:h,count:1,new:!1}}),et(),setTimeout(()=>{$.trigger()},300)},[R,z]),(0,t.jsx)("form",{onSubmit:e=>ei(e),children:T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{id:h,btnNew:"edit"===v,btnCancel:!0,btnSave:(null==T?void 0:null===(a=T.status)||void 0===a?void 0:a.id)<40,btnSend:(null==T?void 0:null===(o=T.status)||void 0===o?void 0:o.id)>=30&&(null==T?void 0:null===(d=T.status)||void 0===d?void 0:d.id)<=40,btnPrint:"edit"==v,btnDelete:(null==T?void 0:null===(u=T.status)||void 0===u?void 0:u.id)<40&&"edit"===v,onclickDelete:()=>Y(!0),actions:!0,handleSubmit:()=>$.handleSubmit(el),handleSend(){Q(!0),ed(),ee(B)},iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:v,status:null==T?void 0:null===(c=T.status)||void 0===c?void 0:c.id,actionsNC:(null==T?void 0:T.naoConformidade)&&(null==T?void 0:null===(m=T.status)||void 0===m?void 0:m.id)>40,module:"limpeza",actionsData:en}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(q.Z,{size:"small",HeaderFiel:!0,skin:"light",color:T.status.color,label:T.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(q.Z,{size:"small",HeaderFiel:!0,skin:"light",label:T.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(E.Z,{description:T.modelo.cabecalho}),(0,t.jsx)(g,{form:$,data:T,disabled:(null===(p=T.status)||void 0===p?void 0:p.id)>=40}),"edit"===v&&(0,t.jsx)(b,{form:$,data:B,setBlock:L,handleFileSelect:eu,handleRemoveFile:ec,status:T.status.id,disabled:T.status.id>=40}),(0,t.jsx)(s.Z,{id:h,parFormularioID:4},R)]}),(0,t.jsx)(C.Z,{openModal:U,handleClose(){Q(!1),ed()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:{status:T.status.id},canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ea,listErrors:J,canApprove:_,hasNaoConformidade:!0,type:"limpeza",unity:k,values:T,formularioID:4,modeloID:T.modelo.id,form:$}),(0,t.jsx)(S.Z,{open:W,handleClose:()=>Y(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(h),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}})]})})};var M=k},5418:function(e,a,o){o.d(a,{Z:function(){return O}});var t=o(85893),i=o(67294),l=o(65698),s=o(934),n=o(40039),r=o(60565),d=o(49837),u=o(91359),c=o(79072),m=o(29630),p=o(44373),h=o(22841),x=o(75158),f=o(29308);let D=e=>{let{form:a,index:o,value:i,handleCheck:l,disabled:s,change:n}=e;return(0,t.jsxs)(c.ZP,{container:!0,sx:{pb:2},children:[(0,t.jsx)("input",{type:"hidden",value:i.equipamentoID,name:"header.equipamentos[".concat(o,"].equipamentoID"),...a.register("header.equipamentos[".concat(o,"].equipamentoID"))}),(0,t.jsx)(c.ZP,{item:!0,xs:12,md:12,children:(0,t.jsx)(h.Z,{control:(0,t.jsx)(x.Z,{onClick:e=>l(e,o),checked:!!i.checked_,disabled:s}),label:"".concat(i.nome),size:"small",sx:{marginRight:"4px","&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})}),i.checked_&&(0,t.jsx)(c.ZP,{container:!0,spacing:4,sx:{py:2},children:(0,t.jsx)(f.Z,{xs:12,md:12,title:"Descri\xe7\xe3o da N\xe3o Conformidade do equipamento",name:"header.equipamentos[".concat(o,"].descricao"),form:a,multiline:!0,rows:3})})]})};var v=o(21609),g=o(87536);let I=e=>{let{form:a,data:o,disabled:l}=e;if(!o)return;let[s,n]=(0,i.useState)(o.equipamentos),{fields:r,update:d}=(0,g.Dq)({control:a.control,name:"header.equipamentos"}),u=(e,o)=>{let{checked:t}=e.target;a.setValue("header.equipamentos[".concat(o,"].checked_"),t),d(o,{...r[o],checked_:t})};return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(c.ZP,{container:!0,sx:{mt:4},children:[(0,t.jsx)(c.ZP,{item:!0,xs:12,children:(0,t.jsxs)(m.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},className:"flex items-center gap-1",children:[(0,t.jsx)(v.Z,{icon:"game-icons:manual-meat-grinder",className:"text-primary"}),"Selecione os equipamentos com N\xe3o Conformidade"]})}),(0,t.jsx)(c.ZP,{item:!0,xs:12,children:r&&r.map((e,o)=>(0,t.jsxs)(i.Fragment,{children:[(0,t.jsx)(D,{index:o,value:e,setEquipment:n,handleCheck:u,disabled:l,form:a},o),o<r.length-1&&(0,t.jsx)(p.Z,{})]},e.id))})]})})};var b=o(50287),j=o(12570),z=o(83542);let y=e=>{var a;let{form:o,data:l,disabled:s}=e;if(!l)return;let n=()=>{let e=o.getValues("header.data"),a=parseInt(o.getValues("header.prazoSolucao"),10);if(!e||isNaN(a))return"--";let t=new Date(e+"T00:00:00");t.setDate(t.getDate()+a);let i=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear(),n=new Intl.DateTimeFormat("pt-BR",{weekday:"long"}).format(t),r="".concat(i,"/").concat(l,"/").concat(s," (").concat(n,")");return r};return(0,i.useEffect)(()=>{n()},[o.watch("header.data"),o.watch("header.prazoSolucao")]),(0,t.jsx)(d.Z,{children:(0,t.jsx)(u.Z,{children:(0,t.jsxs)(c.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,t.jsx)(c.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,t.jsx)(z.Z,{data:null!==(a=null==l?void 0:l.departamentosPreenchimento)&&void 0!==a?a:[]})}),(0,t.jsx)(b.Z,{xs:12,md:3,title:"Data",type:"date",required:!0,name:"header.data",value:l.data,disabled:s,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(f.Z,{xs:12,md:3,title:"Hora",name:"header.hora",type:"time",required:!0,disabled:s,form:o}),(0,t.jsx)(f.Z,{xs:12,md:3,title:"Prazo para a solu\xe7\xe3o (em dias)",name:"header.prazoSolucao",disabled:s,type:"number",form:o,helpText:"Informe o prazo pra solu\xe7\xe3o da n\xe3o conformidade. Ser\xe1 gerado um alerta no vencimento do prazo."}),(0,t.jsxs)(c.ZP,{item:!0,xs:12,md:3,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Vencimento"}),(0,t.jsx)("p",{children:n()})]}),(0,t.jsx)(c.ZP,{item:!0,xs:12,md:12,children:(0,t.jsx)(I,{form:o,data:l,disabled:s})}),(0,t.jsx)(j.Z,{form:o,fields:l.fields,disabled:s})]})})})};var Z=o(99734);let C=e=>{let{form:a,data:o,setBlock:i,status:l,disabled:s,handleFileSelect:n,handleRemoveFile:r}=e;return(0,t.jsx)(t.Fragment,{children:o&&o.map((e,d)=>(0,t.jsx)(Z.Z,{form:a,index:d,bloco:e,blockKey:"parLimpezaNaoConformidadeModeloBlocoID",setBlocos:i,handleFileSelect:n,handleRemoveAnexoItem:r,status:l,blocos:o,disabled:s}))})};var S=o(60664),F=o(12073),w=o(11163),q=o.n(w),P=o(86501),V=o(6624),N=o(92629),E=o(91757),k=o(83830),M=o(7071),H=o(71798),T=o(72819),A=o(51239),B=o(42222),L=o(46099);let R=e=>{var a,o,c,m,p,h,x;let{id:f,limpezaID:D,modelID:v}=e,I=q(),b=f&&f>0?"edit":"new",{menu:j,user:z,loggedUnity:Z,hasPermission:w}=(0,i.useContext)(n.V),{setTitle:R}=(0,i.useContext)(r.f),[O,_]=(0,i.useState)(null),[K,U]=(0,i.useState)(null),[Q,J]=(0,i.useState)(!1),[X,W]=(0,i.useState)(!1),[Y,G]=(0,i.useState)({status:!1,errors:[]}),[$,ee]=(0,i.useState)(!1),[ea,eo]=(0,i.useState)(!1),{setId:et,setModelID:ei,setLimpezaID:el}=(0,i.useContext)(k.X),es=(0,g.cI)({mode:"onChange"}),en=e=>{let a=!0;return e.forEach(e=>{e.novaQuantidade&&(0,B.JK)(e.novaQuantidade)>(0,B.JK)(e.quantidade)&&(a=!1)}),a},er=async e=>{let a=es.getValues("productsConclude");if(f&&O.limpeza.id){if(!en(null!=a?a:[])){P.ZP.error("Quantidade não pode ser maior que a quantidade da limpeza e higieniza\xe7\xe3o!");return}e={form:{...e,products:a,prazo:es.getValues("header.prazoSolucao"),data:es.getValues("header.data"),data_:es.getValues("header.data")&&es.getValues("header.data").split("-").reverse().join("/"),hora:es.getValues("header.hora"),transporte:es.getValues("header.transporte"),produto:es.getValues("header.produto")},params:{id:f,limpezaID:O.limpeza.id,usuarioID:z.usuarioID,papelID:z.papelID,unidadeID:Z.unidadeID,profissionalID:z.profissionalID}},_(null);try{await S.h.post("/formularios/limpeza/nao-conformidade/conclude",e),await em(es.getValues())}catch(o){console.log(o);return}finally{W(!1),J(!Q)}}},ed=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:z.usuarioID,papelID:z.papelID,unidadeID:Z.unidadeID}};try{await S.h.post("/formularios/limpeza/nao-conformidade/reOpen/".concat(f),a),P.ZP.success(H.OD.successUpdate)}catch(o){console.log(o)}finally{J(!Q)}},eu=async()=>{try{let e={id:null!=f?f:0,modelID:null!=v?v:0,limpezaID:null!=D?D:0,unidadeID:Z.unidadeID,papelID:z.papelID},a=await S.h.post("/formularios/limpeza/nao-conformidade/getData",e);204===a.status&&(et(null),I.push("/formularios/limpeza/?aba=nao-conformidade")),console.log("\uD83D\uDE80 ~ getData: ",a.data),es.reset(a.data),_(a.data.header),U(a.data.blocos)}catch(o){console.log(o);return}},ec=e=>{e.preventDefault();let a=es.getValues();em(a)},em=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:z.usuarioID,profissionalID:z.profissionalID,papelID:z.papelID,unidadeID:Z.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",a);try{if("new"===b){let o=await S.h.post("/formularios/limpeza/nao-conformidade/insertData",a);P.ZP.success("Dados cadastrados com sucesso!"),et(o.data.id),I.push("/formularios/limpeza/?aba=nao-conformidade")}else"edit"===b&&(await S.h.post("/formularios/limpeza/nao-conformidade/updateData/".concat(f),a),P.ZP.success("Dados atualizados com sucesso!"))}catch(t){console.log(t);return}finally{J(!Q)}},ep=()=>{et(O.modelo.id),I.push("/configuracoes/formularios/limpeza-naoconformidade/")},eh=()=>{let e=es.getValues("new");el(O.limpeza.id),ei(e.modelo.id),I.push("/formularios/limpeza/novo/?aba=nao-conformidade")},ex=[],ef={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(E.Z,{}),disabled:!w(I.pathname,"editar"),route:null,type:null,action:ed,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};1==z.papelID&&O&&O.status.id>=40&&ex.push(ef),1==z.papelID&&(0,B.z)(j,"/configuracoes/formularios")&&ex.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:ep,modal:!1,icon:"bi:gear",identification:null});let eD=()=>{let e={status:!1,errors:[]};es.clearErrors(),(0,L.n9)(es,"header.data","Data",e),(0,L.n9)(es,"header.hora","Hora",e),(0,L.lz)(es,es.getValues("header.fields"),e),(0,L.IB)(es,es.getValues("blocos"),e);let a=(0,L.FU)(e);(Y.status!==a.status||Y.errors.length!==a.errors.length)&&G(a)},ev=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,i;let l=new FormData;for(let s=0;s<o.length;s++)l.append("files[]",o[s]);l.append("usuarioID",z.usuarioID),l.append("unidadeID",Z.unidadeID),l.append("parLimpezaNaoConformidadeModeloBlocoID",null!==(t=a.parLimpezaNaoConformidadeModeloBlocoID)&&void 0!==t?t:null),l.append("itemOpcaoAnexoID",null!==(i=a.itemOpcaoAnexoID)&&void 0!==i?i:null),await S.h.post("/formularios/limpeza/nao-conformidade/saveAnexo/".concat(f,"/item/").concat(z.usuarioID,"/").concat(Z.unidadeID),l).then(e=>{em(es.getValues())}).catch(e=>{var a,o,t;P.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")}).finally(()=>{J(!Q)})}},eg=async e=>{e&&await S.h.delete("/formularios/limpeza/nao-conformidade/deleteAnexo/".concat(f,"/").concat(e.anexoID,"/").concat(Z.unidadeID,"/").concat(z.usuarioID,"/item")).then(e=>{let a=es.getValues();em(a)}).catch(e=>{var a,o,t;P.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")}).finally(()=>{eu()})};return(0,i.useEffect)(()=>{R({icon:"typcn:warning-outline",title:"N\xe3o conformidade da Limpeza e Higieniza\xe7\xe3o",subtitle:{id:f,count:1,new:!1}}),eu(),setTimeout(()=>{es.trigger()},300)},[Q,z]),(0,t.jsx)("form",{onSubmit:e=>ec(e),children:O&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{btnNewModal:1===z.papelID&&"edit"===b,handleNewModal:()=>ee(!0),btnCancel:!0,btnSave:(null==O?void 0:null===(a=O.status)||void 0===a?void 0:a.id)<40,btnSend:1===z.papelID&&(null==O?void 0:null===(o=O.status)||void 0===o?void 0:o.id)>=30&&(null==O?void 0:null===(c=O.status)||void 0===c?void 0:c.id)<=40||2===z.papelID&&(null==O?void 0:null===(m=O.status)||void 0===m?void 0:m.id)===30,btnPrint:"edit"==b,btnDelete:1===z.papelID&&(null==O?void 0:null===(p=O.status)||void 0===p?void 0:p.id)<40&&"edit"===b,onclickDelete:()=>eo(!0),actionsData:ex,actions:1===z.papelID,handleSubmit:()=>es.handleSubmit(em),handleSend(){W(!0),eD(),verifyIfCanAproveForm(K)},iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"N\xe3o conformidade da Limpeza e Higieniza\xe7\xe3o",type:b,status:null==O?void 0:null===(h=O.status)||void 0===h?void 0:h.id}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(M.Z,{size:"small",HeaderFiel:!0,skin:"light",color:O.status.color,label:O.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(M.Z,{size:"small",HeaderFiel:!0,skin:"light",label:O.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(d.Z,{children:(0,t.jsx)(u.Z,{className:"space-y-2 ",children:(0,t.jsx)(F.Z,{data:O})})}),(0,t.jsx)(y,{form:es,data:O,disabled:(null===(x=O.status)||void 0===x?void 0:x.id)>=40||1!=z.papelID}),"edit"===b&&(0,t.jsx)(C,{form:es,data:K,setBlock:U,handleFileSelect:ev,handleRemoveFile:eg,status:O.status.id,disabled:O.status.id>=40}),(0,t.jsx)(s.Z,{id:f,parFormularioID:5},Q)]}),(0,t.jsx)(V.Z,{openModal:X,handleClose(){W(!1)},title:"Concluir N\xe3o Conformidade da Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",status:O.status.id,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:er,type:"limpezaNaoConformidade",listErrors:Y,unity:Z,values:null,formularioID:5,modeloID:O.modelo.id,produtos:es.getValues("header.equipamentos"),form:es,departamentos:O.departamentosConclusao}),(0,t.jsx)(N.Z,{open:ea,handleClose:()=>eo(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/limpeza/nao-conformidade/delete/".concat(f),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,t.jsx)(T.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:eh,size:"lg",setOpenModal:ee,openModal:$,children:(0,t.jsx)(A.Z,{type:"form",data:O,form:es})})]})})};var O=R}}]);