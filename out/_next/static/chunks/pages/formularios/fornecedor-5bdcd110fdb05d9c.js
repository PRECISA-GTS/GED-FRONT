(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,a,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return o(13335)}])},93250:function(e,a,o){"use strict";var t=o(85893),n=o(49837),l=o(91359),r=o(69175);let s=e=>{let{result:a,columns:o,btnNew:s=!0,btnPrint:i=!0,btnBack:d,openModal:c,modalLog:u}=e;return(0,t.jsx)(n.Z,{children:(0,t.jsx)(l.Z,{sx:{pt:"0"},children:(0,t.jsx)(r.Z,{rows:a,columns:o,modalLog:u,buttonsHeader:{btnNew:s,btnPrint:i,btnBack:d,openModal:c}})})})};a.Z=s},46905:function(e,a,o){"use strict";var t=o(85893),n=o(87536),l=o(79072),r=o(55343),s=o(67836);let i=e=>{let{xs:a,md:o,title:i,name:d,disabled:c,required:u,form:m,onChange:p}=e;return(0,t.jsx)(l.ZP,{item:!0,xs:a,md:o,children:(0,t.jsx)("div",{children:(0,t.jsx)(r.Z,{fullWidth:!0,children:(0,t.jsx)(n.Qr,{name:d,control:m.control,rules:{required:u},render(e){let{field:a}=e;return(0,t.jsx)(s.Z,{label:i,value:null==a?void 0:a.value,placeholder:i,type:"date",size:"small","aria-describedby":"validation-schema-nome",disabled:c,error:!!m.formState.errors[d],onChange(e){let o=e.target.value;a.onChange(o),p&&p(o)},InputLabelProps:{shrink:!0},inputProps:{min:"1900-01-01",max:"2100-01-01"}})}})})})})};a.Z=i},55148:function(e,a,o){"use strict";var t=o(85893),n=o(79072),l=o(55343),r=o(35966),s=o(67836),i=o(87536),d=o(53934),c=o(30944);let u=e=>{let{xs:a,md:o,title:u,options:m,form:p,name:x,limitTags:f,value:h,required:v,disabled:g,multiple:D,onChange:j,className:I,keyProps:b,createNew:Z,helpText:y,helpTextPosition:C}=e,F=Z?[{id:null,name:"-- Novo --"},...null!=m?m:[]]:m,{key:S}=(0,c.L0)();return(0,t.jsx)(n.ZP,{item:!0,xs:a,md:o,sx:{my:1},className:I,children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Z,{fullWidth:!0,children:(0,t.jsx)(i.Qr,{name:x,control:p.control,rules:{required:v},render(e){var a;let{field:o}=e;return(0,t.jsx)(r.Z,{options:F.map(e=>e.name),value:null!=h?h:null===(a=p.getValues(x))||void 0===a?void 0:a.name,onChange(e,a){let o=F.find(e=>e.name===a);p.setValue(x,null!=o?o:null),j&&j(a)},renderInput(e){var a;return(0,t.jsx)(s.Z,{...e,id:"customSelect",size:"small",label:u,placeholder:u,error:!!p.formState.errors[x],helperText:null===(a=p.formState.errors[x])||void 0===a?void 0:a.message})}},b||S)}})}),y&&(0,t.jsx)("div",{className:"absolute right-[60px] top-[12px] ",children:(0,t.jsx)(d.Z,{text:y,position:null!=C?C:"top"})})]})})};a.Z=u},30140:function(e,a,o){"use strict";o.r(a);var t=o(85893),n=o(67294),l=o(46905),r=o(55148),s=o(51570),i=o(30944);let d=()=>{var e,a;let{form:o,setNames:d,filterDate:c,SelectFilterByName:u,data:m,setFilteredData:p,handleSearch:x,key:f}=(0,i.L0)(),{commonData:h}=(0,s.Lq)(),v=m,g=async()=>{p(v=await u(v=await u(v=await c(v=await x(v)),"status"),"quemPreenche"))};return(0,n.useEffect)(()=>{g()},[f]),(0,n.useEffect)(()=>{d(["dataInicio","dataFim","quemPreenche","status"])},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{xs:12,md:6,title:"Data inicio da avaliac\xe3o",name:"dataInicio",form:o}),(0,t.jsx)(l.Z,{xs:12,md:6,title:"Data Fim da avalia\xe7\xe3o",name:"dataFim",form:o}),(0,t.jsx)(r.Z,{xs:12,md:6,title:"Status",name:"status",form:o,options:h.status,value:null===(e=o.getValues("status"))||void 0===e?void 0:e.name}),(0,t.jsx)(r.Z,{xs:12,md:6,title:"Quem preencheu",name:"quemPreenche",value:null===(a=o.getValues("quemPreenche"))||void 0===a?void 0:a.name,form:o,options:[{id:"1",name:"F\xe1brica"},{id:"2",name:"Fornecedor"}]})]})};a.default=d},13335:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return er}});var t=o(85893),n=o(67294),l=o(11163),r=o.n(l),s=o(60664),i=o(93250),d=o(87536),c=o(56531),u=o(99734),m=o(34282),p=o(7071),x=o(29308),f=o(23895),h=o(61953),v=o(19604),g=o(49837),D=o(91359),j=o(79072),I=o(55343),b=o(29630),Z=o(23197),y=o(86887),C=o(83830),F=o(40039),S=o(39976),N=o(47842),P=o(86501),w=o(66136),E=o(80377),A=o(22416),z=o(22841),k=o(16056);let H=e=>{let{xs:a,md:o,title:n,index:l,name:r,typePage:s,value:i,disabled:d,register:c,...u}=e;return(0,t.jsx)(j.ZP,{item:!0,xs:a,md:o,children:(0,t.jsx)(h.Z,{display:"flex",flexDirection:"column",alignItems:"start",children:(0,t.jsx)(z.Z,{control:(0,t.jsx)(k.Z,{...u,name:r,...c(r),defaultChecked:i,disabled:d,onChange(e){u.onChange&&u.onChange(e.target.checked,l,r,s)}}),label:n,size:"small",sx:{"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})})})},M=e=>{let{data:a,control:o,setValue:l,register:r,errors:s}=e,[i,d]=(0,n.useState)(!0);return l("emailDestinatario",a.email),(0,t.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:[i&&(0,t.jsx)(x.Z,{name:"emailDestinatario",type:"email",title:"E-mail do destinat\xe1rio",required:!0,control:o,errors:s.emailDestinatario}),(0,t.jsx)(x.Z,{name:"assunto",title:"Assunto",required:!0,register:r,control:o,defaultValue:"",errors:s.assunto}),(0,t.jsx)(x.Z,{name:"descricao",title:"Descri\xe7\xe3o",multiline:!0,rows:4,required:!0,control:o,defaultValue:"",errors:s.descricao}),(0,t.jsxs)(A.Z,{row:!0,children:[(0,t.jsx)(H,{name:"email",title:"E-mail",value:!0,register:r,onChange:()=>d(!i)}),(0,t.jsx)(H,{name:"alerta",title:"Alerta",value:!0,register:r})]})]})};var q=o(70190),V=o(44373);o(80587);var O=o(92945);let R=e=>{let{values:a,handleFileSelect:o,handleRemove:l,disabled:r,errors:s}=e,{settings:i}=(0,n.useContext)(w.J6),d=i.mode,[c,u]=(0,n.useState)(null),m=(0,n.useRef)(null),p=e=>{m.current.click(),u(e)};return(0,n.useEffect)(()=>{m.current&&(m.current.value="")},[o]),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:a&&a.map((e,n)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.ZP,{container:!0,spacing:2,children:(0,t.jsx)(j.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(h.Z,{display:"flex",alignItems:"center",sx:{gap:1},children:[(0,t.jsx)(b.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},children:e.nome}),(0,t.jsx)(b.Z,{variant:"body2",children:"(".concat(e.unidadeMedida,")")})]})})},n),e.produtoAnexosDescricao&&e.produtoAnexosDescricao.length>0&&(0,t.jsx)(j.ZP,{container:!0,spacing:4,children:e.produtoAnexosDescricao.map((e,a)=>(0,t.jsx)(O.Z,{modeTheme:d,handleFileClick:p,selectedItem:c,inputRef:m,item:e,indexBlock:n,indexItem:a,handleFileSelect:o,folder:"produto",handleRemove:l,error:s,disabled:r},"".concat(n,"-").concat(a)))}),e.anexos&&0===e.anexos.length&&(0,t.jsx)(b.Z,{variant:"body2",sx:{mb:2},children:"Este produto n\xe3o exige anexos"}),n<a.length-1&&(0,t.jsx)(V.Z,{sx:{my:4}})]}))})};var L=o(50287),_=o(99384);let T=e=>{var a,o,l,r,i,d,u,m,p;let{modeloID:f,values:h,fields:v,disabled:g,register:D,errors:I,setValue:b,control:y,getValues:C,getAddressByCep:F}=e;console.log("\uD83D\uDE80 ~ values:",h);let[S,N]=(0,n.useState)([]),{setDateFormat:P,dateStatus:w}=(0,_.Z)(),E=async()=>{let e=await s.h.post("/cadastros/profissional/getProfissionaisAssinatura",{formularioID:1,modeloID:f});N(e.data.preenche)};return(0,n.useEffect)(()=>{E(),h&&!h.data&&b("fieldsHeader.data",(0,Z.Ux)()),h&&!h.hora&&b("fieldsHeader.hora",(0,Z.Xn)())},[h]),(0,t.jsxs)(j.ZP,{container:!0,spacing:4,children:[(0,t.jsx)(x.Z,{xs:12,md:2,title:"Data da abertura",name:"fieldsHeader.abertoPor.dataInicio",value:h.abertoPor.dataInicio,disabled:!0,register:D,control:y}),(0,t.jsx)(x.Z,{xs:12,md:2,title:"Hora da abertura",name:"fieldsHeader.abertoPor.horaInicio",value:h.abertoPor.dataInicio,type:"time",disabled:!0,register:D,control:y}),(0,t.jsx)(x.Z,{xs:12,md:8,title:"Aberto por",name:"fieldsHeader.abertoPor.profissional.nome",value:null==h?void 0:null===(a=h.abertoPor)||void 0===a?void 0:null===(o=a.profissional)||void 0===o?void 0:o.nome,disabled:!0,register:D,control:y}),(0,t.jsx)(L.Z,{xs:12,md:2,title:"Data da avalia\xe7\xe3o",name:"fieldsHeader.data",type:"date",value:null!==(m=null==h?void 0:h.data)&&void 0!==m?m:(0,Z.Ux)(),disabled:g,register:D,control:y,setDateFormat:P,typeValidation:"dataPassado",daysValidation:365,dateStatus:w,errors:null==I?void 0:null===(l=I.fieldsHeader)||void 0===l?void 0:l.data}),(0,t.jsx)(x.Z,{xs:12,md:2,title:"Hora da avalia\xe7\xe3o",name:"fieldsHeader.hora",value:null!==(p=null==h?void 0:h.data)&&void 0!==p?p:(0,Z.Xn)(),type:"time",disabled:g,register:D,control:y,errors:null==I?void 0:null===(r=I.fieldsHeader)||void 0===r?void 0:r.hora}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"CNPJ",name:"fieldsHeader.cnpj",type:"string",mask:"cnpj",disabled:!0,register:D,control:y,errors:null==I?void 0:null===(i=I.fieldsHeader)||void 0===i?void 0:i.cnpj}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"Raz\xe3o Social",name:"fieldsHeader.razaoSocial",type:"string",disabled:g,register:D,control:y,errors:null==I?void 0:null===(d=I.fieldsHeader)||void 0===d?void 0:d.razaoSocial}),(0,t.jsx)(x.Z,{xs:12,md:4,title:"Nome Fantasia",name:"fieldsHeader.nomeFantasia",type:"string",disabled:g,register:D,control:y,errors:null==I?void 0:null===(u=I.fieldsHeader)||void 0===u?void 0:u.nomeFantasia}),(0,t.jsx)(c.Z,{register:D,errors:I,setValue:b,control:y,getValues:C,fields:v,values:v,getAddressByCep:F,disabled:g})]})};o(84220);var B=o(41088),G=o(92629),Q=o(1503);let X=e=>{let{control:a,register:o}=e,{user:l}=(0,n.useContext)(F.V),{id:r}=(0,n.useContext)(C.X);return console.log("useGlobal data reabre formu...",r,l),(0,t.jsx)("div",{children:(0,t.jsx)(x.Z,{name:"obs",title:"Observa\xe7\xe3o",register:o,control:a,defaultValue:"",multiline:!0,rows:6})})};var J=o(934);o(77644),o(99070);var W=o(87771);let U=e=>{var a,o;let{values:n}=e;if(n)return(0,t.jsx)(g.Z,{children:(0,t.jsx)(D.Z,{children:(0,t.jsxs)("div",{className:"flex flex-col justify-center items-center gap-4",children:[(0,t.jsx)(W.QRz,{size:60,className:"text-yellow-600"}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("p",{className:"text-2xl font-semibold",children:"Aguardando preenchimento do Fornecedor"}),(0,t.jsx)("p",{children:"Este formul\xe1rio ser\xe1 preenchido pelo fornecedor"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 w-full px-10 text-center pt-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm opacity-60",children:"Nome Fantasia"}),(0,t.jsx)("p",{className:"text-lg",children:n.nomeFantasia})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm opacity-60",children:"Raz\xe3o Social"}),(0,t.jsx)("p",{className:"text-lg",children:n.razaoSocial})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm opacity-60",children:"CNPJ"}),(0,t.jsx)("p",{className:"text-lg",children:n.cnpj})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm opacity-60",children:"Telefone"}),(0,t.jsx)("p",{className:"text-lg",children:null!==(a=n.telefone)&&void 0!==a?a:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm opacity-60",children:"E-mail"}),(0,t.jsx)("p",{className:"text-lg",children:null!==(o=n.email)&&void 0!==o?o:"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm opacity-60",children:"Data de Cadastro"}),(0,t.jsx)("p",{className:"text-lg",children:n.dataInicio})]})]})]})})})};var K=o(82555);let Y=e=>{var a,o;let l;let{id:i,makeFornecedor:c}=e,{setData:N,data:A}=(0,K.O)(),[z,k]=(0,n.useState)(!1),[H,V]=(0,n.useState)(null),{menu:O,user:L,loggedUnity:_}=(0,n.useContext)(F.V),[W,Y]=(0,n.useState)(!1),[$,ee]=(0,n.useState)(!1),[ea,eo]=(0,n.useState)(!0),[et,en]=(0,n.useState)(!0),[el,er]=(0,n.useState)(null),[es,ei]=(0,n.useState)([]),[ed,ec]=(0,n.useState)([]),[eu,em]=(0,n.useState)(!1),[ep,ex]=(0,n.useState)(null),{createNewNotification:ef}=(0,n.useContext)(S.u),[eh,ev]=(0,n.useState)(!1),[eg,eD]=(0,n.useState)([]),[ej,eI]=(0,n.useState)([]),[eb,eZ]=(0,n.useState)([]),[ey,eC]=(0,n.useState)(null),[eF,eS]=(0,n.useState)([]),[eN,eP]=(0,n.useState)(null),[ew,eE]=(0,n.useState)(""),[eA,ez]=(0,n.useState)(!1),[ek,eH]=(0,n.useState)(!1),[eM,eq]=(0,n.useState)({status:!1,errors:[]}),{settings:eV}=(0,n.useContext)(w.J6),{setId:eO}=(0,n.useContext)(C.X),[eR,eL]=(0,n.useState)([]),[e_,eT]=(0,n.useState)(!1),[eB,eG]=(0,n.useState)(null),{setReportParameters:eQ,sendPdfToServer:eX}=(0,Q.Gc)(),{isLoading:eJ,startLoading:eW,stopLoading:eU}=(0,B.Z)(),[eK,eY]=(0,n.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),e$=r(),e0=i&&i>0?"edit":"new",e1=e$.pathname,{reset:e3,register:e2,getValues:e4,setValue:e7,control:e8,watch:e5,handleSubmit:e9,clearErrors:e6,setError:ae,formState:{errors:aa}}=(0,d.cI)();console.log("formFornecedor errors: ",aa);let ao=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:L.usuarioID,papelID:L.papelID,unidadeID:_.unidadeID}};try{Y(!0),await s.h.post("".concat(e1,"/changeFormStatus/").concat(i),a).then(e=>{P.ZP.success(Z.OD.successUpdate),Y(!1),aD(ep,null,null)})}catch(o){console.log(o)}},at=async e=>{try{if(!e.email&&!e.alerta)return P.ZP.error("Selecione ao menos um tipo de notifica\xe7\xe3o!");let a={titulo:e.assunto,descricao:e.descricao,url:"/formularios/fornecedor/",urlID:i,tipoNotificacaoID:3,usuarioGeradorID:L.usuarioID,usuarioID:0,unidadeID:el.fornecedor.unidadeID,papelID:2,email:e.email,alerta:e.alerta};if(ef(a),e.email){let o={values:e,auth:{id:i,usuarioID:L.usuarioID,papelID:L.papelID,unidadeID:_.unidadeID}};await s.h.post("".concat(e1,"/sendNotification"),o)}let t=e.alerta&&e.email?"E-mail e alerta enviados com sucesso!":e.alerta&&!e.email?"Alerta criado com sucesso!":!e.alerta&&e.email?"E-mail enviado com sucesso!":null;P.ZP.success(t)}catch(n){console.log(n)}},an=()=>{navigator.clipboard.writeText(ey),P.ZP.success("Link copiado com sucesso!")},al=()=>{eO(el.parFornecedorModeloID),e$.push("/configuracoes/formularios/fornecedor/")},ar={id:1,name:"Gerar novo formul\xe1rio",description:"Gerar um novo formul\xe1rio de preenchimento para este fornecedor.",component:(0,t.jsx)(q.Z,{cnpj:null==eg?void 0:eg.cnpj}),route:null,type:null,modal:!0,fullHeight:!0,action:c,size:"lg",icon:"fluent:form-new-20-regular",identification:null},as={id:2,name:"Gerar notifica\xe7\xe3o",description:"Gerar uma nova notifica\xe7\xe3o para o fornecedor, podendo ser um e-mail e/ou alerta do sistema.",component:(0,t.jsx)(M,{data:{email:null===(a=eb.find(e=>"email"==e.nomeColuna))||void 0===a?void 0:a.email}}),route:null,type:null,modal:!0,action:at,icon:"cil:bell",identification:null},ai={id:3,name:"Copiar link do formul\xe1rio",description:"Copiar o link deste formul\xe1rio.",component:(0,t.jsx)(q.Z,{}),route:null,type:null,action:an,modal:!1,icon:"solar:copy-outline",identification:null},ad={id:i,name:"Imprimir",nameComponent:"indexFormulario",type:"report",unidadeID:null==el?void 0:el.unidadeID,usuarioID:ew.usuarioID,papelID:L.papelID,status:ew.status,route:"formularios/fornecedor",icon:"fluent:print-24-regular",module:"fornecedor"},ac={id:6,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(X,{}),disabled:!!ea,route:null,type:null,action:ao,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null},au=[];1==L.papelID&&(au.push(ar),ew.status>=40&&au.push(ac)),au.push(as),au.push(ai),au.push(ad),1==L.papelID&&(l=!1,O.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(l=!0)})})}),l)&&au.push({id:5,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:al,modal:!1,icon:"bi:gear",identification:null});let am=async()=>{try{await s.h.post("".concat(e1,"/verifyFormPending/").concat(i),{parFormularioID:1}).then(e=>{eo(e.data) //! true/false
})}catch(e){console.log(e)}},ap=()=>{console.log("no getData",_),eW();try{s.h.post("".concat(e1,"/getData/").concat(i),{type:e0,unidadeID:_.unidadeID}).then(e=>{var a,o,t;console.log("getData: ",e.data),e.data.hasModel||(k(!1),V(e.data)),k(!0),eD(e.data.fieldsHeader),eI(e.data.fieldsFooter),eZ(e.data.fields),ei(e.data.produtos),eS(e.data.blocos),ec(e.data.grupoAnexo),eE(e.data.info),er(e.data.unidade),eC(e.data.link),eP(e.data.ultimaMovimentacao),av(e.data.blocos),e3(e.data);let n=[];for(let l=0;l<e.data.fields.length;l++){let r=e.data.fields[l].nomeColuna,s=e.data.fields[l].nomeCampo;for(let i in _){if("telefone"==r){let d=null!==(t=_.telefone1)&&void 0!==t?t:_.telefone2;e7("fields[".concat(l,"].").concat(r),null!=d?d:"")}i!==r||e4("fields[".concat(l,"].").concat(r),_[i])||(e7("fields[".concat(l,"].").concat(r),_[i]),null!==_[i]&&""!==_[i]&&n.push({name:s,value:_[i]}))}}eL(n);let c=Z.WR[null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(o=a.info)||void 0===o?void 0:o.status];ex(c),console.log("\uD83D\uDE80 ~ response.data.unidade:",L.papelID,e.data.unidade.quemPreenche,ew.status),eY({status:L.papelID==e.data.unidade.quemPreenche&&e.data.info.status<40,message:2==L.papelID&&e.data.info.status>=40?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":1==L.papelID&&e.data.info.status<40?"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!":1==L.papelID&&40==e.data.info.status?"Este formul\xe1rio est\xe1 aguardando aprova\xe7\xe3o":null,messageType:2==L.papelID?"warning":"info"}),am()}).catch(e=>{console.log("\uD83D\uDE80 ~ error:",e)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}finally{eU()}},ax=()=>{e6();let e=!1,a=[];null==eb||eb.forEach((o,t)=>{let n=o.tabela?"fields[".concat(t,"].").concat(o.tabela):"fields[".concat(t,"].").concat(o.nomeColuna),l=e4(n);1!==o.obrigatorio||l||(ae(n,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==o?void 0:o.nomeCampo),e=!0)}),es&&es.length>0&&es.forEach((o,t)=>{o.produtoAnexosDescricao.forEach((n,l)=>{1===n.obrigatorio&&0==n.anexos.length&&(ae("produtos[".concat(t,"].produtoAnexosDescricao[").concat(l,"].anexos"),{type:"manual",message:"Campo obrigat\xf3rio"}),a.push("Anexo: ".concat(null==o?void 0:o.nome," / ").concat(null==n?void 0:n.nome)),e=!0)})}),eF.forEach((o,t)=>{o.itens.forEach((o,n)=>{let l=e4("blocos[".concat(t,"].itens[").concat(n,"].resposta"));(null==o?void 0:o.obrigatorio)!==1||l||(ae("blocos[".concat(t,"].itens[").concat(n,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==o?void 0:o.nome),e=!0),o.respostaConfig&&1==o.respostaConfig.anexo&&o.respostaConfig.anexosSolicitados.length>0&&o.respostaConfig.anexosSolicitados.forEach((l,r)=>{1==l.obrigatorio&&l.anexos&&0==l.anexos.length&&(ae("blocos[".concat(t,"].itens[").concat(n,"].respostaConfig.anexosSolicitados[").concat(r,"].anexos"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push("Anexo: ".concat(null==o?void 0:o.nome," / ").concat(null==l?void 0:l.nome)),e=!0)})})}),ed&&ed.length>0&&ed.forEach((o,t)=>{o.itens.forEach((n,l)=>{1===n.obrigatorio&&0==n.anexos.length&&(ae("grupoAnexo[".concat(t,"].itens[").concat(l,"].anexos"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push("Anexo: ".concat(null==o?void 0:o.nome," / ").concat(null==n?void 0:n.nome)),e=!0)})}),eq({status:e,errors:a})},af=async e=>{if(9===e.length){let a=e.replace(/[^0-9]/g,"");try{let o=await s.h.get("https://viacep.com.br/ws/".concat(a,"/json/"));o.data.localidade?(eb.forEach(async(e,a)=>{("logradouro"===e.nomeColuna||"bairro"===e.nomeColuna||"cidade"===e.nomeColuna||"estado"===e.nomeColuna)&&(await e7("fields[".concat(a,"].logradouro"),o.data.logradouro),await e7("fields[".concat(a,"].bairro"),o.data.bairro),await e7("fields[".concat(a,"].cidade"),o.data.localidade),await e7("fields[".concat(a,"].estado"),o.data.uf))}),P.ZP.success("Endere\xe7o encontrado!")):P.ZP.error("Endere\xe7o n\xe3o encontrado!")}catch(t){console.error(t)}}},ah=e=>{eG(e),ax(),ez(!0),ee(!0)},av=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.respostaConfig&&1==e.respostaConfig.bloqueiaFormulario&&(a=!1)})}),en(a)},ag=async e=>{1===_.papelID&&eX(i,eB,"fornecedor"),e.conclusion=!0,await e9(aj)(e)},aD=(e,a,o)=>{let t=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",n={titulo:"Formul\xe1rio de Fornecedor ".concat(t),descricao:"O formul\xe1rio de Fornecedor #".concat(i," est\xe1 ").concat(t,"."),url:"/formularios/fornecedor/",urlID:i,tipoNotificacaoID:6,usuarioGeradorID:L.usuarioID,usuarioID:0,unidadeID:_.unidadeID,papelID:1};if(n&&(ef(n),a)){let l={titulo:"Fornecedor gerado",descricao:"O formul\xe1rio de Fornecedor #".concat(i," est\xe1 ").concat(t," e gerou uma n\xe3o conformidade."),url:"/formularios/fornecedor/nao-conformidade/",urlID:o,tipoNotificacaoID:5,usuarioGeradorID:L.usuarioID,usuarioID:0,unidadeID:_.unidadeID,papelID:1};ef(l)}},aj=async function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];eW(),!0===a.conclusion&&(console.log("concluiu",e),e.status=L&&1==L.papelID?a.status:40,e.obsConclusao=a.obsConclusao);let o={form:e,auth:{usuarioID:L.usuarioID,papelID:L.papelID,unidadeID:_.unidadeID}};try{"edit"==e0?(Y(!0),await s.h.post("".concat(e1,"/updateData/").concat(i),o).then(a=>{P.ZP.success(Z.OD.successUpdate),Y(!1);let o=null;a.data&&a.data.naoConformidade&&a.data.id>0&&(e$.push("/formularios/fornecedor/nao-conformidade/"),eO(a.data.id),o=a.data.id),aD(e.status,e.naoConformidade,o)})):"new"==e0?await s.h.post("".concat((0,Z.g_)(e1),"/insertData"),o).then(e=>{e$.push("".concat((0,Z.g_)(e1))),eO(e.data),P.ZP.success(Z.OD.successNew)}):P.ZP.error(Z.OD.error)}catch(t){console.log(t)}finally{eU(),console.log("fun\xe7\xe3o ativada fim finally")}},aI=async(e,a)=>{eW();let o=e.target.files;if(o&&o.length>0){var t,n,l,r;let d=new FormData;for(let c=0;c<o.length;c++)d.append("files[]",o[c]);d.append("usuarioID",L.usuarioID),d.append("unidadeID",_.unidadeID),d.append("produtoAnexoID",null!==(t=a.produtoAnexoID)&&void 0!==t?t:null);try{await s.h.post("".concat(e1,"/saveAnexo/").concat(i,"/produto/").concat(L.usuarioID,"/").concat(el.unidadeID),d);let u=e4();aj(u)}catch(m){P.ZP.error(null!==(r=null===(n=m.response)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.message)&&void 0!==r?r:"Erro ao atualizar anexo, tente novamente!")}finally{eU()}}},ab=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,n,l,r;let d=new FormData;for(let c=0;c<o.length;c++)d.append("files[]",o[c]);d.append("usuarioID",L.usuarioID),d.append("unidadeID",_.unidadeID),d.append("grupoAnexoItemID",null!==(t=a.grupoAnexoItemID)&&void 0!==t?t:null);try{eW(),await s.h.post("".concat(e1,"/saveAnexo/").concat(i,"/grupo-anexo/").concat(L.usuarioID,"/").concat(el.unidadeID),d);let u=e4();aj(u)}catch(m){P.ZP.error(null!==(r=null===(n=m.response)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.message)&&void 0!==r?r:"Erro ao atualizar anexo, tente novamente!")}finally{eU()}}},aZ=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,n,l,r,d;let c=new FormData;for(let u=0;u<o.length;u++)c.append("files[]",o[u]);c.append("usuarioID",L.usuarioID),c.append("unidadeID",_.unidadeID),c.append("parFornecedorModeloBlocoID",null!==(t=a.parFornecedorModeloBlocoID)&&void 0!==t?t:null),c.append("itemOpcaoAnexoID",null!==(n=a.itemOpcaoAnexoID)&&void 0!==n?n:null);try{eW(),await s.h.post("".concat(e1,"/saveAnexo/").concat(i,"/item/").concat(L.usuarioID,"/").concat(el.unidadeID),c);let m=e4();aj(m)}catch(p){P.ZP.error(null!==(d=null===(l=p.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)&&void 0!==d?d:"Erro ao atualizar anexo, tente novamente!")}finally{eU()}}},ay=async e=>{try{let a=await s.h.post("/cadastros/item/getItemConfigs",{itemID:e.itemID,alternativaItemID:e.alternativa.id}),o=eF.map(o=>({...o,itens:o.itens.map(o=>o.itemID==e.itemID?{...o,respostaConfig:{...a.data}}:o)}));eS(o)}catch(t){console.log("error",t)}},aC=async e=>{e&&await s.h.delete("".concat(e1,"/deleteAnexo/").concat(i,"/").concat(e.anexoID,"/").concat(el.unidadeID,"/").concat(L.usuarioID,"/produto")).then(e=>{let a=e4();aj(a)}).catch(e=>{var a,o,t;P.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},aF=async e=>{e&&await s.h.delete("".concat(e1,"/deleteAnexo/").concat(i,"/").concat(e.anexoID,"/").concat(el.unidadeID,"/").concat(L.usuarioID,"/grupo-anexo")).then(e=>{let a=e4();aj(a)}).catch(e=>{var a,o,t;P.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},aS=async e=>{e&&await s.h.delete("".concat(e1,"/deleteAnexo/").concat(i,"/").concat(e.anexoID,"/").concat(el.unidadeID,"/").concat(L.usuarioID,"/item")).then(e=>{let a=e4();aj(a)}).catch(e=>{var a,o,t;P.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},aN=e=>{let a=[...eF];a.map((a,o)=>{a.itens.map((a,t)=>{e7("blocos[".concat(o,"].itens[").concat(t,"].resposta"),a.alternativas[e])})}),eS(a=>a.map(a=>({...a,itens:a.itens.map(a=>({...a,resposta:a.alternativas[e]&&a.alternativas[e].id>0?a.alternativas[e]:null}))}))),em(!eu);let o=e4();aj(o)};return(0,n.useEffect)(()=>{"edit"==e0&&ap(),N({user:L,report:{id:i}})},[i,W]),(0,n.useEffect)(()=>{ax()},[]),(0,t.jsxs)("form",{onSubmit:e9(aj),children:[(0,t.jsx)(y.Z,{btnCancel:!0,btnDelete:ew.status<40,onclickDelete:()=>eT(!0),btnSave:eK.status,btnSend:1==L.papelID&&ew.status>=30&&ew.status<=40||2==L.papelID&&ew.status<40,btnPrint:"edit"==e0,actionsData:au,actions:!0,handleSubmit:()=>e9(aj),handleSend:ah,iconConclusion:"mdi:check-bold",titleConclusion:"Concluir Formul\xe1rio",title:"Fornecedor",btnStatus:"edit"==e0,handleBtnStatus:()=>ev(!0),type:e0,status:ep}),z&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[ep&&(0,t.jsx)(p.Z,{size:"small",skin:"light",color:ep.color,label:ep.title,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(p.Z,{size:"small",skin:"light",color:"primary",label:((null==el?void 0:el.quemPreenche)==1?"F\xe1brica":"Fornecedor")+" preenche"}),(0,t.jsx)(p.Z,{size:"small",skin:"light",label:"Modelo ".concat(null==el?void 0:el.modelo)})]}),(0,t.jsxs)(h.Z,{display:"flex",flexDirection:"column",sx:{gap:6},children:[eR&&eR.length>0&&(0,t.jsxs)(v.Z,{severity:"info",sx:{mb:2},children:[(0,t.jsxs)("h1",{children:["Os seguintes campos foram copiados de ",(0,t.jsx)("strong",{children:"Meus Dados"}),":"]}),(0,t.jsx)("div",{className:"pt-2",children:eR.map(e=>(0,t.jsx)("div",{className:"flex opacity-80",children:(0,t.jsx)("p",{children:"- ".concat(e.name," (").concat(e.value,")")})}))})]}),ew&&""!=ew.cabecalhoModelo&&(0,t.jsx)(g.Z,{children:(0,t.jsx)(D.Z,{children:(0,t.jsx)("p",{children:ew.cabecalhoModelo})})}),(0,t.jsxs)(g.Z,{children:[(0,t.jsx)(G.Z,{title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/fornecedor/delete/".concat(i),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"},open:e_,handleClose:()=>eT(!1)}),(0,t.jsx)(D.Z,{children:el&&(0,t.jsx)(T,{modeloID:el.parFornecedorModeloID,values:eg,fields:eb,disabled:!eK.status||ea,register:e2,errors:aa,setValue:e7,control:e8,getValues:e4,getAddressByCep:af})})]}),es&&es.length>0&&(0,t.jsx)(g.Z,{children:(0,t.jsx)(D.Z,{children:(0,t.jsx)(R,{values:es,handleFileSelect:aI,handleRemove:aC,disabled:!eK.status||ea,errors:null==aa?void 0:aa.produtos},eJ)})}),eF&&eF.map((e,a)=>(0,t.jsx)(u.Z,{index:a,blockKey:"parFornecedorModeloBlocoID",handleFileSelect:aZ,changeAllOptions:aN,setItemResposta:ay,handleRemoveAnexoItem:aS,setBlocos:eS,values:e,control:e8,register:e2,setValue:e7,errors:null==aa?void 0:aa.blocos,disabled:!eK.status||ea},eu)),ed&&ed.map((e,a)=>(0,t.jsx)(f.Z,{values:{grupo:e,indexGrupo:a,handleFileSelect:ab,handleRemove:aF,folder:"grupo-anexo",disabled:!eK.status,error:aa}},a)),ew&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(g.Z,{children:(0,t.jsx)(D.Z,{children:(0,t.jsx)(j.ZP,{container:!0,spacing:4,children:(0,t.jsx)(j.ZP,{item:!0,xs:12,md:12,children:(0,t.jsxs)(I.Z,{fullWidth:!0,children:[(0,t.jsx)(b.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,t.jsx)(x.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:ew.obs,disabled:!eK.status||ea,control:e8})]})})})})})}),ej&&ej.concluded&&(0,t.jsx)(b.Z,{variant:"caption",children:"Conclu\xeddo por ".concat(null==ej?void 0:null===(o=ej.profissionalAprova)||void 0===o?void 0:o.nome," em ").concat(ej.dataFim," ").concat(ej.horaFim,".")}),eh&&(0,t.jsx)(m.Z,{title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(i," do Fornecedor."),id:i,parFormularioID:1,formStatus:ew.status,hasFormPending:ea,canChangeStatus:!ea&&2==el.quemPreenche&&ew.status>=40,openModal:eh,handleClose:()=>ev(!1),btnCancel:!0,btnConfirm:!0,handleSubmit:ao}),(0,t.jsx)(E.Z,{openModal:eA,handleClose(){ez(!1),ee(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:ew,canChange:!ea,register:e2,setValue:e7,getValues:e4,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ag,listErrors:eM,canApprove:!0,type:"fornecedor",unity:el}),(0,t.jsx)(J.Z,{parFormularioID:1,id:i})]})]}),!z&&(0,t.jsx)(U,{values:H})]})};var $=o(60565),ee=o(72819);let ea=e=>{let{values:a}=e;return(0,t.jsx)("div",{children:(0,t.jsxs)(h.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,t.jsxs)(b.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"E-mail enviado para: "})," ",null==a?void 0:a.email]}),(0,t.jsxs)(b.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Link do formul\xe1rio: "})," ",null==a?void 0:a.link]})]})})};var eo=o(431),et=o(30944),en=o(30140);let el=()=>{let{user:e,loggedUnity:a}=(0,n.useContext)(F.V),o=(0,l.useRouter)(),r=o.pathname,{setTitle:d}=(0,n.useContext)($.f),{id:c,setId:u}=(0,n.useContext)(C.X),[m,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),[h,v]=(0,n.useState)(null),{isNotFactory:g}=(0,eo.r7)(),{startFilter:D,setFilteredData:j,filteredData:I,setData:b}=(0,et.L0)(),y=()=>{p(!0)},S=async()=>{try{let o=await s.h.post("".concat(r,"/getList/"),{unidadeID:a.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null});console.log("\uD83D\uDE80 ~ getList ~ response",o.data),j(o.data),b(o.data),d({title:"Fornecedor",subtitle:{id:c,count:o.data.length,new:!1}})}catch(t){console.log(t)}},w=async o=>{try{console.log("\uD83D\uDE80 ~ makeFornecedor:",o.fields);let t=await s.h.post("/formularios/fornecedor/makeFornecedor",{usuarioID:e.usuarioID,papelID:e.papelID,profissionalID:e.profissionalID,unidadeID:a.unidadeID,values:o.fields,habilitaQuemPreencheFormFornecedor:o.habilitaQuemPreencheFormFornecedor});200==t.status&&(P.ZP.success(t.data.message),g?(f(!0),v(t.data.result),S()):u(t.data.fornecedorID))}catch(n){console.error(n),console.error("Erro ao enviar email",n)}},E=()=>{let e=null==h?void 0:h.link;e&&(navigator.clipboard.writeText(e),P.ZP.success("Link copiado com sucesso!"))};(0,n.useEffect)(()=>{let e="1"===o.query.filter;S(),D((0,t.jsx)(en.default,{}),e)},[c,o.query]),(0,n.useEffect)(()=>{o.query.f&&u(o.query.f)},[o.query]);let A=1==e.papelID?[{headerName:"ID",field:"id",size:.2},{headerName:"Fornecedor",field:"fornecedor",size:2},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Produtos",field:"produtos",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:.7,type:"date"},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Quem preenche",field:"quemPreenche",size:1},{headerName:"Status",field:{name:"status",cor:"cor"},size:1}]:2==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"F\xe1brica",field:"fabrica",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Produtos",field:"produtos",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1,type:"date"},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:{name:"status",cor:"cor"},size:1}]:[],z=(0,Z.OL)(r,A);return(0,t.jsxs)(t.Fragment,{children:[I?c&&c>0?(0,t.jsx)(Y,{id:c,makeFornecedor:w}):(0,t.jsx)(i.Z,{result:I,columns:z,openModal:1==e.papelID?y:null,btnNew:1==e.papelID}):(0,t.jsx)(N.Z,{show:!0}),(0,t.jsx)(ee.Z,{title:"Habilitar Fornecedor",handleConclusion:w,setOpenModal:p,openModal:m,size:"lg",fullHeight:!0,children:(0,t.jsx)(q.Z,{})}),(0,t.jsx)(ee.Z,{title:"Formul\xe1rio enviado ao fornecedor",description:"Um novo formul\xe1rio de qualifica\xe7\xe3o de fornecedor foi enviado",handleCopyLink:E,setOpenModal:f,openModal:x,children:(0,t.jsx)("div",{children:(0,t.jsx)(ea,{values:h})})})]})};var er=el},77644:function(e,a,o){"use strict";o.r(a);var t=o(85893),n=o(99070);let l=e=>{let{data:a}=e;return(0,t.jsx)(n.BB,{children:(0,t.jsxs)(n.T3,{size:"A4",style:{paddingTop:10,paddingBottom:30,paddingLeft:20,paddingRight:20},children:[(0,t.jsx)(n.xv,{children:"Content do teste"}),(0,t.jsx)(n.xv,{children:a.name})]})})};a.default=l}},function(e){e.O(0,[4186,1445,1111,5999,4738,594,2187,8371,1515,7842,7105,6887,5061,9175,8373,4247,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);