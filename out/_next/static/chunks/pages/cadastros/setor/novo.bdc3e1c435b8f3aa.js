(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9326],{91359:function(e,t,s){"use strict";s.d(t,{Z:function(){return h}});var i=s(87462),o=s(63366),n=s(67294),a=s(86010),r=s(94780),l=s(67074),d=s(78884),c=s(1588),u=s(34867);function f(e){return(0,u.Z)("MuiCardContent",e)}(0,c.Z)("MuiCardContent",["root"]);var m=s(85893);let p=["className","component"],v=e=>{let{classes:t}=e;return(0,r.Z)({root:["root"]},f,t)},x=(0,l.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),Z=n.forwardRef(function(e,t){let s=(0,d.Z)({props:e,name:"MuiCardContent"}),{className:n,component:r="div"}=s,l=(0,o.Z)(s,p),c=(0,i.Z)({},s,{component:r}),u=v(c);return(0,m.jsx)(x,(0,i.Z)({as:r,className:(0,a.Z)(u.root,n),ownerState:c,ref:t},l))});var h=Z},49837:function(e,t,s){"use strict";s.d(t,{Z:function(){return D}});var i=s(87462),o=s(63366),n=s(67294),a=s(86010),r=s(94780),l=s(67074),d=s(78884),c=s(70918),u=s(1588),f=s(34867);function m(e){return(0,f.Z)("MuiCard",e)}(0,u.Z)("MuiCard",["root"]);var p=s(85893);let v=["className","raised"],x=e=>{let{classes:t}=e;return(0,r.Z)({root:["root"]},m,t)},Z=(0,l.ZP)(c.Z,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({overflow:"hidden"})),h=n.forwardRef(function(e,t){let s=(0,d.Z)({props:e,name:"MuiCard"}),{className:n,raised:r=!1}=s,l=(0,o.Z)(s,v),c=(0,i.Z)({},s,{raised:r}),u=x(c);return(0,p.jsx)(Z,(0,i.Z)({className:(0,a.Z)(u.root,n),elevation:r?8:void 0,ref:t,ownerState:c},l))});var D=h},244:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cadastros/setor/novo",function(){return s(29471)}])},29274:function(e,t,s){"use strict";var i=s(85893),o=s(11163),n=s.n(o),a=s(67294),r=s(60664),l=s(49837),d=s(91359),c=s(79072),u=s(80562),f=s(54225),m=s(87536),p=s(86501),v=s(45061),x=s(92477),Z=s(71798),h=s(60565),D=s(83830),j=s(40039),g=s(29308),C=s(50287),w=s(41088),I=s(21609),N=s(67569),b=s(84220);let y=e=>{var t,s;let{id:o}=e,[y,P]=(0,a.useState)(!1),[S,_]=(0,a.useState)(null),{setId:F}=(0,a.useContext)(D.X),O=n(),M=o&&o>0?"edit":"new",k=O.pathname,{title:E}=(0,a.useContext)(h.f),{loggedUnity:R,user:q,setUser:T}=(0,a.useContext)(j.V),{startLoading:X,stopLoading:z}=(0,w.Z)(),[J,A]=(0,a.useState)([]),B=new Date().toISOString().substring(0,10),U=(0,m.cI)({mode:"onChange"}),V=e=>{let t=!!e.fields.profissionais.find(e=>e.profissional.id===q.profissionalID&&(!e.dataFim||""==e.dataFim||null==e.dataFim||"0000-00-00"==e.dataFim)),s=!!q.setores.find(e=>e.id===o);t&&!s?(T({...q,setores:[...q.setores,{id:e.fields.setorID,nome:e.fields.nome}]}),localStorage.setItem("userData",JSON.stringify({...q,setores:[...q.setores,{id:e.fields.setorID,nome:e.fields.nome}]}))):!t&&s&&(T({...q,setores:q.setores.filter(e=>e.id!==o)}),localStorage.setItem("userData",JSON.stringify({...q,setores:q.setores.filter(e=>e.id!==o)})))},G=async e=>{let t={...e,usuarioID:q.usuarioID,unidadeID:R.unidadeID};if(!H(e)){p.ZP.error("N\xe3o \xe9 permitido repetir profissional ativo em um setor!");return}V(t);try{"new"===M?await r.h.post("cadastros/setor/new/insertData",t).then(e=>{O.push("".concat((0,Z.g_)(k))),F(e.data.id),p.ZP.success(Z.OD.successNew)}):"edit"===M&&(await r.h.post("".concat(k,"/updateData/").concat(o),t),p.ZP.success(Z.OD.successUpdate))}catch(s){s.response&&409===s.response.status?p.ZP.error(Z.OD.errorRepeated):console.log(s)}finally{z()}},H=e=>{let t=!0;return e.fields.profissionais.length>1&&e.fields.profissionais.map((s,i)=>{e.fields.profissionais.map((e,o)=>{i===o||s.profissional.id!==e.profissional.id||s.dataFim||e.dataFim||(t=!1)})}),t},K=async()=>{try{await r.h.delete("".concat(k,"/").concat(o,"/").concat(q.usuarioID,"/").concat(R.unidadeID)),F(null),P(!1),p.ZP.success(Z.OD.successDelete)}catch(e){e.response&&409===e.response.status?(p.ZP.error(Z.OD.pendingDelete),P(!1)):console.log(e)}},L=async()=>{try{if("edit"===M){let e=await r.h.post("".concat(k,"/getData/").concat(o),{id:o});_(e.data),U.reset(e.data)}else _({fields:{nome:"",status:1,profissionais:[]}}),U.reset({...S,fields:{...S.fields}})}catch(t){console.log(t)}},Q=async()=>{let e=await r.h.get("/cadastros/profissional?unidadeID=".concat(R.unidadeID,"&papelID=").concat(R.papelID)),t=e.data.filter(e=>1===e.statusID);A(t)};(0,a.useEffect)(()=>{L(),Q(),setTimeout(()=>{U.trigger()},300)},[o]);let{fields:W,append:Y,remove:$}=(0,m.Dq)({control:U.control,name:"fields.profissionais"});return(0,i.jsxs)(i.Fragment,{children:[S&&(0,i.jsxs)("form",{onSubmit:U.handleSubmit(G),children:[(0,i.jsx)(x.Z,{btnCancel:!0,btnNew:!0,btnSave:!0,handleSubmit:()=>U.handleSubmit(G),btnDelete:"edit"===M,onclickDelete:()=>P(!0),type:M}),(0,i.jsx)(l.Z,{children:(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.ZP,{container:!0,spacing:5,children:[(0,i.jsx)(g.Z,{xs:12,md:11,title:"Nome",name:"fields.nome",required:!0,form:U}),(0,i.jsx)(N.Z,{xs:1,md:1,title:"Ativo",name:"fields.status",value:null==S?void 0:null===(t=S.fields)||void 0===t?void 0:t.status,typePage:M,form:U}),(0,i.jsx)(c.ZP,{item:!0,xs:12,children:(0,i.jsxs)("div",{className:"flex items-center gap-2 pb-1 pt-2",children:[(0,i.jsx)("div",{className:"",children:(0,i.jsx)(I.Z,{icon:"material-symbols:person-check-outline",className:"text-3xl"})}),(0,i.jsx)("div",{className:"flex flex-col gap-0",children:(0,i.jsx)("p",{className:"text-xl",children:"Profissionais"})})]})}),W.map((e,t)=>{var o,n,r,l,d,f,m,p,v;return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)("input",{type:"hidden",name:"fields.profissionais[".concat(t,"].id"),value:e.id}),(0,i.jsx)(b.Z,{xs:12,md:7,title:"Profissional",name:"fields.profissionais[".concat(t,"].profissional"),value:null==S?void 0:null===(o=S.fields)||void 0===o?void 0:null===(n=o.profissionais)||void 0===n?void 0:null===(r=n[t])||void 0===r?void 0:r.profissional,required:!0,options:null!=J?J:[],form:U,opacity:0===e.status}),(0,i.jsx)(C.Z,{xs:12,md:2,title:"Data In\xedcio",name:"fields.profissionais[".concat(t,"].dataInicio"),value:null!==(s=null==S?void 0:null===(l=S.fields)||void 0===l?void 0:null===(d=l.profissionais)||void 0===d?void 0:null===(f=d[t])||void 0===f?void 0:f.dataInicio)&&void 0!==s?s:B,required:!0,opacity:0===e.status,form:U}),(0,i.jsx)(C.Z,{xs:12,md:2,title:"Data Fim",name:"fields.profissionais[".concat(t,"].dataFim"),value:null==S?void 0:null===(m=S.fields)||void 0===m?void 0:null===(p=m.profissionais)||void 0===p?void 0:null===(v=p[t])||void 0===v?void 0:v.dataFim,opacity:0===e.status,form:U}),(0,i.jsx)(c.ZP,{item:!0,xs:12,md:1,className:"flex items-center",children:(0,i.jsx)(u.Z,{color:"error",size:"small",onClick:()=>$(t),children:(0,i.jsx)(I.Z,{icon:"tabler:trash-filled"})})})]},e.id)}),(0,i.jsx)(c.ZP,{item:!0,xs:12,children:(0,i.jsx)(f.Z,{variant:"outlined",color:"primary",onClick(){Y({id:null,dataInicio:new Date}),U.trigger()},startIcon:(0,i.jsx)(I.Z,{icon:"material-symbols:add-circle-outline-rounded"}),children:"Inserir Profissional"})})]})})})]}),(0,i.jsx)(v.Z,{text:"Tem certeza que deseja excluir?",title:"Excluir "+E.title,openModal:y,handleClose:()=>P(!1),handleSubmit:K,btnCancel:!0,btnConfirm:!0})]})};t.Z=y},29471:function(e,t,s){"use strict";s.r(t);var i=s(85893),o=s(60565),n=s(67294),a=s(29274);let r=()=>{let{setTitle:e}=(0,n.useContext)(o.f);return(0,n.useEffect)(()=>{e({title:"Setor",subtitle:{id:null,count:null,new:!0}})},[]),(0,i.jsx)(a.Z,{})};t.default=r}},function(e){e.O(0,[2477,8934,9774,2888,179],function(){return e(e.s=244)}),_N_E=e.O()}]);