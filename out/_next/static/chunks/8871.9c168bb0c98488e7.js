"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8871],{82755:function(e,a,o){var l=o(85893),i=o(11163),t=o.n(i),s=o(54225),r=o(1890),n=o(77745),d=o(95398),u=o(76779),c=o(44642),m=o(40039),p=o(79072),x=o(19604),f=o(29630),h=o(67294),v=o(48432);o(99070);var D=o(82555);o(74811),o(55334),o(62813);var g=o(83542),b=o(50287),I=o(29308);let j=e=>{var a,o,i,j,C;let{form:Z,title:y,text:z,handleClose:w,openModal:S,conclusionForm:F,info:P,canChange:E,btnCancel:k,btnConfirm:N,register:V,setValue:q,listErrors:A,canApprove:M,hasNaoConformidade:H,control:R,handleSend:O,type:_,unity:T,values:B,errors:L,formularioID:U,modeloID:W}=e;if(!W)return null;let{user:K,loggedUnity:X,hasSectorPermission:G}=(0,h.useContext)(m.V),[J,Q]=(0,h.useState)({}),{data:Y}=(0,D.O)(),$=t();$.pathname.split("/")[2];let[ee,ea]=(0,h.useState)([]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(r.Z,{fullWidth:!0,maxWidth:"md",open:S,"aria-labelledby":"form-dialog-title",disableEscapeKeyDown:!0,onClose(e,a){"backdropClick"!==a&&w()},children:[(0,l.jsx)(n.Z,{id:"form-dialog-title",children:(0,l.jsxs)(p.ZP,{container:!0,spacing:6,children:[(0,l.jsx)(p.ZP,{item:!0,xs:12,md:6,children:y}),1===K.papelID&&(0,l.jsx)(p.ZP,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:(0,l.jsx)(g.Z,{data:null!==(a=null==B?void 0:B.departamentos)&&void 0!==a?a:[]})})]})}),(0,l.jsx)(d.Z,{children:(0,l.jsxs)(c.Z,{sx:{mb:3},children:[!G(null!==(o=null==B?void 0:B.departamentos)&&void 0!==o?o:[])&&(0,l.jsx)(x.Z,{severity:"warning",sx:{mb:4},children:(0,l.jsx)(f.Z,{variant:"body2",children:"Seu departamento n\xe3o est\xe1 habilitado para concluir este formul\xe1rio!"})}),P.status<=40&&(0,l.jsxs)(l.Fragment,{children:[z,A&&A.status&&(0,l.jsxs)(x.Z,{variant:"outlined",severity:"error",sx:{mt:2},children:["Por favor, verifique os campos abaixo:",(0,l.jsx)(f.Z,{variant:"subtitle1",color:"error",sx:{mt:2},children:A.errors.map((e,a)=>(0,l.jsxs)(f.Z,{variant:"body2",color:"error",children:["- ",e]},a))})]}),A&&2==K.papelID&&!A.status&&(0,l.jsx)(x.Z,{severity:"info",sx:{mt:2},children:2==T.quemPreenche&&"fornecedor"==_?"Ap\xf3s concluir o formul\xe1rio, o mesmo ser\xe1 enviado para an\xe1lise e conclus\xe3o da empresa ".concat(null==T?void 0:T.nomeFantasia,"!"):"Ap\xf3s concluir o formul\xe1rio, o mesmo n\xe3o poder\xe1 mais ser alterado!"}),!M&&(0,l.jsx)(x.Z,{severity:"warning",sx:{mt:2},children:"Este formul\xe1rio n\xe3o pode ser aprovado pois possui resposta que gera n\xe3o conformidade!"}),1==K.papelID&&(0,l.jsxs)(p.ZP,{container:!0,spacing:4,sx:{mt:4},children:[(0,l.jsx)(b.Z,{xs:12,md:3,title:"Data da conclus\xe3o",name:"fieldsFooter.dataConclusao",type:"date",value:null!==(i=null==B?void 0:B.dataConclusao)&&void 0!==i?i:new Date,typeValidation:"dataPassado",daysValidation:365,required:!0,form:Z}),(0,l.jsx)(I.Z,{xs:12,md:3,title:"Hora da conclus\xe3o",name:"fieldsFooter.horaConclusao",type:"time",value:null!==(j=null==B?void 0:B.horaConclusao)&&void 0!==j?j:(()=>{let e=new Date,a=e.getHours(),o=e.getMinutes();return"".concat(a,":").concat(o)})(),required:!0,form:Z}),(0,l.jsx)(p.ZP,{item:!0,xs:12,children:(0,l.jsx)(v.Z,{title:1==K.papelID?"Resultado do Processo":"Observa\xe7\xe3o",name:"status",value:J,form:Z,setResult:Q,papelID:K.papelID,hasNaoConformidade:H,options:[{value:70,color:"success",label:"Aprovado",disabled:!M},{value:60,color:"warning",label:"Aprovado Parcial"},{value:50,color:"error",label:"Reprovado"}]})})]})]}),P.status>=40&&P.naoConformidade&&(0,l.jsx)(f.Z,{variant:"body1",sx:{mt:2},children:"Concluir n\xe3o conformidades do formul\xe1rio? Ap\xf3s concluir, o mesmo n\xe3o poder\xe1 mais ser alterado!"})]})}),(0,l.jsx)(u.Z,{className:"dialog-actions-dense",children:(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[k&&(0,l.jsx)(s.Z,{variant:"outlined",color:"primary",onClick:w,children:"Fechar"}),N&&E&&(0,l.jsx)(s.Z,{variant:"contained",disabled:!G(null!==(C=null==B?void 0:B.departamentos)&&void 0!==C?C:[])||P.status<40&&(A&&A.status||1==K.papelID&&!J.status),color:"primary",onClick(){F(J)},children:"Concluir"})]})})]})})};a.Z=j},28871:function(e,a,o){var l=o(85893),i=o(67294),t=o(83830),s=o(87536),r=o(60664),n=o(40039),d=o(65698),u=o(32038),c=o(86501),m=o(11163),p=o(46099),x=o(42222),f=o(82755),h=o(92629),v=o(91757),D=o(71798),g=o(3404),b=o(51239),I=o(72819);let j=e=>{var a,o,j,C,Z;let{modelID:y}=e,z=(0,m.useRouter)(),{id:w,setId:S,idNc:F,setModelID:P,setLimpezaID:E}=(0,i.useContext)(t.X),{menu:k,user:N,loggedUnity:V,hasPermission:q}=(0,i.useContext)(n.V),[A,M]=(0,i.useState)(null),[H,R]=(0,i.useState)(null),O=w&&w>0?"edit":"new",_=(0,s.cI)({mode:"onChange"}),[T,B]=(0,i.useState)(!1),[L,U]=(0,i.useState)(!0),[W,K]=(0,i.useState)(!1),[X,G]=(0,i.useState)(!1),[J,Q]=(0,i.useState)({status:!1,errors:[]}),[Y,$]=(0,i.useState)(!1),ee=(0,g.n)("limpeza",z),ea=async()=>{try{let e={id:null!=w?w:0,modelID:null!=y?y:0,unidadeID:V.unidadeID},a=await r.h.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData:",a.data),_.reset(a.data),M(a.data.header),R(a.data.blocos)}catch(o){console.log(o);return}},eo=e=>{e.preventDefault();let a=_.getValues();el(a)},el=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:N.usuarioID,papelID:N.papelID,unidadeID:V.unidadeID}};try{if("new"===O){let o=await r.h.post("/formularios/limpeza/insertData",a);c.ZP.success("Dados cadastrados com sucesso!"),S(o.data.id),z.push("/formularios/limpeza")}else"edit"===O&&(await r.h.post("/formularios/limpeza/updateData/".concat(w),a),c.ZP.success("Dados atualizados com sucesso!"))}catch(l){console.log(l);return}finally{B(!T)}},ei=()=>{let e={status:!1,errors:[]};_.clearErrors(),(0,p.n9)(_,"header.dataInicio","Data Inicial",e),(0,p.n9)(_,"header.horaInicio","Hora Inicial",e),(0,p.n9)(_,"header.dataFim","Data Final",e),(0,p.n9)(_,"header.horaFim","Hora Final",e),(0,p.n9)(_,"header.departamento.id","Departamento respons\xe1vel pela limpeza",e),(0,p.n9)(_,"header.setor.id","Setor que foi limpo",e),(0,p.lz)(_,_.getValues("header.fields"),e),(0,p.IB)(_,_.getValues("blocos"),e);let a=(0,p.FU)(e);(J.status!==a.status||J.errors.length!==a.errors.length)&&Q(a)},et=async e=>{let a=_.getValues("info.naoConformidade"),o=_.getValues("fieldsFooter");if(w){console.log("\uD83D\uDE80 ~ conclude values:",e={form:{...o,...e,naoConformidade:a},params:{id:w,usuarioID:N.usuarioID,papelID:N.papelID,unidadeID:V.unidadeID,profissionalID:N.profissionalID}}),M(null);try{await r.h.post("".concat(z.pathname,"/conclude"),e),await el(_.getValues())}catch(l){console.log(l);return}finally{K(!1),B(!T)}}},es=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:N.usuarioID,papelID:N.papelID,unidadeID:V.unidadeID}};try{await r.h.post("".concat(z.pathname,"/reOpen/").concat(w),a),c.ZP.success(D.OD.successUpdate)}catch(o){console.log(o)}finally{B(!T)}},er=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.resposta&&1==e.resposta.bloqueiaFormulario&&(a=!1)})}),U(a)},en=()=>{S(A.modelo.id),z.push("/configuracoes/formularios/limpeza/")},ed=e=>{console.log("\uD83D\uDE80 ~ handleNewNC: ",A.limpeza.id,e.new.modelo.id),S(A.limpeza.id),E(A.limpeza.id),P(e.new.modelo.id),z.push("/formularios/limpeza/novo/?aba=nao-conformidade")},eu=[],ec={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,l.jsx)(v.Z,{}),disabled:!q(z.pathname,"editar"),route:null,type:null,action:es,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null,ncPending:!0};return A&&A.status.id>=40&&eu.push(ec),(0,x.z)(k,"/configuracoes/formularios")&&eu.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:en,modal:!1,icon:"bi:gear",identification:null}),(0,i.useEffect)(()=>{ea(),setTimeout(()=>{_.trigger()},300)},[w,V,T]),(0,l.jsxs)("form",{onSubmit:e=>eo(e),children:[(0,l.jsx)(d.Z,{id:w,btnNew:"edit"===O&&"limpeza"==ee,btnNewModal:1===N.papelID&&"edit"===O&&"limpeza"!=ee,handleNewModal:()=>$(!0),btnCancel:!0,btnSave:(null==A?void 0:null===(a=A.status)||void 0===a?void 0:a.id)<40,btnSend:(null==A?void 0:null===(o=A.status)||void 0===o?void 0:o.id)>=30&&(null==A?void 0:null===(j=A.status)||void 0===j?void 0:j.id)<=40,btnPrint:"edit"==O,btnDelete:(null==A?void 0:null===(C=A.status)||void 0===C?void 0:C.id)<40&&"edit"===O,onclickDelete:()=>G(!0),actions:"limpeza"==ee,handleSubmit:()=>_.handleSubmit(el),handleSend(){K(!0),ei(),er(H)},iconConclusion:"solar:check-read-linear",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:O,status:null==A?void 0:null===(Z=A.status)||void 0===Z?void 0:Z.id,module:"limpeza",actionsData:eu}),(0,l.jsx)(u.Z,{id:w,modelID:y,form:_,header:A,block:H,setBlock:R,defaultTab:"limpeza",onSubmit:el}),(0,l.jsx)(I.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:ed,size:"lg",setOpenModal:$,openModal:Y,form:_,children:(0,l.jsx)(b.Z,{type:"form",data:A,form:_})}),A&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.Z,{openModal:W,handleClose(){K(!1),ei()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:{status:A.status.id},canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:et,listErrors:J,canApprove:L,hasNaoConformidade:!0,type:"limpeza",unity:V,values:A,formularioID:4,modeloID:A.modelo.id,form:_}),(0,l.jsx)(h.Z,{open:X,handleClose:()=>G(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(w),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}})]})]})};a.Z=j}}]);