"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3966],{13966:function(e,a,o){o.d(a,{Z:function(){return ex}});var t=o(85893),r=o(67294),n=o(92477),l=o(934),s=o(40039),i=o(60565),d=o(49837),c=o(91359),u=o(79072),m=o(41470),p=o(3893),x=o(22841),h=o(8519);let f=e=>{let{value:a,label:o,disabled:r=!1,errors:n=!1}=e;return(0,t.jsx)(x.Z,{value:a,control:(0,t.jsx)(h.Z,{disabled:r,error:!!n}),label:o,fullWidth:!0,sx:{"& .MuiFormControlLabel-label":{color:"text.secondary"},"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})},b=e=>{let{form:a,data:o,disabled:r}=e;if(!o)return;let n=e=>{a.setValue("header.quemPreenche",e.target.value)};return(0,t.jsxs)(m.Z,{row:!0,name:"header.quemPreenche",defaultValue:o.quemPreenche,onChange:n,children:[(0,t.jsx)("p",{children:"Quem ir\xe1 preencher a n\xe3o conformidade?"}),(0,t.jsxs)(u.ZP,{container:!0,spacing:4,children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(f,{value:"1",label:"F\xe1brica",disabled:r})}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(f,{value:"2",label:"Fornecedor",disabled:r})}),2==a.watch("header.quemPreenche")&&(0,t.jsx)(u.ZP,{item:!0,xs:12,md:8,children:(0,t.jsx)(p.Z,{title:"Fornecedor acessa o Recebimento?",name:"header.fornecedorAcessaRecebimento",value:o.fornecedorAcessaRecebimento,form:a,disabled:r,helpText:"Se marcado, fornecesor poder\xe1 visualizar o formul\xe1rio de recebimento vinculado a esta n\xe3o conformidade."})})]})]})};var j=o(29630),v=o(44373),g=o(75158),D=o(60664);let Z=e=>{var a,o,r,n;let{value:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Qtd."}),(0,t.jsx)("p",{children:l.quantidade})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Qtd. Entrada"}),(0,t.jsx)("p",{children:l.quantidadeEntrada})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Data Fabrica\xe7\xe3o"}),(0,t.jsx)("p",{children:null!==(o=l.dataFabricacao)&&void 0!==o?o:"--"})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:4,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Apresenta\xe7\xe3o"}),(0,t.jsx)("p",{children:null!==(r=null===(a=l.apresentacao)||void 0===a?void 0:a.nome)&&void 0!==r?r:"--"})]}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Data de validade"}),(0,t.jsx)("p",{children:null!==(n=l.dataValidade)&&void 0!==n?n:"--"})]})]})},C=e=>{let{form:a,index:o,produto:n,handleCheck:l,disabled:s,change:i}=e,[d,c]=(0,r.useState)([]),m=async()=>{try{let e=await D.h.get("/cadastros/apresentacao");c(e.data)}catch(a){console.log("\uD83D\uDE80 ~ error:",a)}};return(0,r.useEffect)(()=>{m()},[]),(0,t.jsxs)(u.ZP,{container:!0,sx:{pb:2},children:[(0,t.jsx)("input",{type:"hidden",value:n.produtoID,name:"header.produtos[".concat(o,"].produtoID"),...a.register("header.produtos[".concat(o,"].produtoID"))}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,t.jsx)(x.Z,{control:(0,t.jsx)(g.Z,{onClick:e=>l(e,o),checked:!!n.checked_,disabled:s}),label:"".concat(n.nome," ").concat(n.lote?" - Lote: ".concat(n.lote):" - Lote n\xe3o informado"),size:"small",sx:{marginRight:"4px","&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})}),n.checked_&&(0,t.jsx)(u.ZP,{container:!0,spacing:4,sx:{pb:2},children:(0,t.jsx)(Z,{value:n})})]})};var y=o(21609);let I=e=>{let{form:a,data:o,disabled:n}=e;if(!o)return;let[l,s]=(0,r.useState)(o.produtos),i=(e,o)=>{let{checked:t}=e.target;a.setValue("header.produtos[".concat(o,"].checked_"),t);let r=l.map((e,a)=>a===o?{...e,checked_:t}:e);console.log("\uD83D\uDE80 ~ updatedProducts:",r),s(r),a.setValue("header.produtos",r)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(p.Z,{title:"Transporte",name:"header.transporte",value:o.transporte,form:a,disabled:n})}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,t.jsx)(p.Z,{title:"Produto",name:"header.produto",value:o.produto,form:a,disabled:n})}),a.watch("header.produto")&&(0,t.jsxs)(u.ZP,{container:!0,sx:{mt:4},children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,children:(0,t.jsxs)(j.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},className:"flex items-center gap-1",children:[(0,t.jsx)(y.Z,{icon:"ph:plant",className:"text-primary"}),"Selecione os produtos com N\xe3o Conformidade"]})}),(0,t.jsx)(u.ZP,{item:!0,xs:12,children:l&&l.map((e,o)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C,{index:o,produto:e,setProdutos:s,handleCheck:i,disabled:n,form:a},o),o<l.length-1&&(0,t.jsx)(v.Z,{})]}))})]})]})};var P=o(29308),N=o(50287),V=o(84220);let S=e=>{let{form:a,fields:o,disabled:r,getAddressByCep:n}=e,l=e=>{switch(e){case"telefone":case"telefone1":case"telefone2":return"telefone";case"cep":return"cep";case"cnpj":return"cnpj";default:return null}},s=e=>!!r&&r.length>0&&r.includes(e);return o&&o.map((e,o)=>{var i,d,c;return(0,t.jsxs)(t.Fragment,{children:[e&&"int"===e.tipo&&e.tabela&&(0,t.jsx)(V.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.tabela),type:e.tabela,options:e.options,value:null==e?void 0:e[e.tabela],mask:e.tabela,disabled:r||s(e.nomeColuna),alertRequired:1===e.obrigatorio,form:a},"select-".concat(o)),e&&"date"==e.tipo&&(0,t.jsx)(N.Z,{xs:12,md:4,title:"Data da avalia\xe7\xe3o",disabled:r||s(e.nomeColuna),value:null!==(i=null==e?void 0:e[e.nomeColuna])&&void 0!==i?i:new Date,type:e.nomeColuna,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),typeValidation:"dataPassado",daysValidation:365,alertRequired:1===e.obrigatorio,form:a},"datefield-".concat(o)),e&&"string"==e.tipo&&(0,t.jsx)(P.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),value:null!==(d=null==e?void 0:e[e.nomeColuna])&&void 0!==d?d:"",type:e.nomeColuna,getAddressByCep:n,mask:l(e.nomeColuna),disabled:!!(r||s(e.nomeColuna))||"cnpj"==e.nomeColuna,required:1===e.obrigatorio,alertRequired:1===e.obrigatorio,form:a},"input-".concat(o)),e&&"text"==e.tipo&&(0,t.jsx)(P.Z,{xs:12,md:12,multiline:!0,rows:6,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),value:null!==(c=null==e?void 0:e[e.nomeColuna])&&void 0!==c?c:"",type:e.nomeColuna,getAddressByCep:n,mask:l(e.nomeColuna),disabled:!!(r||s(e.nomeColuna))||"cnpj"==e.nomeColuna,required:1===e.obrigatorio,alertRequired:1===e.obrigatorio,form:a},"input-".concat(o))]})})};var F=o(22991);let E=e=>{var a;let{form:o,data:n,disabled:l}=e;if(!n)return;let s=()=>{let e=o.getValues("header.data"),a=parseInt(o.getValues("header.prazoSolucao"),10);if(!e||isNaN(a))return"--";let t=new Date(e+"T00:00:00");t.setDate(t.getDate()+a);let r=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),s=new Intl.DateTimeFormat("pt-BR",{weekday:"long"}).format(t),i="".concat(r,"/").concat(n,"/").concat(l," (").concat(s,")");return i};return(0,r.useEffect)(()=>{s()},[o.watch("header.data"),o.watch("header.prazoSolucao")]),(0,t.jsx)(d.Z,{children:(0,t.jsx)(c.Z,{children:(0,t.jsxs)(u.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,t.jsx)(F.Z,{data:null!==(a=null==n?void 0:n.setoresPreenchimento)&&void 0!==a?a:[]})}),(0,t.jsx)(N.Z,{xs:12,md:3,title:"Data",type:"date",required:!0,name:"header.data",value:n.data,disabled:l,typeValidation:"dataPassado",daysValidation:999999,form:o}),(0,t.jsx)(P.Z,{xs:12,md:3,title:"Hora",name:"header.hora",type:"time",required:!0,disabled:l,form:o}),(0,t.jsx)(P.Z,{xs:12,md:3,title:"Prazo para a solu\xe7\xe3o (em dias)",name:"header.prazoSolucao",disabled:l,required:!0,type:"number",form:o,helpText:"Informe o prazo pra solu\xe7\xe3o da n\xe3o conformidade. Ser\xe1 gerado um alerta no vencimento do prazo."}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:3,children:[(0,t.jsx)("label",{className:"opacity-60",children:"Vencimento"}),(0,t.jsx)("p",{children:s()})]}),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,t.jsx)(b,{form:o,data:n,disabled:l})}),(0,t.jsxs)(u.ZP,{item:!0,xs:12,md:12,children:[(0,t.jsx)("p",{children:"N\xe3o Conformidade do Recebimento:"}),(0,t.jsx)(u.ZP,{container:!0,item:!0,xs:12,md:12,children:(0,t.jsx)(I,{form:o,data:n,disabled:l})})]}),(0,t.jsx)(S,{form:o,fields:n.fields,disabled:l})]})})})};var q=o(99734);let k=e=>{let{form:a,data:o,setBlock:r,status:n,disabled:l,handleFileSelect:s,handleRemoveFile:i}=e;return(0,t.jsx)(t.Fragment,{children:o&&o.map((e,d)=>(0,t.jsx)(q.Z,{form:a,index:d,bloco:e,blockKey:"parRecebimentoMpNaoConformidadeModeloBlocoID",setBlocos:r,handleFileSelect:s,handleRemoveFile:i,status:n,blocos:o,disabled:l}))})};var w=o(87536),M=o(18194),A=o(11163),z=o.n(A),R=o(86501),Q=o(54225),_=o(1890),T=o(77745),B=o(95398),K=o(76779),J=o(44642),O=o(19604),L=o(48432),W=o(99070),H=o(82555),U=o(74811),X=o(55334),Y=o(62813);o(67569);var G=o(42222);let $=e=>{var a,o,n;let{data:l,form:i,setValidParams:d}=e;console.log("\uD83D\uDE80 ~ modal data:",l);let[c,m]=(0,r.useState)(null),{user:p}=(0,r.useContext)(s.V),x=()=>{if(!l)return;let e=l.sort((e,a)=>e.checked_&&!a.checked_?-1:!e.checked_&&a.checked_?1:0);m(e),e.map((e,a)=>{h(e.quantidade,e.quantidadeEntrada,a)})},h=(e,a,o)=>{if(!e||!a)return"--";let t=(0,G.JK)(e),r=(0,G.JK)(a),n=(0,G.Qp)(t-r);i.setValue("productsConclude.".concat(o,".diff"),n)};return(0,r.useEffect)(()=>{x()},[l]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(j.Z,{variant:"body1",color:"primary",sx:{fontWeight:600,mt:6},className:"flex items-center gap-1",children:[(0,t.jsx)(y.Z,{icon:"ph:plant",className:"text-primary"}),"Confer\xeancia dos produtos do Recebimento de MP"]}),c&&c.length>0&&c.map((e,r)=>{var l;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.ZP,{container:!0,spacing:4,sx:{mt:4},className:"items-center",children:[(0,t.jsx)(u.ZP,{item:!0,md:12,children:(0,t.jsx)(j.Z,{variant:"body2",sx:{fontWeight:600},children:"".concat(e.nome," ").concat(e.lote?" - Lote: ".concat(e.lote):" - Lote n\xe3o informado")})}),(0,t.jsxs)(u.ZP,{item:!0,md:2,children:[(0,t.jsx)("p",{className:"text-xs opacity-50",children:"Qtd. Recebimento"}),(0,t.jsx)("p",{children:e.quantidade})]}),e.checked_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{type:"hidden",name:"productsConclude.".concat(r,".recebimentoMpProdutoID"),value:e.recebimentoMpProdutoID,...i.register("productsConclude.".concat(r,".recebimentoMpProdutoID"))}),(0,t.jsx)("input",{type:"hidden",name:"productsConclude.".concat(r,".quantidade"),value:e.quantidade,...i.register("productsConclude.".concat(r,".quantidade"))}),(0,t.jsx)(P.Z,{md:2,title:"Qtd. Entrada",name:"productsConclude.".concat(r,".novaQuantidade"),defaultValue:e.quantidadeEntrada,helpText:"Quantidade recebida",required:!0,disabled:1!=p.papelID,form:i,mask:"fractioned3",onChange(a){(0,G.JK)(i.getValues("productsConclude[".concat(r,"].novaQuantidade")))>(0,G.JK)(e.quantidade)?d(!1):d(!0),h(e.quantidade,a,r)},errorText:(0,G.JK)(i.getValues("productsConclude[".concat(r,"].novaQuantidade")))>(0,G.JK)(e.quantidade)?"Quantidade excedida":null})]}):(0,t.jsxs)(u.ZP,{item:!0,md:2,children:[(0,t.jsx)("p",{className:"text-xs opacity-50",children:"Qtd. Entrada"}),(0,t.jsx)("p",{children:e.quantidadeEntrada})]}),(0,t.jsxs)(u.ZP,{item:!0,md:2,children:[(0,t.jsx)("p",{className:"text-xs opacity-50",children:"Diferen\xe7a"}),(0,t.jsx)("p",{children:i.watch("productsConclude.".concat(r,".diff"))})]}),(0,t.jsxs)(u.ZP,{item:!0,md:2,children:[(0,t.jsx)("p",{className:"text-xs opacity-50",children:"Data Fabrica\xe7\xe3o"}),(0,t.jsx)("p",{children:null!==(a=e.dataFabricacao)&&void 0!==a?a:"--"})]}),(0,t.jsxs)(u.ZP,{item:!0,md:2,children:[(0,t.jsx)("p",{className:"text-xs opacity-50",children:"Apresenta\xe7\xe3o"}),(0,t.jsx)("p",{children:null!==(o=null===(l=e.apresentacao)||void 0===l?void 0:l.nome)&&void 0!==o?o:"--"})]}),(0,t.jsxs)(u.ZP,{item:!0,md:2,children:[(0,t.jsx)("p",{className:"text-xs opacity-50",children:"Data Validade"}),(0,t.jsx)("p",{children:null!==(n=e.dataValidade)&&void 0!==n?n:"--"})]})]}),r<c.length-1&&(0,t.jsx)(v.Z,{sx:{pt:4}})]})})]})},ee=e=>{var a,o;let{form:n,title:l,text:i,handleClose:d,openModal:c,conclusionForm:m,status:p,canChange:x,btnCancel:h,btnConfirm:f,listErrors:b,canApprove:v,hasNaoConformidade:g,handleSend:D,type:Z,unity:C,values:y,formularioID:I,modeloID:P,produtos:N,setores:V}=e;if(!P)return null;let[S,E]=(0,r.useState)(!0),{user:q,loggedUnity:k,hasSectorPermission:w}=(0,r.useContext)(s.V),[M,A]=(0,r.useState)({}),{data:R}=(0,H.O)(),G=z(),ee=G.pathname.split("/")[2],ea=()=>(0,t.jsx)(W.BB,{children:(0,t.jsx)(W.T3,{size:"A4",style:{paddingHorizontal:25},children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.Z,{data:R}),"fornecedor"===ee&&(0,t.jsx)(X.default,{values:R},R),(0,t.jsx)(Y.Z,{})]})})});return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(_.Z,{fullWidth:!0,maxWidth:"lg",open:c,"aria-labelledby":"form-dialog-title",disableEscapeKeyDown:!0,onClose(e,a){"backdropClick"!==a&&d()},children:[(0,t.jsx)(T.Z,{id:"form-dialog-title",children:(0,t.jsxs)(u.ZP,{container:!0,spacing:6,children:[(0,t.jsx)(u.ZP,{item:!0,xs:12,md:6,children:l}),1===q.papelID&&(0,t.jsx)(u.ZP,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:(0,t.jsx)(F.Z,{data:null!=V?V:[]})})]})}),(0,t.jsx)(B.Z,{children:(0,t.jsxs)(J.Z,{sx:{mb:3},children:[!w(null!==(a=null==y?void 0:y.setores)&&void 0!==a?a:[])&&(0,t.jsx)(O.Z,{severity:"warning",sx:{mb:4},children:(0,t.jsx)(j.Z,{variant:"body2",children:"Seu setor n\xe3o est\xe1 habilitado para concluir este formul\xe1rio!"})}),p<=40&&(0,t.jsxs)(t.Fragment,{children:[b&&b.status&&(0,t.jsxs)(O.Z,{variant:"outlined",severity:"error",sx:{mt:2},children:["Por favor, verifique os campos abaixo:",(0,t.jsx)(j.Z,{variant:"subtitle1",color:"error",sx:{mt:2},children:b.errors.map((e,a)=>(0,t.jsxs)(j.Z,{variant:"body2",color:"error",children:["- ",e]},a))})]}),b&&2==q.papelID&&!b.status&&(0,t.jsx)(O.Z,{severity:"info",sx:{mt:2},children:2==C.quemPreenche&&"fornecedor"==Z?"Ap\xf3s concluir o formul\xe1rio, o mesmo ser\xe1 enviado para an\xe1lise e conclus\xe3o da empresa ".concat(null==C?void 0:C.nomeFantasia,"!"):"Ap\xf3s concluir o formul\xe1rio, o mesmo n\xe3o poder\xe1 mais ser alterado!"}),!v&&(0,t.jsx)(O.Z,{severity:"error",sx:{mt:2},children:"Este formul\xe1rio n\xe3o pode ser aprovado pois possui resposta que gera n\xe3o conformidade"}),1==q.papelID&&(0,t.jsx)(u.ZP,{container:!0,spacing:4,sx:{mt:4},children:(0,t.jsx)(u.ZP,{item:!0,xs:12,children:(0,t.jsx)(L.Z,{title:1==q.papelID?"Avalia\xe7\xe3o final da n\xe3o conformidade:":"Observa\xe7\xe3o",name:"status",value:M,form:n,setResult:A,papelID:q.papelID,hasNaoConformidade:g,options:[{value:80,color:"success",label:"Aceite",disabled:!v},{value:90,color:"error",label:"N\xe3o Aceite"}]})})}),"recebimentoMpNaoConformidade"==Z&&(0,t.jsx)($,{data:N,form:n,setValidParams:E})]}),p>=40&&(0,t.jsx)(j.Z,{variant:"body1",sx:{mt:2},children:"Concluir n\xe3o conformidades do formul\xe1rio? Ap\xf3s concluir, o mesmo n\xe3o poder\xe1 mais ser alterado!"})]})}),(0,t.jsx)(K.Z,{className:"dialog-actions-dense",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[h&&(0,t.jsx)(Q.Z,{variant:"outlined",color:"primary",onClick:d,children:"Fechar"}),f&&x&&(0,t.jsx)(W.z6,{document:(0,t.jsx)(ea,{}),children(e){let{blob:a,url:r,loading:n,error:l}=e;return(0,t.jsx)(Q.Z,{variant:"contained",disabled:!S||!w(null!==(o=null==y?void 0:y.setores)&&void 0!==o?o:[])||p<40&&(b&&b.status||1==q.papelID&&!M.status),color:"primary",onClick(){m(M,a)},children:"Concluir"})}})]})})]})})};var ea=o(92629),eo=o(91757),et=o(83830),er=o(7071),en=o(71798),el=o(72819),es=o(78432);let ei=(e,a,o,t)=>{e.setError(a,{type:"manual",message:"Campo obrigat\xf3rio"}),t.errors.includes(o)||(t.errors.push(o),t.status=!0)},ed=(e,a,o,t)=>{let r=e.getValues(a);r||ei(e,a,o,t)},ec=(e,a,o)=>{a&&Array.isArray(a)&&a.forEach((a,t)=>{let r=a.tabela?"header.fields[".concat(t,"].").concat(a.tabela):"header.fields[".concat(t,"].").concat(a.nomeColuna),n=e.getValues(r);1!==a.obrigatorio||n||ei(e,r,a.nomeCampo,o)})},eu=(e,a,o)=>{a&&Array.isArray(a)&&a.forEach((a,t)=>{a.itens.forEach((a,r)=>{var n;let l="blocos[".concat(t,"].itens[").concat(r,"].resposta"),s=e.getValues(l);(null==a?void 0:a.obrigatorio)!==1||s||ei(e,l,null==a?void 0:a.nome,o);let i=null==a?void 0:a.resposta;(null==i?void 0:i.anexo)===1&&(null==i?void 0:null===(n=i.anexosSolicitados)||void 0===n?void 0:n.length)>0&&i.anexosSolicitados.forEach((n,l)=>{let s="blocos[".concat(t,"].itens[").concat(r,"].resposta.anexosSolicitados[").concat(l,"].anexos"),i=e.getValues(s)||[];1!==n.obrigatorio||i&&0!==i.length||ei(e,s,"Anexo: ".concat(null==a?void 0:a.nome," / ").concat(null==n?void 0:n.nome),o)})})})},em=e=>({status:e.status,errors:[...e.errors]}),ep=e=>{var a,o,u,m,p,x,h;let f;let{id:b,recebimentoMpID:j,modelID:v}=e,g=z(),Z=b&&b>0?"edit":"new",{menu:C,user:y,loggedUnity:I,hasPermission:P}=(0,r.useContext)(s.V),{setTitle:N}=(0,r.useContext)(i.f),[V,S]=(0,r.useState)(null),[F,q]=(0,r.useState)(null),[A,Q]=(0,r.useState)(!1),[_,T]=(0,r.useState)(!1),[B,K]=(0,r.useState)({status:!1,errors:[]}),[J,O]=(0,r.useState)(!1),[L,W]=(0,r.useState)(!1),{setId:H,setModelID:U,setRecebimentoMpID:X}=(0,r.useContext)(et.X),Y=(0,w.cI)({mode:"onChange"}),$=e=>{let a=!0;return e.forEach(e=>{e.novaQuantidade&&(0,G.JK)(e.novaQuantidade)>(0,G.JK)(e.quantidade)&&(a=!1)}),a},ei=async e=>{let a=Y.getValues("productsConclude");if(b&&V.recebimento.id){if(!$(null!=a?a:[])){R.ZP.error("Quantidade naÌƒo pode ser maior que a quantidade do recebimento de MP!");return}e={form:{...e,products:a,prazo:Y.getValues("header.prazoSolucao"),data:Y.getValues("header.data"),data_:Y.getValues("header.data")&&Y.getValues("header.data").split("-").reverse().join("/"),hora:Y.getValues("header.hora"),transporte:Y.getValues("header.transporte"),produto:Y.getValues("header.produto")},params:{id:b,recebimentoMpID:V.recebimento.id,usuarioID:y.usuarioID,papelID:y.papelID,unidadeID:I.unidadeID,profissionalID:y.profissionalID}},S(null);try{await D.h.post("/formularios/recebimento-mp/nao-conformidade/conclude",e),await ef(Y.getValues())}catch(o){console.log(o);return}finally{T(!1),Q(!A)}console.log("\uD83D\uDE80 ~ conclude values:",e)}},ep=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:y.usuarioID,papelID:y.papelID,unidadeID:I.unidadeID}};console.log("\uD83D\uDE80 ~ reOpen:",a);try{await D.h.post("/formularios/recebimento-mp/nao-conformidade/reOpen/".concat(b),a),R.ZP.success(en.OD.successUpdate)}catch(o){console.log(o)}finally{Q(!A)}},ex=async()=>{try{let e={id:null!=b?b:0,modelID:null!=v?v:0,recebimentoMpID:null!=j?j:0,unidadeID:I.unidadeID,papelID:y.papelID},a=await D.h.post("/formularios/recebimento-mp/nao-conformidade/getData",e);204===a.status&&(H(null),g.push("/formularios/recebimento-mp/?aba=nao-conformidade")),console.log("\uD83D\uDE80 ~ getData: ",a.data),Y.reset(a.data),S(a.data.header),q(a.data.blocos)}catch(o){console.log(o);return}},eh=e=>{e.preventDefault();let a=Y.getValues();ef(a)},ef=async e=>{if(!e)return;if(1===y.papelID&&!e.header.transporte&&!e.header.produto){R.ZP.error("Selecione o tipo de n\xe3o conformidade (Transporte ou Produto)!");return}let a=e.header.produtos.some(e=>e.checked_);if(1===y.papelID&&e.header.produto&&!a){R.ZP.error("Selecione pelo menos um produto!");return}console.log("\uD83D\uDE80 ~ onSubmit values:",e);let o={form:e,auth:{usuarioID:y.usuarioID,profissionalID:y.profissionalID,papelID:y.papelID,unidadeID:I.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",o);try{if("new"===Z){let t=await D.h.post("/formularios/recebimento-mp/nao-conformidade/insertData",o);R.ZP.success("Dados cadastrados com sucesso!"),H(t.data.id),g.push("/formularios/recebimento-mp/?aba=nao-conformidade")}else"edit"===Z&&(await D.h.post("/formularios/recebimento-mp/nao-conformidade/updateData/".concat(b),o),R.ZP.success("Dados atualizados com sucesso!"))}catch(r){console.log(r);return}finally{Q(!A)}},eb=()=>{H(V.modelo.id),g.push("/configuracoes/formularios/recebimentomp-naoconformidade/")},ej=()=>{let e=Y.getValues("new");X(V.recebimento.id),U(e.modelo.id),g.push("/formularios/recebimento-mp/novo/?aba=nao-conformidade")},ev=[],eg={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,t.jsx)(eo.Z,{}),disabled:!P(g.pathname,"editar"),route:null,type:null,action:ep,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};1==y.papelID&&V&&V.status.id>=40&&ev.push(eg),1==y.papelID&&(f=!1,C.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(f=!0)})})}),f)&&ev.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:eb,modal:!1,icon:"bi:gear",identification:null});let eD=()=>{let e={status:!1,errors:[]};Y.clearErrors(),ed(Y,"header.data","Data",e),ed(Y,"header.hora","Hora",e),ed(Y,"header.prazoSolucao","Prazo para a solu\xe7\xe3o (em dias)",e),ec(Y,Y.getValues("header.fields"),e),eu(Y,Y.getValues("blocos"),e);let a=em(e);(B.status!==a.status||B.errors.length!==a.errors.length)&&K(a)},eZ=async(e,a)=>{let o=e.target.files;if(o&&o.length>0){var t,r;let n=new FormData;for(let l=0;l<o.length;l++)n.append("files[]",o[l]);n.append("usuarioID",y.usuarioID),n.append("unidadeID",I.unidadeID),n.append("parRecebimentoMpNaoConformidadeModeloBlocoID",null!==(t=a.parRecebimentoMpNaoConformidadeModeloBlocoID)&&void 0!==t?t:null),n.append("itemOpcaoAnexoID",null!==(r=a.itemOpcaoAnexoID)&&void 0!==r?r:null),await D.h.post("/formularios/recebimento-mp/nao-conformidade/saveAnexo/".concat(b,"/item/").concat(y.usuarioID,"/").concat(I.unidadeID),n).then(e=>{let a=Y.getValues();ef(a)}).catch(e=>{var a,o,t;R.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!!!")}).finally(()=>{Q(!A)})}},eC=async e=>{e&&await D.h.delete("/formularios/recebimento-mp/nao-conformidade/deleteAnexo/".concat(b,"/").concat(e.anexoID,"/").concat(I.unidadeID,"/").concat(y.usuarioID,"/item")).then(e=>{let a=Y.getValues();ef(a)}).catch(e=>{var a,o,t;R.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")}).finally(()=>{ex()})};return(0,r.useEffect)(()=>{N({icon:"typcn:warning-outline",title:"N\xe3o conformidade do Recebimento de MP",subtitle:{id:b,count:1,new:!1}}),ex(),setTimeout(()=>{Y.trigger()},300)},[A,y]),(0,t.jsx)("form",{onSubmit:e=>eh(e),children:V&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Z,{btnNewModal:1===y.papelID&&"edit"===Z,handleNewModal:()=>O(!0),btnCancel:!0,btnSave:(null==V?void 0:null===(a=V.status)||void 0===a?void 0:a.id)<40,btnSend:1===y.papelID&&(null==V?void 0:null===(o=V.status)||void 0===o?void 0:o.id)>=30&&(null==V?void 0:null===(u=V.status)||void 0===u?void 0:u.id)<=40||2===y.papelID&&(null==V?void 0:null===(m=V.status)||void 0===m?void 0:m.id)===30,btnPrint:"edit"==Z,btnDelete:1===y.papelID&&(null==V?void 0:null===(p=V.status)||void 0===p?void 0:p.id)<40&&"edit"===Z,onclickDelete:()=>W(!0),actionsData:ev,actions:1===y.papelID,handleSubmit:()=>Y.handleSubmit(ef),handleSend(){T(!0),eD()},iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"N\xe3o conformidade do Recebimento de MP",type:Z,status:null==V?void 0:null===(x=V.status)||void 0===x?void 0:x.id}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)(er.Z,{size:"small",HeaderFiel:!0,skin:"light",color:V.status.color,label:V.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,t.jsx)(er.Z,{size:"small",HeaderFiel:!0,skin:"light",label:V.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(d.Z,{children:(0,t.jsx)(c.Z,{className:"space-y-2 ",children:(0,t.jsx)(M.Z,{data:V})})}),(0,t.jsx)(E,{form:Y,data:V,disabled:(null===(h=V.status)||void 0===h?void 0:h.id)>=40||1!=y.papelID}),"edit"===Z&&(0,t.jsx)(k,{form:Y,data:F,setBlock:q,handleFileSelect:eZ,handleRemoveFile:eC,status:V.status.id,disabled:V.status.id>=40||V.fornecedorAcessaRecebimento&&1===y.papelID}),(0,t.jsx)(l.Z,{id:b,parFormularioID:3},A)]}),(0,t.jsx)(ee,{openModal:_,handleClose(){T(!1)},title:"Concluir N\xe3o Conformidade do Recebimento de MP",text:"Deseja realmente concluir este formul\xe1rio?",status:V.status.id,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ei,canApprove:!0,type:"recebimentoMpNaoConformidade",listErrors:B,unity:I,values:null,formularioID:3,modeloID:V.modelo.id,produtos:Y.getValues("header.produtos"),form:Y,setores:V.setoresConclusao}),(0,t.jsx)(ea.Z,{open:L,handleClose:()=>W(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(b),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,t.jsx)(el.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:ej,size:"lg",setOpenModal:O,openModal:J,children:(0,t.jsx)(es.Z,{type:"form",data:V,form:Y})})]})})};var ex=ep}}]);