"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9274],{29274:function(e,t,i){var a=i(85893),s=i(11163),o=i.n(s),l=i(67294),n=i(60664),r=i(49837),d=i(91359),u=i(79072),c=i(80562),p=i(54225),f=i(87536),m=i(86501),v=i(45061),x=i(86887),h=i(64165),D=i(60565),g=i(83830),j=i(40039),Z=i(29308),I=i(50287),b=i(41088),S=i(21609),w=i(67569),y=i(84220);let C=e=>{var t,i,s;let{id:C}=e,[P,F]=(0,l.useState)(!1),[N,T]=(0,l.useState)(null),{setId:O}=(0,l.useContext)(g.X),k=o(),M=C&&C>0?"edit":"new",q=k.pathname,{title:E}=(0,l.useContext)(D.f),{loggedUnity:A,user:_}=(0,l.useContext)(j.V),{startLoading:U,stopLoading:z}=(0,b.Z)(),[L,V]=(0,l.useState)([]),Y=new Date().toISOString().substring(0,10),{trigger:W,handleSubmit:B,reset:H,setValue:Q,control:R,formState:{errors:X},register:G}=(0,f.cI)({mode:"onChange"}),J=async e=>{let t={...e,usuarioID:_.usuarioID,unidadeID:A.unidadeID};if(console.log("\uD83D\uDE80 ~ onSubmit:",t),!K(e)){m.ZP.error("N\xe3o \xe9 permitido repetir profissional ativo em um setor!");return}try{"new"===M?await n.h.post("cadastros/setor/new/insertData",t).then(e=>{k.push("".concat((0,h.g_)(q))),O(e.data.id),m.ZP.success(h.OD.successNew)}):"edit"===M&&(await n.h.post("".concat(q,"/updateData/").concat(C),t),m.ZP.success(h.OD.successUpdate))}catch(i){i.response&&409===i.response.status?m.ZP.error(h.OD.errorRepeated):console.log(i)}finally{z()}},K=e=>{let t=!0;return e.fields.profissionais.length>1&&e.fields.profissionais.map((i,a)=>{e.fields.profissionais.map((e,s)=>{a===s||i.profissional.id!==e.profissional.id||i.dataFim||e.dataFim||(t=!1)})}),t},$=async()=>{try{await n.h.delete("".concat(q,"/").concat(C,"/").concat(_.usuarioID,"/").concat(A.unidadeID)),O(null),F(!1),m.ZP.success(h.OD.successDelete)}catch(e){e.response&&409===e.response.status?(m.ZP.error(h.OD.pendingDelete),F(!1)):console.log(e)}},ee=async()=>{try{if("edit"===M){let e=await n.h.post("".concat(q,"/getData/").concat(C),{id:C});T(e.data),H(e.data)}else T({fields:{nome:"",status:1,profissionais:[]}}),H({...N,fields:{...N.fields}})}catch(t){console.log(t)}},et=async()=>{let e=await n.h.get("/cadastros/profissional?unidadeID=".concat(A.unidadeID,"&papelID=").concat(A.papelID)),t=e.data.filter(e=>1===e.statusID);V(t)};(0,l.useEffect)(()=>{ee(),et(),setTimeout(()=>{W()},300)},[C]);let{fields:ei,append:ea,remove:es}=(0,f.Dq)({control:R,name:"fields.profissionais"});return(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsxs)("form",{onSubmit:B(J),children:[(0,a.jsx)(x.Z,{btnCancel:!0,btnNew:!0,btnSave:!0,handleSubmit:()=>B(J),btnDelete:"edit"===M,onclickDelete:()=>F(!0),type:M}),(0,a.jsx)(r.Z,{children:(0,a.jsx)(d.Z,{children:(0,a.jsxs)(u.ZP,{container:!0,spacing:5,children:[(0,a.jsx)(Z.Z,{xs:12,md:11,title:"Nome",name:"fields.nome",required:!0,control:R,errors:null==X?void 0:null===(t=X.fields)||void 0===t?void 0:t.nome}),(0,a.jsx)(w.Z,{xs:1,md:1,title:"Ativo",name:"fields.status",value:null==N?void 0:null===(i=N.fields)||void 0===i?void 0:i.status,typePage:M,register:G}),(0,a.jsx)(u.ZP,{item:!0,xs:12,children:(0,a.jsxs)("div",{className:"flex items-center gap-2 pb-1 pt-2",children:[(0,a.jsx)("div",{className:"",children:(0,a.jsx)(S.Z,{icon:"material-symbols:engineering-outline",className:"text-3xl"})}),(0,a.jsx)("div",{className:"flex flex-col gap-0",children:(0,a.jsx)("p",{className:"text-xl",children:"Profissionais"})})]})}),ei.map((e,t)=>{var i,o,n,r,d,p,f,m,v,x,h,D,g,j,Z;return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)("input",{type:"hidden",name:"fields.profissionais[".concat(t,"].id"),value:e.id}),(0,a.jsx)(y.Z,{xs:12,md:7,title:"Profissional",name:"fields.profissionais[".concat(t,"].profissional"),value:null==N?void 0:null===(i=N.fields)||void 0===i?void 0:null===(o=i.profissionais)||void 0===o?void 0:null===(n=o[t])||void 0===n?void 0:n.profissional,required:!0,options:null!=L?L:[],register:G,setValue:Q,control:R,errors:null==X?void 0:null===(r=X.fields)||void 0===r?void 0:null===(d=r.profissionais)||void 0===d?void 0:null===(p=d[t])||void 0===p?void 0:p.profissional,opacity:0===e.status}),(0,a.jsx)(I.Z,{xs:12,md:2,title:"Data In\xedcio",name:"fields.profissionais[".concat(t,"].dataInicio"),value:null!==(s=null==N?void 0:null===(f=N.fields)||void 0===f?void 0:null===(m=f.profissionais)||void 0===m?void 0:null===(v=m[t])||void 0===v?void 0:v.dataInicio)&&void 0!==s?s:Y,required:!0,register:G,control:R,errors:null==X?void 0:null===(x=X.fields)||void 0===x?void 0:null===(h=x.profissionais)||void 0===h?void 0:null===(D=h[t])||void 0===D?void 0:D.dataInicio,opacity:0===e.status}),(0,a.jsx)(I.Z,{xs:12,md:2,title:"Data Fim",name:"fields.profissionais[".concat(t,"].dataFim"),value:null==N?void 0:null===(g=N.fields)||void 0===g?void 0:null===(j=g.profissionais)||void 0===j?void 0:null===(Z=j[t])||void 0===Z?void 0:Z.dataFim,register:G,control:R,opacity:0===e.status}),(0,a.jsx)(u.ZP,{item:!0,xs:12,md:1,className:"flex items-center",children:(0,a.jsx)(c.Z,{color:"error",size:"small",onClick:()=>es(t),children:(0,a.jsx)(S.Z,{icon:"tabler:trash-filled"})})})]},e.id)}),(0,a.jsx)(u.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{variant:"outlined",color:"primary",onClick(){ea({id:null,dataInicio:new Date}),W()},startIcon:(0,a.jsx)(S.Z,{icon:"material-symbols:add-circle-outline-rounded"}),children:"Inserir Profissional"})})]})})})]}),(0,a.jsx)(v.Z,{text:"Tem certeza que deseja excluir?",title:"Excluir "+E.title,openModal:P,handleClose:()=>F(!1),handleSubmit:$,btnCancel:!0,btnConfirm:!0})]})};t.Z=C},50287:function(e,t,i){var a=i(85893),s=i(79072),o=i(55343),l=i(67836),n=i(87536),r=i(62097),d=i(67294),u=i(64165);let c=e=>{let{xs:t,md:i,title:c,required:p,disabled:f,type:m,value:v,name:x,typeValidation:h,errors:D,alertRequired:g,control:j,opacity:Z}=e,I=(0,r.Z)(),[b,S]=(0,d.useState)({}),[w,y]=(0,d.useState)(null);(0,d.useEffect)(()=>{h&&v&&P(h,x,v)},[h,v,x]);let C=e=>{let t=new Date(e+"T00:00:00"),i=t.getUTCDate().toString().padStart(2,"0"),a=(t.getUTCMonth()+1).toString().padStart(2,"0"),s=t.getUTCFullYear();return"".concat(s,"-").concat(a,"-").concat(i)},P=(e,t,i,a)=>{let s=new Date(i+"T00:00:00"),o=(0,u.HD)(e,s,a);S(e=>({...e,[t]:o}))},F=e=>{let t=new Date,i=new Date(e+"T00:00:00");return"dataAtual"===h&&i.toDateString()!==t.toDateString()?(y("A data deve ser a data atual"),!1):"dataPassado"===h&&i>=t?(y("A data deve ser do passado"),!1):"dataFutura"===h&&i<=t?(y("A data deve ser do futuro"),!1):(y(null),!0)};return(0,a.jsx)(s.ZP,{item:!0,xs:t,md:i,sx:{my:1},children:(0,a.jsx)(o.Z,{fullWidth:!0,children:(0,a.jsx)(n.Qr,{name:x,control:j,rules:{required:p},render(e){let{field:t}=e;return(0,a.jsx)(l.Z,{type:null!=m?m:"date",size:"small",label:c,disabled:!!f,defaultValue:v?C(v):"",error:!!D||!!w,helperText:w,onChange(e){let i=e.target.value;F(i)&&(t.onChange(i),h&&P(h,x,i))},variant:"outlined",fullWidth:!0,InputLabelProps:{shrink:!0},inputProps:{min:"dataFutura"===h?new Date().toISOString().split("T")[0]:void 0,max:"dataPassado"===h?new Date().toISOString().split("T")[0]:new Date(new Date().setFullYear(new Date().getFullYear()+50)).toISOString().split("T")[0]},sx:{opacity:Z?.4:1,"& .MuiInputBase-input":{padding:"10px 14px"},...g&&!(null==t?void 0:t.value)&&{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:I.palette.error.main},"&:hover fieldset":{borderColor:I.palette.error.main},"&.Mui-focused fieldset":{borderColor:I.palette.error.main}},"& .MuiInputLabel-root":{color:I.palette.error.main},"& .MuiInputLabel-root.Mui-focused":{color:I.palette.error.main}}}})}})})})};t.Z=c}}]);