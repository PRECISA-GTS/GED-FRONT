"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3079],{23079:function(e,a,o){o.d(a,{Z:function(){return ed}});var r=o(85893),t=o(67294),s=o(92477),l=o(934),n=o(40039),i=o(60565),d=o(49837),c=o(91359),u=o(79072),m=o(41470),x=o(3893),p=o(22841),h=o(8519);let j=e=>{let{value:a,label:o,disabled:t=!1,errors:s=!1}=e;return(0,r.jsx)(p.Z,{value:a,control:(0,r.jsx)(h.Z,{disabled:t,error:!!s}),label:o,fullWidth:!0,sx:{"& .MuiFormControlLabel-label":{color:"text.secondary"},"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})},f=e=>{let{form:a,data:o,disabled:t}=e;if(!o)return;let s=e=>{a.setValue("header.quemPreenche",e.target.value)};return(0,r.jsxs)(m.Z,{row:!0,name:"header.quemPreenche",defaultValue:o.quemPreenche,onChange:s,children:[(0,r.jsx)("p",{children:"Quem ir\xe1 preencher a n\xe3o conformidade?"}),(0,r.jsxs)(u.ZP,{container:!0,spacing:4,children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(j,{value:"1",label:"F\xe1brica",disabled:t})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(j,{value:"2",label:"Fornecedor",disabled:t})}),2==a.watch("header.quemPreenche")&&(0,r.jsx)(u.ZP,{item:!0,xs:12,md:8,children:(0,r.jsx)(x.Z,{title:"Fornecedor acessa o Recebimento?",name:"header.fornecedorAcessaRecebimento",value:o.fornecedorAcessaRecebimento,register:a.register,disabled:t,helpText:"Se marcado, fornecesor poder\xe1 visualizar o formul\xe1rio de recebimento vinculado a esta n\xe3o conformidade."})})]})]})};var v=o(29630),b=o(44373),g=o(75158),Z=o(60664);let D=e=>{let{value:a}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Qtd."}),(0,r.jsx)("p",{children:a.quantidade})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Qtd. Entrada"}),(0,r.jsx)("p",{children:a.quantidadeEntrada})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Data Fabrica\xe7\xe3o"}),(0,r.jsx)("p",{children:a.dataFabricacao})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"N\xba Lote"}),(0,r.jsx)("p",{children:a.lote})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Apresenta\xe7\xe3o"}),(0,r.jsx)("p",{children:a.apresentacao.nome})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Data de validade"}),(0,r.jsx)("p",{children:a.dataValidade})]})]})},C=e=>{let{index:a,produto:o,handleCheck:s,setValue:l,register:n,control:i,errors:d,disabled:c,change:m}=e,[x,h]=(0,t.useState)([]),j=async()=>{try{let e=await Z.h.get("/cadastros/apresentacao");h(e.data)}catch(a){console.log("\uD83D\uDE80 ~ error:",a)}};return(0,t.useEffect)(()=>{j()},[]),(0,r.jsxs)(u.ZP,{container:!0,sx:{pb:2},children:[(0,r.jsx)("input",{type:"hidden",value:o.produtoID,name:"header.produtos[".concat(a,"].produtoID"),...n("header.produtos[".concat(a,"].produtoID"))}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,r.jsx)(p.Z,{control:(0,r.jsx)(g.Z,{onClick:e=>s(e,a),checked:!!o.checked_,disabled:c}),label:o.nome,size:"small",sx:{marginRight:"4px","&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})}),o.checked_&&(0,r.jsx)(D,{value:o})]})};var y=o(21609);let P=e=>{let{form:a,data:o,disabled:s}=e;if(!o)return;let[l,n]=(0,t.useState)(o.produtos),i=(e,o)=>{let{checked:r}=e.target;a.setValue("header.produtos[".concat(o,"].checked_"),r);let t=l.map((e,a)=>a===o?{...e,checked_:r}:e);n(t)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(x.Z,{title:"Transporte",name:"header.transporte",value:o.transporte,register:a.register,disabled:s})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(x.Z,{title:"Produto",name:"header.produto",value:o.produto,register:a.register,disabled:s})}),a.watch("header.produto")&&(0,r.jsxs)(u.ZP,{container:!0,sx:{mt:4},children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,children:(0,r.jsxs)(v.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},className:"flex items-center gap-1",children:[(0,r.jsx)(y.Z,{icon:"ph:plant",className:"text-primary"}),"Selecione os produtos com N\xe3o Conformidade"]})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,children:l&&l.map((e,o)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C,{index:o,produto:e,setProdutos:n,handleCheck:i,disabled:s,getValues:a.getValues,setValue:a.setValue,register:a.register,control:a.control,errors:a.errors},o),o<l.length-1&&(0,r.jsx)(b.Z,{})]}))})]})]})};var I=o(29308),N=o(50287),V=o(84220);let k=e=>{let{form:a,fields:o,disabled:t,getAddressByCep:s}=e,l=e=>{switch(e){case"telefone":case"telefone1":case"telefone2":return"telefone";case"cep":return"cep";case"cnpj":return"cnpj";default:return null}},n=e=>!!t&&t.length>0&&t.includes(e);return o&&o.map((e,o)=>{var i,d,c,u,m,x,p,h,j,f,v,b,g,Z,D;return(0,r.jsxs)(r.Fragment,{children:[e&&"int"===e.tipo&&e.tabela&&(0,r.jsx)(V.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.tabela),type:e.tabela,options:e.options,value:null==e?void 0:e[e.tabela],mask:e.tabela,disabled:t||n(e.nomeColuna),alertRequired:1===e.obrigatorio,register:a.register,setValue:a.setValue,control:a.control,errors:null===(i=a.errors)||void 0===i?void 0:null===(d=i.fields)||void 0===d?void 0:null===(c=d[o])||void 0===c?void 0:c[e.tabela]},"select-".concat(o)),e&&"date"==e.tipo&&(0,r.jsx)(N.Z,{xs:12,md:4,title:"Data da avalia\xe7\xe3o",disabled:t||n(e.nomeColuna),value:null!==(g=null==e?void 0:e[e.nomeColuna])&&void 0!==g?g:new Date,type:e.nomeColuna,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),typeValidation:"dataPassado",daysValidation:365,alertRequired:1===e.obrigatorio,errors:null===(u=a.errors)||void 0===u?void 0:null===(m=u.fields)||void 0===m?void 0:null===(x=m[o])||void 0===x?void 0:x[e.nomeColuna],control:a.control,register:a.register},"datefield-".concat(o)),e&&"string"==e.tipo&&(0,r.jsx)(I.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),value:null!==(Z=null==e?void 0:e[e.nomeColuna])&&void 0!==Z?Z:"",type:e.nomeColuna,getAddressByCep:s,mask:l(e.nomeColuna),disabled:!!(t||n(e.nomeColuna))||"cnpj"==e.nomeColuna,alertRequired:1===e.obrigatorio,errors:null===(p=a.errors)||void 0===p?void 0:null===(h=p.fields)||void 0===h?void 0:null===(j=h[o])||void 0===j?void 0:j.nomeColuna,register:a.register,control:a.control},"input-".concat(o)),e&&"text"==e.tipo&&(0,r.jsx)(I.Z,{xs:12,md:12,multiline:!0,rows:6,title:e.nomeCampo,name:"header.fields[".concat(o,"].").concat(e.nomeColuna),value:null!==(D=null==e?void 0:e[e.nomeColuna])&&void 0!==D?D:"",type:e.nomeColuna,getAddressByCep:s,mask:l(e.nomeColuna),disabled:!!(t||n(e.nomeColuna))||"cnpj"==e.nomeColuna,alertRequired:1===e.obrigatorio,register:a.register,control:a.control,errors:null===(f=a.errors)||void 0===f?void 0:null===(v=f.fields)||void 0===v?void 0:null===(b=v[o])||void 0===b?void 0:b.nomeColuna},"input-".concat(o))]})})};var S=o(22991);let q=e=>{var a,o,s,l,n;let{form:i,data:m,disabled:x}=e;if(!m)return;let p=()=>{let e=i.getValues("header.data"),a=parseInt(i.getValues("header.prazoSolucao"),10);if(!e||isNaN(a))return"--";let o=new Date(e+"T00:00:00");o.setDate(o.getDate()+a);let r=String(o.getDate()).padStart(2,"0"),t=String(o.getMonth()+1).padStart(2,"0"),s=o.getFullYear();return"".concat(r,"/").concat(t,"/").concat(s)};return(0,t.useEffect)(()=>{p()},[i.watch("header.data"),i.watch("header.prazoSolucao")]),(0,r.jsx)(d.Z,{children:(0,r.jsx)(c.Z,{children:(0,r.jsxs)(u.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,r.jsx)(S.Z,{data:null!==(n=null==m?void 0:m.setoresPreenchimento)&&void 0!==n?n:[]})}),(0,r.jsx)(N.Z,{xs:12,md:3,title:"Data",type:"date",required:!0,name:"header.data",register:i.register,control:i.control,value:m.data,disabled:x,typeValidation:"dataPassado",daysValidation:999999,errors:null===(a=i.errors)||void 0===a?void 0:null===(o=a.header)||void 0===o?void 0:o.data}),(0,r.jsx)(I.Z,{xs:12,md:3,title:"Hora",name:"header.hora",type:"time",disabled:x,register:i.register,control:i.control,errors:null===(s=i.errors)||void 0===s?void 0:null===(l=s.header)||void 0===l?void 0:l.hora}),(0,r.jsx)(I.Z,{xs:12,md:3,title:"Prazo para a solu\xe7\xe3o (em dias)",name:"header.prazoSolucao",disabled:x,required:!0,type:"number",control:i.control,helpText:"Informe o prazo pra solu\xe7\xe3o da n\xe3o conformidade. Ser\xe1 gerado um alerta no vencimento do prazo."}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:3,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Vencimento"}),(0,r.jsx)("p",{className:"text-red-500",children:p()})]}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,r.jsx)(f,{form:i,data:m,disabled:x})}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:12,children:[(0,r.jsx)("p",{children:"N\xe3o Conformidade do Recebimento:"}),(0,r.jsx)(u.ZP,{container:!0,item:!0,xs:12,md:12,children:(0,r.jsx)(P,{form:i,data:m,disabled:x})})]}),(0,r.jsx)(k,{form:i,fields:m.fields,disabled:x})]})})})};var F=o(99734);let w=e=>{let{form:a,data:o,setBlock:t,status:s,disabled:l}=e;return console.log("\uD83D\uDE80 ~ Block:",o),(0,r.jsx)(r.Fragment,{children:o&&o.map((e,n)=>{var i;return(0,r.jsx)(F.Z,{index:n,bloco:e,blockKey:"parRecebimentoMpNaoConformidadeModeloBlocoID",setBlocos:t,status:s,blocos:o,disabled:l,setValue:a.setValue,getValues:a.getValues,register:a.register,control:a.control,errors:null===(i=a.errors)||void 0===i?void 0:i.blocos})})})};var M=o(87536),E=o(18194),z=o(11163),R=o.n(z),A=o(86501),Q=o(54225),_=o(1890),T=o(77745),K=o(95398),B=o(76779),J=o(44642),O=o(19604),W=o(48432),L=o(99070),H=o(82555),U=o(74811),X=o(55334),Y=o(62813),G=o(42222);let $=e=>{let{data:a,form:o,setValidParams:s}=e,[l,n]=(0,t.useState)(null),i=()=>{if(!a)return;let e=a.sort((e,a)=>e.checked_&&!a.checked_?-1:!e.checked_&&a.checked_?1:0);n(e),e.map((e,a)=>{d(e.quantidade,e.quantidadeEntrada,a)})},d=(e,a,r)=>{if(!e||!a)return"--";let t=(0,G.JK)(e),s=(0,G.JK)(a),l=(0,G.Qp)(t-s);o.setValue("productsConclude.".concat(r,".diff"),l)};return(0,t.useEffect)(()=>{i()},[a]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(v.Z,{variant:"body1",color:"primary",sx:{fontWeight:600,mt:6},className:"flex items-center gap-1",children:[(0,r.jsx)(y.Z,{icon:"ph:plant",className:"text-primary"}),"Confer\xeancia dos produtos do Recebimento de MP"]}),l&&l.length>0&&l.map((e,a)=>{var t,n,i;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.ZP,{container:!0,spacing:4,sx:{mt:4},className:"items-center",children:[(0,r.jsx)(u.ZP,{item:!0,md:12,children:(0,r.jsx)(v.Z,{variant:"body2",sx:{fontWeight:600},children:e.nome})}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Qtd. Recebimento"}),(0,r.jsx)("p",{children:e.quantidade})]}),e.checked_?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"hidden",name:"productsConclude.".concat(a,".recebimentoMpProdutoID"),value:e.recebimentoMpProdutoID,...o.register("productsConclude.".concat(a,".recebimentoMpProdutoID"))}),(0,r.jsx)("input",{type:"hidden",name:"productsConclude.".concat(a,".quantidade"),value:e.quantidade,...o.register("productsConclude.".concat(a,".quantidade"))}),(0,r.jsx)(I.Z,{md:2,title:"Qtd. Entrada",name:"productsConclude.".concat(a,".novaQuantidade"),defaultValue:e.quantidadeEntrada,helpText:"Quantidade recebida",required:!0,register:o.register,control:o.control,errors:null===(t=o.errors)||void 0===t?void 0:null===(n=t.productsConclude)||void 0===n?void 0:null===(i=n[a])||void 0===i?void 0:i.novaQuantidade,mask:"fractioned3",onChange(r){(0,G.JK)(o.getValues("productsConclude[".concat(a,"].novaQuantidade")))>(0,G.JK)(e.quantidade)?s(!1):s(!0),d(e.quantidade,r,a)},errorText:(0,G.JK)(o.getValues("productsConclude[".concat(a,"].novaQuantidade")))>(0,G.JK)(e.quantidade)?"Quantidade excedida":null})]}):(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Qtd. Entrada"}),(0,r.jsx)("p",{children:e.quantidadeEntrada})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Diferen\xe7a"}),(0,r.jsx)("p",{children:o.watch("productsConclude.".concat(a,".diff"))})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Data Fabrica\xe7\xe3o"}),(0,r.jsx)("p",{children:e.dataFabricacao})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Lote"}),(0,r.jsx)("p",{children:e.lote})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Data Validade"}),(0,r.jsx)("p",{children:e.dataValidade})]})]}),a<l.length-1&&(0,r.jsx)(b.Z,{sx:{pt:4}})]})})]})},ee=e=>{var a,o;let{title:s,text:l,handleClose:i,openModal:d,conclusionForm:c,status:m,canChange:x,btnCancel:p,btnConfirm:h,listErrors:j,canApprove:f,hasNaoConformidade:b,handleSend:g,type:Z,unity:D,values:C,formularioID:y,modeloID:P,form:I,produtos:N,setores:V}=e;if(!P)return null;let[k,q]=(0,t.useState)(!0),{user:F,loggedUnity:w,hasSectorPermission:M}=(0,t.useContext)(n.V),[E,z]=(0,t.useState)({}),{data:A}=(0,H.O)(),G=R(),ee=G.pathname.split("/")[2],ea=()=>(0,r.jsx)(L.BB,{children:(0,r.jsx)(L.T3,{size:"A4",style:{paddingHorizontal:25},children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U.Z,{data:A}),"fornecedor"===ee&&(0,r.jsx)(X.default,{values:A},A),(0,r.jsx)(Y.Z,{})]})})});return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(_.Z,{fullWidth:!0,maxWidth:"lg",open:d,"aria-labelledby":"form-dialog-title",disableEscapeKeyDown:!0,onClose(e,a){"backdropClick"!==a&&i()},children:[(0,r.jsx)(T.Z,{id:"form-dialog-title",children:(0,r.jsxs)(u.ZP,{container:!0,spacing:6,children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:6,children:s}),1===F.papelID&&(0,r.jsx)(u.ZP,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:(0,r.jsx)(S.Z,{data:null!=V?V:[]})})]})}),(0,r.jsx)(K.Z,{children:(0,r.jsxs)(J.Z,{sx:{mb:3},children:[!M(null!==(a=null==C?void 0:C.setores)&&void 0!==a?a:[])&&(0,r.jsx)(O.Z,{severity:"warning",sx:{mb:4},children:(0,r.jsx)(v.Z,{variant:"body2",children:"Seu setor n\xe3o est\xe1 habilitado para concluir este formul\xe1rio!"})}),m<=40&&(0,r.jsxs)(r.Fragment,{children:[j&&j.status&&(0,r.jsxs)(O.Z,{variant:"outlined",severity:"error",sx:{mt:2},children:["Por favor, verifique os campos abaixo:",(0,r.jsx)(v.Z,{variant:"subtitle1",color:"error",sx:{mt:2},children:j.errors.map((e,a)=>(0,r.jsxs)(v.Z,{variant:"body2",color:"error",children:["- ",e]},a))})]}),j&&2==F.papelID&&!j.status&&(0,r.jsx)(O.Z,{severity:"info",sx:{mt:2},children:2==D.quemPreenche&&"fornecedor"==Z?"Ap\xf3s concluir o formul\xe1rio, o mesmo ser\xe1 enviado para an\xe1lise e conclus\xe3o da empresa ".concat(null==D?void 0:D.nomeFantasia,"!"):"Ap\xf3s concluir o formul\xe1rio, o mesmo n\xe3o poder\xe1 mais ser alterado!"}),!f&&(0,r.jsx)(O.Z,{severity:"error",sx:{mt:2},children:"Este formul\xe1rio n\xe3o pode ser aprovado pois possui resposta que gera n\xe3o conformidade"}),1==F.papelID&&(0,r.jsx)(u.ZP,{container:!0,spacing:4,sx:{mt:4},children:(0,r.jsx)(u.ZP,{item:!0,xs:12,children:(0,r.jsx)(W.Z,{title:1==F.papelID?"Avalia\xe7\xe3o final da n\xe3o conformidade:":"Observa\xe7\xe3o",name:"status",value:E,register:I.register,setValue:I.setValue,setResult:z,papelID:F.papelID,hasNaoConformidade:b,options:[{value:80,color:"success",label:"Aceite",disabled:!f},{value:90,color:"error",label:"N\xe3o Aceite"}]})})}),"recebimentoMpNaoConformidade"==Z&&(0,r.jsx)($,{data:N,form:I,setValidParams:q})]}),m>=40&&(0,r.jsx)(v.Z,{variant:"body1",sx:{mt:2},children:"Concluir n\xe3o conformidades do formul\xe1rio? Ap\xf3s concluir, o mesmo n\xe3o poder\xe1 mais ser alterado!"})]})}),(0,r.jsx)(B.Z,{className:"dialog-actions-dense",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[p&&(0,r.jsx)(Q.Z,{variant:"outlined",color:"primary",onClick:i,children:"Fechar"}),h&&x&&(0,r.jsx)(L.z6,{document:(0,r.jsx)(ea,{}),children(e){let{blob:a,url:t,loading:s,error:l}=e;return(0,r.jsx)(Q.Z,{variant:"contained",disabled:!k||!M(null!==(o=null==C?void 0:C.setores)&&void 0!==o?o:[])||m<40&&(j&&j.status||1==F.papelID&&!E.status),color:"primary",onClick(){c(E,a)},children:"Concluir"})}})]})})]})})};var ea=o(92629),eo=o(91757),er=o(83830),et=o(7071),es=o(71798),el=o(72819),en=o(78432);let ei=e=>{var a,o,u,m,x,p;let h;let{id:j,recebimentoMpID:f,modelID:v}=e,b=R(),g=j&&j>0?"edit":"new",{menu:D,user:C,loggedUnity:y,hasPermission:P}=(0,t.useContext)(n.V),{setTitle:I}=(0,t.useContext)(i.f),[N,V]=(0,t.useState)(null),[k,S]=(0,t.useState)(null),[F,z]=(0,t.useState)(!1),[Q,_]=(0,t.useState)(!1),[T,K]=(0,t.useState)(!1),[B,J]=(0,t.useState)(!1),{setId:O,setModelID:W,setRecebimentoMpID:L}=(0,t.useContext)(er.X),H=(0,M.cI)({mode:"onChange"}),U=e=>{let a=!0;return e.forEach(e=>{e.novaQuantidade&&(0,G.JK)(e.novaQuantidade)>(0,G.JK)(e.quantidade)&&(a=!1)}),a},X=async e=>{let a=H.getValues("productsConclude");if(a&&j&&N.recebimento.id){if(!U(a)){A.ZP.error("Quantidade não pode ser maior que a quantidade do recebimento de MP!");return}e={form:{...e,products:a,prazo:H.getValues("header.prazoSolucao"),data:H.getValues("header.data"),data_:H.getValues("header.data")&&H.getValues("header.data").split("-").reverse().join("/"),hora:H.getValues("header.hora"),transporte:H.getValues("header.transporte"),produto:H.getValues("header.produto")},params:{id:j,recebimentoMpID:N.recebimento.id,usuarioID:C.usuarioID,papelID:C.papelID,unidadeID:y.unidadeID,profissionalID:C.profissionalID}},V(null);try{await Z.h.post("/formularios/recebimento-mp/nao-conformidade/conclude",e),A.ZP.success("Dados atualizados com sucesso!")}catch(o){console.log(o);return}finally{_(!1),z(!F)}console.log("\uD83D\uDE80 ~ conclude values:",e)}},Y=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:C.usuarioID,papelID:C.papelID,unidadeID:y.unidadeID}};console.log("\uD83D\uDE80 ~ reOpen:",a);try{await Z.h.post("/formularios/recebimento-mp/nao-conformidade/reOpen/".concat(j),a),A.ZP.success(es.OD.successUpdate)}catch(o){console.log(o)}finally{z(!F)}},$=async()=>{try{let e={id:null!=j?j:0,modelID:null!=v?v:0,recebimentoMpID:null!=f?f:0,unidadeID:y.unidadeID,papelID:C.papelID},a=await Z.h.post("/formularios/recebimento-mp/nao-conformidade/getData",e);204===a.status&&(O(null),b.push("/formularios/recebimento-mp/?aba=nao-conformidade")),console.log("\uD83D\uDE80 ~ getData: ",a.data),H.reset(a.data),V(a.data.header),S(a.data.blocos)}catch(o){console.log(o);return}},ei=e=>{e.preventDefault();let a=H.getValues();ed(a)},ed=async e=>{if(!e)return;if(!e.header.transporte&&!e.header.produto){A.ZP.error("Selecione o tipo de n\xe3o conformidade (Transporte ou Produto)!");return}let a=e.header.produtos.some(e=>e.checked_);if(e.header.produto&&!a){A.ZP.error("Selecione pelo menos um produto!");return}let o={form:e,auth:{usuarioID:C.usuarioID,profissionalID:C.profissionalID,papelID:C.papelID,unidadeID:y.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",o);try{if("new"===g){let r=await Z.h.post("/formularios/recebimento-mp/nao-conformidade/insertData",o);A.ZP.success("Dados cadastrados com sucesso!"),O(r.data.id),b.push("/formularios/recebimento-mp/?aba=nao-conformidade")}else"edit"===g&&(await Z.h.post("/formularios/recebimento-mp/nao-conformidade/updateData/".concat(j),o),A.ZP.success("Dados atualizados com sucesso!"))}catch(t){console.log(t);return}finally{z(!F)}},ec=()=>{O(N.modelo.id),b.push("/configuracoes/formularios/recebimentomp-naoconformidade/")},eu=()=>{let e=H.getValues("new");L(N.recebimento.id),W(e.modelo.id),b.push("/formularios/recebimento-mp/novo/?aba=nao-conformidade")},em=[],ex={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,r.jsx)(eo.Z,{}),disabled:!P(b.pathname,"editar"),route:null,type:null,action:Y,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};return 1==C.papelID&&N&&N.status.id>=40&&em.push(ex),1==C.papelID&&(h=!1,D.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(h=!0)})})}),h)&&em.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:ec,modal:!1,icon:"bi:gear",identification:null}),(0,t.useEffect)(()=>{I({title:"N\xe3o conformidade do Recebimento de MP",subtitle:{id:j,count:1,new:!1}}),$()},[F,C]),(0,r.jsx)("form",{onSubmit:e=>ei(e),children:N&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{btnNewModal:"edit"===g,handleNewModal:()=>K(!0),btnCancel:!0,btnSave:(null==N?void 0:null===(a=N.status)||void 0===a?void 0:a.id)<40,btnSend:(null==N?void 0:null===(o=N.status)||void 0===o?void 0:o.id)>=30&&(null==N?void 0:null===(u=N.status)||void 0===u?void 0:u.id)<40,btnPrint:"edit"==g,btnDelete:(null==N?void 0:null===(m=N.status)||void 0===m?void 0:m.id)<40&&"edit"===g,onclickDelete:()=>J(!0),actionsData:em,actions:!0,handleSubmit:()=>H.handleSubmit(ed),handleSend:()=>_(!0),iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"N\xe3o conformidade do Recebimento de MP",type:g,status:null==N?void 0:null===(x=N.status)||void 0===x?void 0:x.id}),(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)(et.Z,{size:"small",HeaderFiel:!0,skin:"light",color:N.status.color,label:N.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,r.jsx)(et.Z,{size:"small",HeaderFiel:!0,skin:"light",label:N.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(d.Z,{children:(0,r.jsx)(c.Z,{className:"space-y-2 ",children:(0,r.jsx)(E.Z,{data:N})})}),(0,r.jsx)(q,{form:H,data:N,disabled:(null===(p=N.status)||void 0===p?void 0:p.id)>=40}),(0,r.jsx)(w,{form:H,data:k,setBlock:S,status:N.status.id,disabled:N.status.id>=40}),(0,r.jsx)(l.Z,{id:j,parFormularioID:3},F)]}),(0,r.jsx)(ee,{openModal:Q,handleClose(){_(!1)},title:"Concluir N\xe3o Conformidade do Recebimento de MP",text:"Deseja realmente concluir este formul\xe1rio?",status:N.status.id,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:X,canApprove:!0,type:"recebimentoMpNaoConformidade",unity:y,values:null,formularioID:3,modeloID:N.modelo.id,produtos:N.produtos,form:H,setores:N.setoresConclusao}),(0,r.jsx)(ea.Z,{open:B,handleClose:()=>J(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(j),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,r.jsx)(el.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:eu,size:"lg",setOpenModal:K,openModal:T,children:(0,r.jsx)(en.Z,{type:"form",data:N,form:H})})]})})};var ed=ei}}]);