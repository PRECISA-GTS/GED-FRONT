"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3079],{78432:function(e,o,a){var r=a(85893),t=a(79072),s=a(18194),l=a(67294),n=a(60664),i=a(40039),d=a(84220);let c=e=>{let{type:o,data:a,form:c}=e,{loggedUnity:u}=(0,l.useContext)(i.V),[m,x]=(0,l.useState)(null),[p,h]=(0,l.useState)(null),j=async()=>{try{let e=await n.h.post("/formularios/recebimento-mp/nao-conformidade/getModels",{unidadeID:u.unidadeID});console.log("\uD83D\uDE80 ~ response:",e.data),x(e.data)}catch(o){console.log(o)}},b=async()=>{try{let e=await n.h.post("/formularios/recebimento-mp/nao-conformidade/getRecebimentoMPNC",{unidadeID:u.unidadeID});h(e.data)}catch(o){console.log(o)}};return(0,l.useEffect)(()=>{j(),b()},[a]),(0,r.jsxs)("div",{className:"flex flex-col gap-8",children:["form"===o&&(0,r.jsx)(s.Z,{data:a}),(0,r.jsxs)(t.ZP,{container:!0,spacing:4,children:["list"===o&&(0,r.jsx)(d.Z,{xs:12,md:6,title:"Recebimento de MP",name:"new.recebimento",options:null!=p?p:[],register:c.register,setValue:c.setValue,control:c.control,helpText:"Selecione o Recebimento de MP para lan\xe7ar uma nova n\xe3o conformidade"}),(0,r.jsx)(d.Z,{xs:12,md:"form"===o?12:6,title:"Modelo de formul\xe1rio",name:"new.modelo",options:null!=m?m:[],value:(null==a?void 0:a.modelo)||{nome:""},register:c.register,setValue:c.setValue,control:c.control,helpText:"Selecione um modelo de formul\xe1rio para o preenchimento desta n\xe3o conformidade para este Recebimento de MP"})]})]})};o.Z=c},18194:function(e,o,a){var r=a(85893),t=a(79072),s=a(17575),l=a(11163),n=a(67294),i=a(21609),d=a(7071),c=a(83830);let u=e=>{let{data:o}=e;if(!o)return;let a=(0,l.useRouter)(),{setId:u}=(0,n.useContext)(c.X),m=()=>{u(o.recebimento.id),a.push("/formularios/recebimento-mp/")};return(0,r.jsxs)(t.ZP,{container:!0,spacing:4,children:[(0,r.jsxs)(t.ZP,{item:!0,xs:12,md:4,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Fornecedor"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.Z,{icon:"mdi:truck-fast-outline"}),(0,r.jsx)("p",{children:o.recebimento.fornecedor})]})]}),(0,r.jsxs)(t.ZP,{item:!0,xs:12,md:3,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Data e hora do recebimento"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.Z,{icon:"tabler:calendar-check"}),(0,r.jsx)("p",{children:"".concat(o.recebimento.dataRecebimentoMp," ").concat(o.recebimento.horaRecebimentoMp)})]})]}),(0,r.jsxs)(t.ZP,{item:!0,xs:12,md:3,children:[(0,r.jsx)("label",{className:"opacity-60",children:"NF"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ",children:[(0,r.jsx)(i.Z,{icon:"ion:document-text-outline"}),(0,r.jsx)("p",{children:o.recebimento.nfRecebimentoMp})]})]}),(0,r.jsxs)(t.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Recebimento"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.Z,{skin:"light",label:o.recebimento.status.label,color:o.recebimento.status.color,sx:{height:28,fontSize:"0.75rem"}}),(0,r.jsx)(s.Z,{title:"Acessar Recebimento de MP",placement:"top",children:(0,r.jsx)("div",{className:"cursor-pointer",children:(0,r.jsx)(i.Z,{icon:"ci:external-link",onClick:m})})})]})]})]})};o.Z=u},23079:function(e,o,a){a.d(o,{Z:function(){return ei}});var r=a(85893),t=a(67294),s=a(86887),l=a(934),n=a(40039),i=a(60565),d=a(49837),c=a(91359),u=a(79072),m=a(41470),x=a(3893),p=a(22841),h=a(8519);let j=e=>{let{value:o,label:a,disabled:t=!1,errors:s=!1}=e;return(0,r.jsx)(p.Z,{value:o,control:(0,r.jsx)(h.Z,{disabled:t,error:!!s}),label:a,fullWidth:!0,sx:{"& .MuiFormControlLabel-label":{color:"text.secondary"},"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})},b=e=>{let{form:o,data:a,disabled:t}=e;if(!a)return;let s=e=>{o.setValue("header.quemPreenche",e.target.value)};return(0,r.jsxs)(m.Z,{row:!0,name:"header.quemPreenche",defaultValue:a.quemPreenche,onChange:s,children:[(0,r.jsx)("p",{children:"Quem ir\xe1 preencher a n\xe3o conformidade?"}),(0,r.jsxs)(u.ZP,{container:!0,spacing:4,children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(j,{value:"1",label:"F\xe1brica",disabled:t})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(j,{value:"2",label:"Fornecedor",disabled:t})}),2==o.watch("header.quemPreenche")&&(0,r.jsx)(u.ZP,{item:!0,xs:12,md:8,children:(0,r.jsx)(x.Z,{title:"Fornecedor acessa o Recebimento?",name:"header.fornecedorAcessaRecebimento",value:a.fornecedorAcessaRecebimento,register:o.register,disabled:t,helpText:"Se marcado, fornecesor poder\xe1 visualizar o formul\xe1rio de recebimento vinculado a esta n\xe3o conformidade."})})]})]})};var f=a(29630),v=a(44373),g=a(75158),Z=a(60664);let D=e=>{let{value:o}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Qtd."}),(0,r.jsx)("p",{children:o.quantidade})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Qtd. Entrada"}),(0,r.jsx)("p",{children:o.quantidadeEntrada})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Data Fabrica\xe7\xe3o"}),(0,r.jsx)("p",{children:o.dataFabricacao})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"N\xba Lote"}),(0,r.jsx)("p",{children:o.lote})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Apresenta\xe7\xe3o"}),(0,r.jsx)("p",{children:o.apresentacao.nome})]}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:2,children:[(0,r.jsx)("label",{className:"opacity-60",children:"Data de validade"}),(0,r.jsx)("p",{children:o.dataValidade})]})]})},C=e=>{let{index:o,produto:a,handleCheck:s,setValue:l,register:n,control:i,errors:d,disabled:c}=e,[m,x]=(0,t.useState)([]),h=async()=>{try{let e=await Z.h.get("/cadastros/apresentacao");x(e.data)}catch(o){console.log("\uD83D\uDE80 ~ error:",o)}};return(0,t.useEffect)(()=>{h()},[]),(0,r.jsxs)(u.ZP,{container:!0,sx:{pb:2},children:[(0,r.jsx)("input",{type:"hidden",value:a.produtoID,name:"header.produtos[".concat(o,"].produtoID"),...n("header.produtos[".concat(o,"].produtoID"))}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,r.jsx)(p.Z,{control:(0,r.jsx)(g.Z,{onClick:e=>s(e,o),checked:!!a.checked_,disabled:c}),label:a.nome,size:"small",sx:{marginRight:"4px","&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})}),a.checked_&&(0,r.jsx)(D,{value:a})]})},y=e=>{let{form:o,data:a,disabled:s}=e;if(!a)return;let[l,n]=(0,t.useState)(a.produtos),i=(e,a)=>{let{checked:r}=e.target;o.setValue("header.produtos[".concat(a,"].checked_"),r);let t=l.map((e,o)=>o===a?{...e,checked_:r}:e);n(t)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(x.Z,{title:"Transporte",name:"header.transporte",value:a.transporte,register:o.register,disabled:s})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:2,children:(0,r.jsx)(x.Z,{title:"Produto",name:"header.produto",value:a.produto,register:o.register,disabled:s})}),o.watch("header.produto")&&(0,r.jsxs)(u.ZP,{container:!0,sx:{mt:4},children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,children:(0,r.jsx)(f.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},children:"Selecione os produtos com N\xe3o Conformidade"})}),(0,r.jsx)(u.ZP,{item:!0,xs:12,children:l&&l.map((e,a)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C,{index:a,produto:e,setProdutos:n,handleCheck:i,disabled:s,getValues:o.getValues,setValue:o.setValue,register:o.register,control:o.control,errors:o.errors},a),a<l.length-1&&(0,r.jsx)(v.Z,{})]}))})]})]})};var P=a(29308),I=a(50287),N=a(84220);let k=e=>{let{form:o,fields:a,disabled:t,getAddressByCep:s}=e,l=e=>{switch(e){case"telefone":case"telefone1":case"telefone2":return"telefone";case"cep":return"cep";case"cnpj":return"cnpj";default:return null}},n=e=>!!t&&t.length>0&&t.includes(e);return a&&a.map((e,a)=>{var i,d,c,u,m,x,p,h,j,b,f,v,g,Z,D;return(0,r.jsxs)(r.Fragment,{children:[e&&"int"===e.tipo&&e.tabela&&(0,r.jsx)(N.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(a,"].").concat(e.tabela),type:e.tabela,options:e.options,value:null==e?void 0:e[e.tabela],mask:e.tabela,disabled:t||n(e.nomeColuna),alertRequired:1===e.obrigatorio,register:o.register,setValue:o.setValue,control:o.control,errors:null===(i=o.errors)||void 0===i?void 0:null===(d=i.fields)||void 0===d?void 0:null===(c=d[a])||void 0===c?void 0:c[e.tabela]},"select-".concat(a)),e&&"date"==e.tipo&&(0,r.jsx)(I.Z,{xs:12,md:4,title:"Data da avalia\xe7\xe3o",disabled:t||n(e.nomeColuna),value:null!==(g=null==e?void 0:e[e.nomeColuna])&&void 0!==g?g:new Date,type:e.nomeColuna,name:"header.fields[".concat(a,"].").concat(e.nomeColuna),typeValidation:"dataPassado",daysValidation:365,alertRequired:1===e.obrigatorio,errors:null===(u=o.errors)||void 0===u?void 0:null===(m=u.fields)||void 0===m?void 0:null===(x=m[a])||void 0===x?void 0:x[e.nomeColuna],control:o.control,register:o.register},"datefield-".concat(a)),e&&"string"==e.tipo&&(0,r.jsx)(P.Z,{xs:12,md:4,title:e.nomeCampo,name:"header.fields[".concat(a,"].").concat(e.nomeColuna),value:null!==(Z=null==e?void 0:e[e.nomeColuna])&&void 0!==Z?Z:"",type:e.nomeColuna,getAddressByCep:s,mask:l(e.nomeColuna),disabled:!!(t||n(e.nomeColuna))||"cnpj"==e.nomeColuna,alertRequired:1===e.obrigatorio,errors:null===(p=o.errors)||void 0===p?void 0:null===(h=p.fields)||void 0===h?void 0:null===(j=h[a])||void 0===j?void 0:j.nomeColuna,register:o.register,control:o.control},"input-".concat(a)),e&&"text"==e.tipo&&(0,r.jsx)(P.Z,{xs:12,md:12,multiline:!0,rows:6,title:e.nomeCampo,name:"header.fields[".concat(a,"].").concat(e.nomeColuna),value:null!==(D=null==e?void 0:e[e.nomeColuna])&&void 0!==D?D:"",type:e.nomeColuna,getAddressByCep:s,mask:l(e.nomeColuna),disabled:!!(t||n(e.nomeColuna))||"cnpj"==e.nomeColuna,alertRequired:1===e.obrigatorio,register:o.register,control:o.control,errors:null===(b=o.errors)||void 0===b?void 0:null===(f=b.fields)||void 0===f?void 0:null===(v=f[a])||void 0===v?void 0:v.nomeColuna},"input-".concat(a))]})})};var M=a(22991);let F=e=>{var o,a,t,s,l;let{form:n,data:i,disabled:m}=e;if(i)return console.log("\uD83D\uDE80 ~ data:",i),(0,r.jsx)(d.Z,{children:(0,r.jsx)(c.Z,{children:(0,r.jsxs)(u.ZP,{container:!0,spacing:6,className:"items-center",children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,sx:{textAlign:"right"},children:(0,r.jsx)(M.Z,{data:null!==(l=null==i?void 0:i.setoresPreenchimento)&&void 0!==l?l:[]})}),(0,r.jsx)(I.Z,{xs:12,md:3,title:"Data",type:"date",required:!0,name:"header.data",register:n.register,control:n.control,value:i.data,disabled:m,typeValidation:"dataPassado",daysValidation:999999,errors:null===(o=n.errors)||void 0===o?void 0:null===(a=o.header)||void 0===a?void 0:a.data}),(0,r.jsx)(P.Z,{xs:12,md:3,title:"Hora",name:"header.hora",type:"time",disabled:m,register:n.register,control:n.control,errors:null===(t=n.errors)||void 0===t?void 0:null===(s=t.header)||void 0===s?void 0:s.hora}),(0,r.jsx)(P.Z,{xs:12,md:6,title:"Prazo para a solu\xe7\xe3o (em dias)",name:"header.prazoSolucao",disabled:m,required:!0,type:"number",control:n.control,helpText:"Informe o prazo pra solu\xe7\xe3o da n\xe3o conformidade. Ser\xe1 gerado um alerta no vencimento do prazo."}),(0,r.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,r.jsx)(b,{form:n,data:i,disabled:m})}),(0,r.jsxs)(u.ZP,{item:!0,xs:12,md:12,children:[(0,r.jsx)("p",{children:"N\xe3o Conformidade do Recebimento:"}),(0,r.jsx)(u.ZP,{container:!0,item:!0,xs:12,md:12,children:(0,r.jsx)(y,{form:n,data:i,disabled:m})})]}),(0,r.jsx)(k,{form:n,fields:i.fields,disabled:m})]})})})};var V=a(99734);let S=e=>{let{form:o,data:a,setBlock:t,status:s,disabled:l}=e;return console.log("\uD83D\uDE80 ~ Block:",a),(0,r.jsx)(r.Fragment,{children:a&&a.map((e,n)=>{var i;return(0,r.jsx)(V.Z,{index:n,bloco:e,blockKey:"parRecebimentoMpNaoConformidadeModeloBlocoID",setBlocos:t,status:s,blocos:a,disabled:l,setValue:o.setValue,getValues:o.getValues,register:o.register,control:o.control,errors:null===(i=o.errors)||void 0===i?void 0:i.blocos})})})};var q=a(87536),R=a(18194),w=a(11163),E=a.n(w),z=a(86501),A=a(54225),_=a(1890),T=a(77745),Q=a(95398),B=a(76779),O=a(44642),W=a(19604),L=a(48432),H=a(99070),K=a(82555),X=a(74811),U=a(55334),G=a(62813),J=a(21609);let Y=e=>{let{data:o,form:a}=e,[s,l]=(0,t.useState)(null),n=()=>{if(!o)return;let e=o.sort((e,o)=>e.checked_&&!o.checked_?-1:!e.checked_&&o.checked_?1:0);l(e)};return(0,t.useEffect)(()=>{n()},[o]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.Z,{variant:"body1",color:"primary",sx:{fontWeight:600,mt:6},className:"flex items-center gap-1",children:[(0,r.jsx)(J.Z,{icon:"ph:plant",className:"text-primary"}),"Confer\xeancia dos produtos do Recebimento de MP"]}),s&&s.length>0&&s.map((e,o)=>{var t,l,n;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.ZP,{container:!0,spacing:2,sx:{mt:4},className:"items-center",children:[(0,r.jsx)(u.ZP,{item:!0,md:12,children:(0,r.jsx)(f.Z,{variant:"body2",sx:{fontWeight:600},children:e.nome})}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Quantidade do recebimento"}),(0,r.jsx)("p",{children:e.quantidade})]}),e.checked_?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"hidden",name:"productsConclude.".concat(o,".recebimentoMpProdutoID"),value:e.recebimentoMpProdutoID,...a.register("productsConclude.".concat(o,".recebimentoMpProdutoID"))}),(0,r.jsx)("input",{type:"hidden",name:"productsConclude.".concat(o,".quantidade"),value:e.quantidade,...a.register("productsConclude.".concat(o,".quantidade"))}),(0,r.jsx)(P.Z,{md:2,title:"Nova quantidade",name:"productsConclude.".concat(o,".novaQuantidade"),defaultValue:e.quantidadeEntrada,helpText:"Quantidade recebida",required:!0,register:a.register,control:a.control,errors:null===(t=a.errors)||void 0===t?void 0:null===(l=t.productsConclude)||void 0===l?void 0:null===(n=l[o])||void 0===n?void 0:n.novaQuantidade,mask:"fractioned3"})]}):(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Nova quantidade"}),(0,r.jsx)("p",{children:e.quantidade})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Data Fabrica\xe7\xe3o"}),(0,r.jsx)("p",{children:e.dataFabricacao})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Lote"}),(0,r.jsx)("p",{children:e.lote})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Apresenta\xe7\xe3o"}),(0,r.jsx)("p",{children:e.apresentacao.nome})]}),(0,r.jsxs)(u.ZP,{item:!0,md:2,children:[(0,r.jsx)("p",{className:"text-xs opacity-50",children:"Data Validade"}),(0,r.jsx)("p",{children:e.dataValidade})]})]}),o<s.length-1&&(0,r.jsx)(v.Z,{sx:{pb:2}})]})})]})},$=e=>{var o,a;let{title:s,text:l,handleClose:i,openModal:d,conclusionForm:c,status:m,canChange:x,btnCancel:p,btnConfirm:h,listErrors:j,canApprove:b,hasNaoConformidade:v,handleSend:g,type:Z,unity:D,values:C,formularioID:y,modeloID:P,form:I,produtos:N,setores:k}=e;if(!P)return null;console.log("\uD83D\uDE80 ~ modeloID:",C);let{user:F,loggedUnity:V,hasSectorPermission:S}=(0,t.useContext)(n.V),[q,R]=(0,t.useState)({}),{data:w}=(0,K.O)(),z=E(),J=z.pathname.split("/")[2],$=()=>(0,r.jsx)(H.BB,{children:(0,r.jsx)(H.T3,{size:"A4",style:{paddingHorizontal:25},children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.Z,{data:w}),"fornecedor"===J&&(0,r.jsx)(U.default,{values:w},w),(0,r.jsx)(G.Z,{})]})})});return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(_.Z,{fullWidth:!0,maxWidth:"lg",open:d,"aria-labelledby":"form-dialog-title",disableEscapeKeyDown:!0,onClose(e,o){"backdropClick"!==o&&i()},children:[(0,r.jsx)(T.Z,{id:"form-dialog-title",children:(0,r.jsxs)(u.ZP,{container:!0,spacing:6,children:[(0,r.jsx)(u.ZP,{item:!0,xs:12,md:6,children:s}),1===F.papelID&&(0,r.jsx)(u.ZP,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:(0,r.jsx)(M.Z,{data:null!=k?k:[]})})]})}),(0,r.jsx)(Q.Z,{children:(0,r.jsxs)(O.Z,{sx:{mb:3},children:[!S(null!==(o=null==C?void 0:C.setores)&&void 0!==o?o:[])&&(0,r.jsx)(W.Z,{severity:"warning",sx:{mb:4},children:(0,r.jsx)(f.Z,{variant:"body2",children:"Seu setor n\xe3o est\xe1 habilitado para concluir este formul\xe1rio!"})}),m<=40&&(0,r.jsxs)(r.Fragment,{children:[j&&j.status&&(0,r.jsxs)(W.Z,{variant:"outlined",severity:"error",sx:{mt:2},children:["Por favor, verifique os campos abaixo:",(0,r.jsx)(f.Z,{variant:"subtitle1",color:"error",sx:{mt:2},children:j.errors.map((e,o)=>(0,r.jsxs)(f.Z,{variant:"body2",color:"error",children:["- ",e]},o))})]}),j&&2==F.papelID&&!j.status&&(0,r.jsx)(W.Z,{severity:"info",sx:{mt:2},children:2==D.quemPreenche&&"fornecedor"==Z?"Ap\xf3s concluir o formul\xe1rio, o mesmo ser\xe1 enviado para an\xe1lise e conclus\xe3o da empresa ".concat(null==D?void 0:D.nomeFantasia,"!"):"Ap\xf3s concluir o formul\xe1rio, o mesmo n\xe3o poder\xe1 mais ser alterado!"}),!b&&(0,r.jsx)(W.Z,{severity:"error",sx:{mt:2},children:"Este formul\xe1rio n\xe3o pode ser aprovado pois possui resposta que gera n\xe3o conformidade"}),1==F.papelID&&(0,r.jsx)(u.ZP,{container:!0,spacing:4,sx:{mt:4},children:(0,r.jsx)(u.ZP,{item:!0,xs:12,children:(0,r.jsx)(L.Z,{title:1==F.papelID?"Avalia\xe7\xe3o final da n\xe3o conformidade:":"Observa\xe7\xe3o",name:"status",value:q,register:I.register,setValue:I.setValue,setResult:R,papelID:F.papelID,hasNaoConformidade:v,options:[{value:80,color:"success",label:"Aceite",disabled:!b},{value:90,color:"error",label:"N\xe3o Aceite"}]})})}),"recebimentoMpNaoConformidade"==Z&&(0,r.jsx)(Y,{data:N,form:I})]}),m>=40&&(0,r.jsx)(f.Z,{variant:"body1",sx:{mt:2},children:"Concluir n\xe3o conformidades do formul\xe1rio? Ap\xf3s concluir, o mesmo n\xe3o poder\xe1 mais ser alterado!"})]})}),(0,r.jsx)(B.Z,{className:"dialog-actions-dense",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[p&&(0,r.jsx)(A.Z,{variant:"outlined",color:"primary",onClick:i,children:"Fechar"}),h&&x&&(0,r.jsx)(H.z6,{document:(0,r.jsx)($,{}),children(e){let{blob:o,url:t,loading:s,error:l}=e;return(0,r.jsx)(A.Z,{variant:"contained",disabled:!S(null!==(a=null==C?void 0:C.setores)&&void 0!==a?a:[])||m<40&&(j&&j.status||1==F.papelID&&!q.status),color:"primary",onClick(){c(q,o)},children:"Concluir"})}})]})})]})})};var ee=a(92629),eo=a(91757),ea=a(83830),er=a(7071),et=a(64165),es=a(72819),el=a(78432);let en=e=>{var o,a,u,m,x,p;let h;let{id:j,recebimentoMpID:b,modelID:f}=e;console.log("\uD83D\uDE80 ~ RecebimentoMpNaoConformidade id, recebimentoMpID, model:",j,b,f);let v=E(),g=j&&j>0?"edit":"new",{menu:D,user:C,loggedUnity:y,hasPermission:P}=(0,t.useContext)(n.V),{setTitle:I}=(0,t.useContext)(i.f),[N,k]=(0,t.useState)(null),[M,V]=(0,t.useState)(null),[w,A]=(0,t.useState)(!1),[_,T]=(0,t.useState)(!1),[Q,B]=(0,t.useState)(!1),[O,W]=(0,t.useState)(!1),{setId:L,setModelID:H,setRecebimentoMpID:K}=(0,t.useContext)(ea.X),X=(0,q.cI)({mode:"onChange"}),U=()=>{T(!0)},G=e=>{if(!e)return;let o=e.replace(".","").replace(",","."),a=parseFloat(o);return a},J=e=>{let o=!0;return e.forEach(e=>{e.novaQuantidade&&G(e.novaQuantidade)>G(e.quantidade)&&(o=!1)}),o},Y=async e=>{let o=X.getValues("productsConclude");if(o&&j&&N.recebimento.id){if(!J(o)){z.ZP.error("Quantidade não pode ser maior que a quantidade do recebimento de MP!");return}e={form:{...e,products:o},params:{id:j,recebimentoMpID:N.recebimento.id,usuarioID:C.usuarioID,papelID:C.papelID,unidadeID:y.unidadeID,profissionalID:C.profissionalID}};try{await Z.h.post("/formularios/recebimento-mp/nao-conformidade/conclude",e),z.ZP.success("Dados atualizados com sucesso!")}catch(a){console.log(a);return}finally{T(!1),A(!w)}console.log("\uD83D\uDE80 ~ conclude values:",e)}},en=async e=>{let o={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:C.usuarioID,papelID:C.papelID,unidadeID:y.unidadeID}};console.log("\uD83D\uDE80 ~ reOpen:",o);try{await Z.h.post("/formularios/recebimento-mp/nao-conformidade/reOpen/".concat(j),o),z.ZP.success(et.OD.successUpdate)}catch(a){console.log(a)}finally{A(!w)}},ei=async()=>{try{let e={id:null!=j?j:0,modelID:null!=f?f:0,recebimentoMpID:null!=b?b:0,unidadeID:y.unidadeID,papelID:C.papelID},o=await Z.h.post("/formularios/recebimento-mp/nao-conformidade/getData",e);204===o.status&&(L(null),v.push("/formularios/recebimento-mp/?aba=nao-conformidade")),console.log("\uD83D\uDE80 ~ getData: ",o.data),X.reset(o.data),k(o.data.header),V(o.data.blocos)}catch(a){console.log(a);return}},ed=e=>{e.preventDefault();let o=X.getValues();ec(o)},ec=async e=>{if(!e)return;if(!e.header.transporte&&!e.header.produto){z.ZP.error("Selecione o tipo de n\xe3o conformidade (Transporte ou Produto)!");return}let o=e.header.produtos.some(e=>e.checked_);if(e.header.produto&&!o){z.ZP.error("Selecione pelo menos um produto!");return}let a={form:e,auth:{usuarioID:C.usuarioID,profissionalID:C.profissionalID,papelID:C.papelID,unidadeID:y.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit:",a);try{if("new"===g){let r=await Z.h.post("/formularios/recebimento-mp/nao-conformidade/insertData",a);z.ZP.success("Dados cadastrados com sucesso!"),L(r.data.id),v.push("/formularios/recebimento-mp/?aba=nao-conformidade")}else"edit"===g&&(await Z.h.post("/formularios/recebimento-mp/nao-conformidade/updateData/".concat(j),a),z.ZP.success("Dados atualizados com sucesso!"))}catch(t){console.log(t);return}finally{A(!w)}},eu=()=>{L(N.modelo.id),v.push("/configuracoes/formularios/recebimentomp-naoconformidade/")},em=()=>{let e=X.getValues("new");K(N.recebimento.id),H(e.modelo.id),v.push("/formularios/recebimento-mp/novo/?aba=nao-conformidade")},ex=[],ep={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,r.jsx)(eo.Z,{}),disabled:!P(v.pathname,"editar"),route:null,type:null,action:en,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null};return 1==C.papelID&&N&&N.status.id>=40&&ex.push(ep),1==C.papelID&&(h=!1,D.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(h=!0)})})}),h)&&ex.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:eu,modal:!1,icon:"bi:gear",identification:null}),(0,t.useEffect)(()=>{I({title:"N\xe3o conformidade do Recebimento de MP",subtitle:{id:j,count:1,new:!1}}),ei()},[w,C]),(0,r.jsx)("form",{onSubmit:e=>ed(e),children:N&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{btnNewModal:"edit"===g,handleNewModal:()=>B(!0),btnCancel:!0,btnSave:(null==N?void 0:null===(o=N.status)||void 0===o?void 0:o.id)<40,btnSend:(null==N?void 0:null===(a=N.status)||void 0===a?void 0:a.id)>=30&&(null==N?void 0:null===(u=N.status)||void 0===u?void 0:u.id)<40,btnPrint:"edit"==g,btnDelete:(null==N?void 0:null===(m=N.status)||void 0===m?void 0:m.id)<40&&"edit"===g,onclickDelete:()=>W(!0),actionsData:ex,actions:!0,handleSubmit:()=>X.handleSubmit(ec),handleSend:U,iconConclusion:"mdi:check-bold",titleConclusion:"Concluir",title:"N\xe3o conformidade do Recebimento de MP",type:g,status:null==N?void 0:null===(x=N.status)||void 0===x?void 0:x.id}),(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)(er.Z,{size:"small",HeaderFiel:!0,skin:"light",color:N.status.color,label:N.status.label,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}}),(0,r.jsx)(er.Z,{size:"small",HeaderFiel:!0,skin:"light",label:N.modelo.nome,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(d.Z,{children:(0,r.jsx)(c.Z,{className:"space-y-2 ",children:(0,r.jsx)(R.Z,{data:N})})}),(0,r.jsx)(F,{form:X,data:N,disabled:(null===(p=N.status)||void 0===p?void 0:p.id)>=40}),(0,r.jsx)(S,{form:X,data:M,setBlock:V,status:N.status.id,disabled:N.status.id>=40}),(0,r.jsx)(l.Z,{id:j,parFormularioID:3},w)]}),(0,r.jsx)($,{openModal:_,handleClose(){T(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",status:N.status.id,canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:Y,canApprove:!0,type:"recebimentoMpNaoConformidade",unity:y,values:null,formularioID:3,modeloID:N.modelo.id,produtos:N.produtos,form:X,setores:N.setoresConclusao}),(0,r.jsx)(ee.Z,{open:O,handleClose:()=>W(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(j),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}}),(0,r.jsx)(es.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:em,size:"lg",setOpenModal:B,openModal:Q,children:(0,r.jsx)(el.Z,{type:"form",data:N,form:X})})]})})};var ei=en}}]);