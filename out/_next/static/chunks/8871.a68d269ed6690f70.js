"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8871],{82755:function(e,a,o){var i=o(85893),l=o(11163),t=o.n(l),s=o(54225),n=o(1890),r=o(77745),d=o(95398),u=o(76779),c=o(44642),m=o(40039),p=o(79072),x=o(19604),h=o(29630),f=o(67294),v=o(48432),D=o(82555),g=o(83542),b=o(50287),j=o(29308);let I=e=>{var a,o,l,I,Z;let{form:y,title:C,text:z,handleClose:w,openModal:S,conclusionForm:F,info:P,canChange:E,btnCancel:k,btnConfirm:N,register:V,setValue:q,listErrors:A,canApprove:M,hasNaoConformidade:H,control:R,handleSend:O,type:_,unity:T,values:B,errors:L,formularioID:U,modeloID:W}=e;if(!W)return null;let{user:K,hasSectorPermission:X}=(0,f.useContext)(m.V),[G,J]=(0,f.useState)({}),{data:Q}=(0,D.O)(),Y=t();return Y.pathname.split("/")[2],(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(n.Z,{fullWidth:!0,maxWidth:"md",open:S,"aria-labelledby":"form-dialog-title",disableEscapeKeyDown:!0,onClose(e,a){"backdropClick"!==a&&w()},children:[(0,i.jsx)(r.Z,{id:"form-dialog-title",children:(0,i.jsxs)(p.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(p.ZP,{item:!0,xs:12,md:6,children:C}),1===K.papelID&&(0,i.jsx)(p.ZP,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:(0,i.jsx)(g.Z,{data:null!==(a=null==B?void 0:B.departamentos)&&void 0!==a?a:[]})})]})}),(0,i.jsx)(d.Z,{children:(0,i.jsxs)(c.Z,{sx:{mb:3},children:[!X(null!==(o=null==B?void 0:B.departamentos)&&void 0!==o?o:[])&&(0,i.jsx)(x.Z,{severity:"warning",sx:{mb:4},children:(0,i.jsx)(h.Z,{variant:"body2",children:"Seu departamento n\xe3o est\xe1 habilitado para concluir este formul\xe1rio!"})}),P.status<=40&&(0,i.jsxs)(i.Fragment,{children:[z,A&&A.status&&(0,i.jsxs)(x.Z,{variant:"outlined",severity:"error",sx:{mt:2},children:["Por favor, verifique os campos abaixo:",(0,i.jsx)(h.Z,{variant:"subtitle1",color:"error",sx:{mt:2},children:A.errors.map((e,a)=>(0,i.jsxs)(h.Z,{variant:"body2",color:"error",children:["- ",e]},a))})]}),A&&2==K.papelID&&!A.status&&(0,i.jsx)(x.Z,{severity:"info",sx:{mt:2},children:2==T.quemPreenche&&"fornecedor"==_?"Ap\xf3s concluir o formul\xe1rio, o mesmo ser\xe1 enviado para an\xe1lise e conclus\xe3o da empresa ".concat(null==T?void 0:T.nomeFantasia,"!"):"Ap\xf3s concluir o formul\xe1rio, o mesmo n\xe3o poder\xe1 mais ser alterado!"}),!M&&(0,i.jsx)(x.Z,{severity:"warning",sx:{mt:2},children:"Este formul\xe1rio n\xe3o pode ser aprovado pois possui resposta que gera n\xe3o conformidade!"}),1==K.papelID&&(0,i.jsxs)(p.ZP,{container:!0,spacing:4,sx:{mt:4},children:[(0,i.jsx)(b.Z,{xs:12,md:3,title:"Data da conclus\xe3o",name:"fieldsFooter.dataConclusao",type:"date",value:null!==(l=null==B?void 0:B.dataConclusao)&&void 0!==l?l:new Date,typeValidation:"dataPassado",daysValidation:365,required:!0,form:y}),(0,i.jsx)(j.Z,{xs:12,md:3,title:"Hora da conclus\xe3o",name:"fieldsFooter.horaConclusao",type:"time",value:null!==(I=null==B?void 0:B.horaConclusao)&&void 0!==I?I:(()=>{let e=new Date,a=e.getHours(),o=e.getMinutes();return"".concat(a,":").concat(o)})(),required:!0,form:y}),(0,i.jsx)(p.ZP,{item:!0,xs:12,children:(0,i.jsx)(v.Z,{title:1==K.papelID?"Resultado do Processo":"Observa\xe7\xe3o",name:"status",value:G,form:y,setResult:J,papelID:K.papelID,hasNaoConformidade:H,options:[{value:70,color:"success",label:"Aprovado",disabled:!M},{value:60,color:"warning",label:"Aprovado Parcial"},{value:50,color:"error",label:"Reprovado"}]})})]})]}),P.status>=40&&P.naoConformidade&&(0,i.jsx)(h.Z,{variant:"body1",sx:{mt:2},children:"Concluir n\xe3o conformidades do formul\xe1rio? Ap\xf3s concluir, o mesmo n\xe3o poder\xe1 mais ser alterado!"})]})}),(0,i.jsx)(u.Z,{className:"dialog-actions-dense",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[k&&(0,i.jsx)(s.Z,{variant:"outlined",color:"primary",onClick:w,children:"Fechar"}),N&&E&&(0,i.jsx)(s.Z,{variant:"contained",disabled:!X(null!==(Z=null==B?void 0:B.departamentos)&&void 0!==Z?Z:[])||P.status<40&&(A&&A.status||1==K.papelID&&!G.status),color:"primary",onClick(){F(G)},children:"Concluir"})]})})]})})};a.Z=I},28871:function(e,a,o){var i=o(85893),l=o(67294),t=o(83830),s=o(87536),n=o(60664),r=o(40039),d=o(65698),u=o(32038),c=o(86501),m=o(11163),p=o(46099),x=o(82755),h=o(92629),f=o(91757),v=o(71798),D=o(3404),g=o(51239),b=o(72819);let j=()=>{var e,a,o,j,I;let Z=(0,m.useRouter)(),{id:y,setId:C,idNc:z,setModelID:w,setLimpezaID:S}=(0,l.useContext)(t.X),{user:F,loggedUnity:P,hasPermission:E}=(0,l.useContext)(r.V),[k,N]=(0,l.useState)(null),[V,q]=(0,l.useState)(null),A=y&&y>0?"edit":"new",M=(0,s.cI)({mode:"onChange"}),[H,R]=(0,l.useState)(!1),[O,_]=(0,l.useState)(!0),[T,B]=(0,l.useState)(!1),[L,U]=(0,l.useState)(!1),[W,K]=(0,l.useState)({status:!1,errors:[]}),[X,G]=(0,l.useState)(!1),J=(0,D.n)("limpeza",Z),Q=async()=>{try{let e={id:null!=y?y:0,unidadeID:P.unidadeID},a=await n.hi.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData:",a.data),M.reset(a.data),N(a.data.header)}catch(o){console.log(o);return}},Y=e=>{e.preventDefault();let a=M.getValues();$(a)},$=async e=>{e&&("limpeza"===e.type?await ee(e):"nao-conformidade"==e.type&&console.log("envia formul\xe1rio da nao conformidade..."))},ee=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:F.usuarioID,papelID:F.papelID,unidadeID:P.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit limpeza:",a);try{if("new"===A){let o=await n.hi.post("/formularios/limpeza/insertData",a);c.ZP.success("Dados cadastrados com sucesso!"),C(o.data.id),Z.push("/formularios/limpeza")}else"edit"===A&&(await n.hi.post("/formularios/limpeza/updateData/".concat(y),a),c.ZP.success("Dados atualizados com sucesso!"))}catch(i){console.log(i);return}finally{R(!H)}},ea=()=>{let e={status:!1,errors:[]};M.clearErrors(),(0,p.n9)(M,"header.dataInicio","Data Inicial",e),(0,p.n9)(M,"header.horaInicio","Hora Inicial",e),(0,p.n9)(M,"header.dataFim","Data Final",e),(0,p.n9)(M,"header.horaFim","Hora Final",e),(0,p.n9)(M,"header.departamento.id","Departamento respons\xe1vel pela limpeza",e),(0,p.n9)(M,"header.setor.id","Setor que foi limpo",e),(0,p.lz)(M,M.getValues("header.fields"),e),(0,p.IB)(M,M.getValues("blocos"),e);let a=(0,p.FU)(e);(W.status!==a.status||W.errors.length!==a.errors.length)&&K(a)},eo=async e=>{let a=M.getValues("info.naoConformidade"),o=M.getValues("fieldsFooter");if(y){e={form:{...o,...e,naoConformidade:a},params:{id:y,usuarioID:F.usuarioID,papelID:F.papelID,unidadeID:P.unidadeID,profissionalID:F.profissionalID}},N(null);try{await n.hi.post("".concat(Z.pathname,"/conclude"),e),await $(M.getValues())}catch(i){console.log(i);return}finally{B(!1),R(!H),a&&G(!0)}}},ei=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:F.usuarioID,papelID:F.papelID,unidadeID:P.unidadeID}};try{await n.hi.post("".concat(Z.pathname,"/reOpen/").concat(y),a),c.ZP.success(v.OD.successUpdate)}catch(o){console.log(o)}finally{R(!H)}},el=e=>{let a=e[0].equipamentos,o=!0;0==a.length&&(o=!1),a.forEach(e=>{e.itens.forEach(e=>{e.resposta&&1==e.resposta.bloqueiaFormulario&&(o=!1)})}),_(o)},et=e=>{console.log("\uD83D\uDE80 ~ handleNewNC: ",k.limpeza.id,e.new.modelo.id),C(k.limpeza.id),S(k.limpeza.id),w(e.new.modelo.id),Z.push("/formularios/limpeza/novo/?aba=nao-conformidade")},es=[],en={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,i.jsx)(f.Z,{}),disabled:!E(Z.pathname,"editar"),route:null,type:null,action:ei,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null,ncPending:!0};return k&&k.status.id>=40&&es.push(en),(0,l.useEffect)(()=>{Q(),setTimeout(()=>{M.trigger()},300)},[y,P,H]),console.log("==> ",T),(0,i.jsxs)("form",{onSubmit:e=>Y(e),children:[(0,i.jsx)(d.Z,{id:y,btnNew:"edit"===A&&"limpeza"==J,btnNewModal:1===F.papelID&&"edit"===A&&"limpeza"!=J,handleNewModal:()=>G(!0),btnCancel:!0,btnSave:(null==k?void 0:null===(e=k.status)||void 0===e?void 0:e.id)<40,btnSend:(null==k?void 0:null===(a=k.status)||void 0===a?void 0:a.id)>=30&&(null==k?void 0:null===(o=k.status)||void 0===o?void 0:o.id)<=40,btnPrint:"edit"==A,btnDelete:(null==k?void 0:null===(j=k.status)||void 0===j?void 0:j.id)<40&&"edit"===A,onclickDelete:()=>U(!0),actions:"limpeza"==J,handleSubmit:()=>M.handleSubmit($),handleSend(){B(!0),ea(),el(M.getValues("blocos"))},iconConclusion:"solar:check-read-linear",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:A,status:null==k?void 0:null===(I=k.status)||void 0===I?void 0:I.id,module:"limpeza",actionsData:es}),(0,i.jsx)(u.Z,{id:y,form:M,header:k,block:V,setBlock:q,defaultTab:"limpeza",onSubmit:$}),(0,i.jsx)(b.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:et,size:"lg",setOpenModal:G,openModal:X,form:M,children:(0,i.jsx)(g.Z,{type:"form",data:k,form:M})}),k&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{openModal:T,handleClose(){B(!1),ea()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:{status:k.status.id},canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eo,listErrors:W,canApprove:O,hasNaoConformidade:!0,type:"limpeza",unity:P,values:k,formularioID:4,modeloID:1,form:M}),(0,i.jsx)(h.Z,{open:L,handleClose:()=>U(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(y),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}})]})]})};a.Z=j}}]);