"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5378],{24527:function(e,a,o){var l=o(85893),t=o(79072),i=o(49837),n=o(91359),s=o(61953),r=o(29630),d=o(21609),c=o(62097);let u=e=>{let{xs:a,md:o,icon:u,id:m,title:p,subtitle:x,action:h,handleClick:f,linkedsForms:D}=e,g=(0,c.Z)();return(0,l.jsx)(t.ZP,{item:!0,xs:a,md:o,children:(0,l.jsx)(i.Z,{sx:{"&:hover":{backgroundColor:"".concat(g.palette.action.hover)},height:"100%",display:"flex",flexDirection:"column"},onClick:f,className:"cursor-pointer shadow-xl transition-all",children:(0,l.jsx)(n.Z,{className:"text-center",sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,l.jsxs)(s.Z,{display:"flex",flexDirection:"column",alignItems:"center",sx:{gap:3,padding:6},children:[(0,l.jsx)(d.Z,{icon:u,width:38,className:"text-[#F8D552]"}),(0,l.jsx)(r.Z,{variant:"h6",className:"!font-extrabold",children:p}),(0,l.jsx)(r.Z,{variant:"subtitle2",children:x}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(d.Z,{icon:"new"==h?"icon-park-solid:add-one":"edit"==h?"grommet-icons:form-next-link":"tabler:select",width:16}),(0,l.jsx)(r.Z,{variant:"body2",color:"primary",children:"new"==h?"Criar novo":"edit"==h?"Acessar":"Selecionar"})]}),(e=>{if(!D)return;let a=D.find(a=>a===e);return!a})(m)&&(0,l.jsx)(r.Z,{variant:"body2",color:"error",children:"Formul\xe1rio n\xe3o vinculado"})]})})})})};a.Z=u},91100:function(e,a,o){var l=o(85893);let t=()=>(0,l.jsx)("div",{className:"flex flex-col gap-4",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-[80vh]",children:[(0,l.jsx)("p",{className:"text-3xl font-bold",children:"Nenhum Modelo de Formul\xe1rio cadastrado"}),(0,l.jsx)("p",{className:"opacity-50",children:"Acesse Configura\xe7\xf5es / Modelo de Formul\xe1rio"}),(0,l.jsx)("img",{src:"/empty.svg",alt:"Nenhum formul\xe1rio cadastrado",className:"w-1/2 md:w-1/4"})]})});a.Z=t},28871:function(e,a,o){var l=o(85893),t=o(67294),i=o(83830),n=o(87536),s=o(60664),r=o(40039),d=o(65698),c=o(32038),u=o(86501),m=o(11163),p=o(46099),x=o(42222),h=o(82755),f=o(92629),D=o(91757),g=o(71798),v=o(3404),j=o(51239),b=o(72819);let I=e=>{var a,o,I,y,C;let{modelID:Z}=e,z=(0,m.useRouter)(),{id:w,setId:N,idNc:S,setModelID:F,setLimpezaID:k}=(0,t.useContext)(i.X),{menu:E,user:M,loggedUnity:V,hasPermission:P}=(0,t.useContext)(r.V),[_,A]=(0,t.useState)(null),[H,q]=(0,t.useState)(null),O=w&&w>0?"edit":"new",R=(0,n.cI)({mode:"onChange"}),[T,B]=(0,t.useState)(!1),[L,U]=(0,t.useState)(!0),[X,G]=(0,t.useState)(!1),[J,K]=(0,t.useState)(!1),[Q,W]=(0,t.useState)({status:!1,errors:[]}),[Y,$]=(0,t.useState)(!1),ee=(0,v.n)("limpeza",z),ea=async()=>{try{let e={id:null!=w?w:0,modelID:null!=Z?Z:0,unidadeID:V.unidadeID},a=await s.h.post("/formularios/limpeza/getData",e);console.log("\uD83D\uDE80 ~ getData:",a.data),R.reset(a.data),A(a.data.header),q(a.data.blocos)}catch(o){console.log(o);return}},eo=e=>{e.preventDefault();let a=R.getValues();el(a)},el=async e=>{if(!e)return;let a={form:e,auth:{usuarioID:M.usuarioID,papelID:M.papelID,unidadeID:V.unidadeID}};try{if("new"===O){let o=await s.h.post("/formularios/limpeza/insertData",a);u.ZP.success("Dados cadastrados com sucesso!"),N(o.data.id),z.push("/formularios/limpeza")}else"edit"===O&&(await s.h.post("/formularios/limpeza/updateData/".concat(w),a),u.ZP.success("Dados atualizados com sucesso!"))}catch(l){console.log(l);return}finally{B(!T)}},et=()=>{let e={status:!1,errors:[]};R.clearErrors(),(0,p.n9)(R,"header.dataInicio","Data Inicial",e),(0,p.n9)(R,"header.horaInicio","Hora Inicial",e),(0,p.n9)(R,"header.dataFim","Data Final",e),(0,p.n9)(R,"header.horaFim","Hora Final",e),(0,p.n9)(R,"header.departamento.id","Departamento respons\xe1vel pela limpeza",e),(0,p.n9)(R,"header.setor.id","Setor que foi limpo",e),(0,p.lz)(R,R.getValues("header.fields"),e),(0,p.IB)(R,R.getValues("blocos"),e);let a=(0,p.FU)(e);(Q.status!==a.status||Q.errors.length!==a.errors.length)&&W(a)},ei=async e=>{let a=R.getValues("info.naoConformidade"),o=R.getValues("fieldsFooter");if(w){console.log("\uD83D\uDE80 ~ conclude values:",e={form:{...o,...e,naoConformidade:a},params:{id:w,usuarioID:M.usuarioID,papelID:M.papelID,unidadeID:V.unidadeID,profissionalID:M.profissionalID}}),A(null);try{await s.h.post("".concat(z.pathname,"/conclude"),e),await el(R.getValues())}catch(l){console.log(l);return}finally{G(!1),B(!T)}}},en=async e=>{let a={status:30,observacao:null==e?void 0:e.obs,auth:{usuarioID:M.usuarioID,papelID:M.papelID,unidadeID:V.unidadeID}};try{await s.h.post("".concat(z.pathname,"/reOpen/").concat(w),a),u.ZP.success(g.OD.successUpdate)}catch(o){console.log(o)}finally{B(!T)}},es=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.resposta&&1==e.resposta.bloqueiaFormulario&&(a=!1)})}),U(a)},er=()=>{N(_.modelo.id),z.push("/configuracoes/formularios/limpeza/")},ed=e=>{console.log("\uD83D\uDE80 ~ handleNewNC: ",_.limpeza.id,e.new.modelo.id),N(_.limpeza.id),k(_.limpeza.id),F(e.new.modelo.id),z.push("/formularios/limpeza/novo/?aba=nao-conformidade")},ec=[],eu={id:1,name:"Reabrir formul\xe1rio",description:"Reabrir formul\xe1rio para preenchimento.",component:(0,l.jsx)(D.Z,{}),disabled:!P(z.pathname,"editar"),route:null,type:null,action:en,modal:!0,size:"sm",icon:"heroicons:lock-open",identification:null,ncPending:!0};return _&&_.status.id>=40&&ec.push(eu),(0,x.z)(E,"/configuracoes/formularios")&&ec.push({id:2,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:er,modal:!1,icon:"bi:gear",identification:null}),(0,t.useEffect)(()=>{ea(),setTimeout(()=>{R.trigger()},300)},[w,V,T]),(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("form",{onSubmit:e=>eo(e),children:[(0,l.jsx)(d.Z,{id:w,btnNew:"edit"===O&&"limpeza"==ee,btnNewModal:1===M.papelID&&"edit"===O&&"limpeza"!=ee,handleNewModal:()=>$(!0),btnCancel:!0,btnSave:(null==_?void 0:null===(a=_.status)||void 0===a?void 0:a.id)<40,btnSend:(null==_?void 0:null===(o=_.status)||void 0===o?void 0:o.id)>=30&&(null==_?void 0:null===(I=_.status)||void 0===I?void 0:I.id)<=40,btnPrint:"edit"==O,btnDelete:(null==_?void 0:null===(y=_.status)||void 0===y?void 0:y.id)<40&&"edit"===O,onclickDelete:()=>K(!0),actions:"limpeza"==ee,handleSubmit:()=>R.handleSubmit(el),handleSend(){G(!0),et(),es(H)},iconConclusion:"solar:check-read-linear",titleConclusion:"Concluir",title:"Limpeza e Higieniza\xe7\xe3o",type:O,status:null==_?void 0:null===(C=_.status)||void 0===C?void 0:C.id,module:"limpeza",actionsData:ec}),(0,l.jsx)(c.Z,{id:w,modelID:Z,form:R,header:_,block:H,setBlock:q,defaultTab:"limpeza"}),(0,l.jsx)(b.Z,{title:"Nova N\xe3o Conformidade",handleConclusion:ed,size:"lg",setOpenModal:$,openModal:Y,form:R,children:(0,l.jsx)(j.Z,{type:"form",data:_,form:R})}),_&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.Z,{openModal:X,handleClose(){G(!1),et()},title:"Concluir Limpeza e Higieniza\xe7\xe3o",text:"Deseja realmente concluir este formul\xe1rio?",info:{status:_.status.id},canChange:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ei,listErrors:Q,canApprove:L,hasNaoConformidade:!0,type:"limpeza",unity:V,values:_,formularioID:4,modeloID:_.modelo.id,form:R}),(0,l.jsx)(f.Z,{open:J,handleClose:()=>K(!1),title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/recebimento-mp/nao-conformidade/delete/".concat(w),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"}})]})]})})};a.Z=I},5378:function(e,a,o){var l=o(85893),t=o(61953),i=o(54225),n=o(79072),s=o(83830),r=o(40039),d=o(21609),c=o(67294),u=o(60664),m=o(11163),p=o.n(m),x=o(24527),h=o(71798),f=o(91100),D=o(28871);let g=()=>{let{loggedUnity:e}=(0,c.useContext)(r.V),{setId:a}=(0,c.useContext)(s.X),[o,m]=(0,c.useState)(null),[g,v]=(0,c.useState)(null),j=p(),b=async()=>{try{let a=await u.h.post("".concat((0,h.g_)(j.pathname),"/getModels"),{unidadeID:e.unidadeID});1===a.data.length?(I(a.data[0].id),m(a.data[0].id)):v(a.data)}catch(o){console.log(o)}},I=e=>{m(e)},y=async e=>{try{I(e)}catch(a){console.log(a)}};return(0,c.useEffect)(()=>{b()},[]),(0,l.jsxs)(l.Fragment,{children:[o&&(0,l.jsx)(D.Z,{modelID:o}),!o&&(0,l.jsxs)(t.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,l.jsx)("div",{children:(0,l.jsx)(i.Z,{onClick(){a(null),j.push((0,h.g_)(j.pathname))},type:"button",variant:"outlined",color:"primary",size:"medium",children:(0,l.jsx)(d.Z,{icon:"grommet-icons:form-previous-link"})})}),g&&0===g.length&&(0,l.jsx)(f.Z,{}),(0,l.jsx)(n.ZP,{container:!0,spacing:4,children:g&&g.length>1&&g.map((e,a)=>(0,l.jsx)(x.Z,{xs:12,md:3,icon:"fluent:form-multiple-48-regular",title:e.nome,action:"new",subtitle:"Ciclo de ".concat(e.ciclo," dias"),handleClick:()=>y(e.id)},a))})]})]})};a.Z=g}}]);